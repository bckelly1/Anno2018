(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"/7QA":function(e,t,n){"use strict";n.r(t);var r=n("XH0y"),i=n("ssMx"),a=n("IqKQ"),o=n("cE7O"),s=n("vurl");function u(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){u(a,r,i,o,s,"next",e)}function s(e){u(a,r,i,o,s,"throw",e)}o(void 0)}))}}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d,f=n("7GJN"),p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.filer=void 0,this.filer=new f}var t,n,r,i,a,u,d,p,h,m,g,v,y,b,w,x,k,S,E,R,_;return t=e,(n=[{key:"init",value:(_=c(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){return n.filer.init({persistent:!0,size:t},e,r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return _.apply(this,arguments)})},{key:"create",value:(R=c(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){return n.filer.create(t,!1,e,r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return R.apply(this,arguments)})},{key:"mkdir",value:(E=c(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){return n.filer.mkdir(t,!1,e,r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return E.apply(this,arguments)})},{key:"ls",value:(S=c(regeneratorRuntime.mark((function e(t,n){var r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){a.filer.ls(t,e,n)}));case 2:if(r=e.sent,n){e.next=5;break}return e.abrupt("return",r);case 5:return i=n.split("|"),e.abrupt("return",r.filter((function(e){return e.isFile&&i.some((function(t){return e.name.endsWith(t)}))})));case 7:case"end":return e.stop()}}),e)}))),function(e,t){return S.apply(this,arguments)})},{key:"exists",value:(k=c(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.fullPath?t.fullPath:t).startsWith("/")){e.next=3;break}throw new Error('exists() only works with absolute paths, "'.concat(n,'" given.'));case 3:r=n.split("/").filter((function(e){return""!==e})),n="",i=!0,a=!1,o=void 0,e.prev=8,s=r[Symbol.iterator]();case 10:if(i=(u=s.next()).done){e.next=22;break}return c=u.value,n+="/",e.next=15,this.ls(n);case 15:if(l=e.sent,n+=c,void 0!==l.find((function(e){return e.fullPath===n}))){e.next=19;break}return e.abrupt("return",!1);case 19:i=!0,e.next=10;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(8),a=!0,o=e.t0;case 28:e.prev=28,e.prev=29,i||null==s.return||s.return();case 31:if(e.prev=31,!a){e.next=34;break}throw o;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return e.abrupt("return",!0);case 37:case"end":return e.stop()}}),e,this,[[8,24,28,36],[29,,31,35]])}))),function(e){return k.apply(this,arguments)})},{key:"open",value:(x=c(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){return n.filer.open(t,e,r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return x.apply(this,arguments)})},{key:"openAndGetContentAsText",value:(w=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.open(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.getTextContentFromFile.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"openAndGetContentAsStream",value:(b=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=o.a,e.t1=this,e.next=4,this.open(t);case 4:return e.t2=e.sent,e.next=7,e.t1.getUint8ContentFromFile.call(e.t1,e.t2);case 7:return e.t3=e.sent,e.abrupt("return",new e.t0(e.t3));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"openAndGetContentAsUint8Array",value:(y=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.open(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.getUint8ContentFromFile.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getTextContentFromFile",value:(v=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(t){null!==r.result?e(r.result):n()},r.onerror=function(e){n()},r.readAsText(t)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"getUint8ContentFromFile",value:(g=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(t){null!==r.result?e(new Uint8Array(r.result)):n()},r.onerror=function(e){n()},r.readAsArrayBuffer(t)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},{key:"df",value:(m=c(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.filer.df((function(t,n,r){return e({used:t,free:n,cap:r})}),n)})));case 1:case"end":return e.stop()}}),e)}))),function(){return m.apply(this,arguments)})},{key:"write",value:(h=c(regeneratorRuntime.mark((function e(t,n){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){return r.filer.write(t,{data:n},e,i)})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return h.apply(this,arguments)})},{key:"rm",value:(p=c(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){return n.filer.rm(t,e,r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return p.apply(this,arguments)})},{key:"rmRoot",value:(d=c(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ls("/");case 2:return t=e.sent,e.abrupt("return",Promise.all(t.map((function(e){return n.rm(e.fullPath)}))));case 4:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"download",value:(u=c(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.ls(t);case 3:n=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",this.downloadFile(t));case 9:return e.abrupt("return",this.downloadDirectory(n));case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return u.apply(this,arguments)})},{key:"downloadFile",value:(a=c(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="string"==typeof t?t:t.fullPath,e.next=3,this.openAndGetContentAsUint8Array(t);case 3:r=e.sent,(i=document.createElement("a")).setAttribute("href","data:application/json;base64,".concat(Object(s.e)(r))),i.setAttribute("download",n),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"downloadDirectory",value:(i=c(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,r=!1,i=void 0,e.prev=3,a=t[Symbol.iterator]();case 5:if(n=(o=a.next()).done){e.next=12;break}return s=o.value,e.next=9,this.download(s);case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,i=e.t0;case 18:e.prev=18,e.prev=19,n||null==a.return||a.return();case 21:if(e.prev=21,!r){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(e){return i.apply(this,arguments)})}])&&l(t.prototype,n),r&&l(t,r),e}(),h=n("+qE3");function m(e,t){if(!e)throw new Error(t||"unknown assertion error")}!function(e){e[e.Paused=0]="Paused",e[e.Default=1]="Default",e[e.Slow=1]="Slow",e[e.Medium=2]="Medium",e[e.Fast=4]="Fast",e[e.SuperFast=8]="SuperFast"}(d||(d={}));var g=function e(t,n,r,i,a,o,s,u,c,l,d,f){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islands=t,this.players=n,this.tasks=r,this.gameName=i,this.soldiers=a,this.ships=o,this.kontors=s,this.castles=u,this.cities=c,this.trader=l,this.timers=d,this.producers=f,console.log("Tasks"),console.table(r),console.log("Game Name",i),console.log("Islands"),console.table(t),console.log("Players"),console.table(n),console.log("Soldiers"),console.table(a),console.log("Ships"),console.table(o),console.log("Kontors"),console.table(s),console.log("Castles"),console.table(u),console.log("Cities"),console.table(c),console.log("Trader",l),console.log("Timers",d),console.log("Producers"),console.table(f)};function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(n,!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var R=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=k(this,S(t).call(this))).configLoader=e,r.state=void 0,r.timerId=void 0,r.getFieldAtIsland=function(e,t){return e.fields[t.x][t.y]},r.getFieldAt=function(e){var t=Object.values(r.state.islands).find((function(t){return t.positionRect.contains(e.x,e.y)}));if(!t)return null;var n=new a.Point(e.x-t.position.x,e.y-t.position.y);return r.getFieldAtIsland(t,n)},r.tick=function(){r.state.timers.timeGame++,r.state.timers.cntCity=r.inc(r.state.timers.cntCity,8,100),r.state.timers.cntIsland=r.inc(r.state.timers.cntIsland,8,100),r.state.timers.cntShipyard=r.inc(r.state.timers.cntShipyard,8,10),r.state.timers.cntMilitary=r.inc(r.state.timers.cntMilitary,8,10),r.state.timers.cntProduction=r.inc(r.state.timers.cntProduction,8,10),r.watchTicksForUpkeep(),r.watchTicksForProducing(),r.emit("tick")},r.inc=function(e,t,n){return r.state.timers.timeGame%n!=0?e:(++e>=t&&(e=0),e)},r.state={players:r.mapArrayById(n.players),islands:r.mapArrayById(n.islands),tasks:r.mapArrayById(n.tasks),cities:n.cities,kontors:n.kontors,producers:n.producers,ships:n.ships,timers:b({},n.timers,{simulationSpeed:d.Paused})},r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,e),n=t,(r=[{key:"setSimulationSpeed",value:function(e){this.state.timers.simulationSpeed=e,this.timerId&&window.clearInterval(this.timerId),e!==d.Paused&&(this.timerId=window.setInterval(this.tick,100/e)),this.emit("simulation-speed",e)}},{key:"mapArrayById",value:function(e){return e.reduce((function(e,t){return e[t.id]=t,e}),{})}},{key:"watchTicksForUpkeep",value:function(){if(this.state.timers.timeGame%100==0){console.log("upkeep calculation");for(var e=this.calculateUpkeeps(),t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=Math.floor(e[r]/6);this.addMoney(parseInt(r,10),-i)}}}},{key:"addMoney",value:function(e,t){this.state.players[e].money+=t,this.emit("player/money",{playerId:e,money:this.state.players[e].money})}},{key:"watchTicksForProducing",value:function(){var e=this;if(this.state.timers.timeGame%10==0){console.log("update producers");var t=this.configLoader.getFieldData();this.state.producers.forEach((function(n,r){if(!n.active)return[];var i=e.state.islands[n.islandId],a=e.getFieldAtIsland(i,n.position).fieldId,o=t.get(a);if(m(o),128===n.producedGood&&1===n.timer){var s=n.stock+1,u=n.firstGoodStock-o.production.amount1,c=n.secondGoodStock-o.production.amount2,l=u>=o.production.amount1&&c>=o.production.amount2&&s<o.production.maxStock;e.updateProcuder(r,{stock:s,timer:l?o.production.interval:11,firstGoodStock:u,secondGoodStock:c,producedGood:l?128:0})}else if(0!==n.producedGood||1!==n.timer&&0!==e.state.timers.cntProduction)e.updateProcuder(r,{timer:n.timer<=1?11:n.timer-1});else{var d=n.firstGoodStock>=o.production.amount1&&n.secondGoodStock>=o.production.amount2&&n.stock<o.production.maxStock;e.updateProcuder(r,{timer:d?o.production.interval:n.timer<=1?11:n.timer-1,producedGood:d?128:0})}}))}}},{key:"updateProcuder",value:function(e,t){var n=this.state.producers[e];Object.assign(n,t),this.emit("producer/updated",{producerId:e}),void 0!==t.stock&&this.emit("producer/good-produced",{island:this.state.islands[n.islandId],position:n.position,stock:n.stock})}},{key:"calculateUpkeeps",value:function(){var e=this,t=Object.keys(this.state.players).reduce((function(e,t){return e[t]=0,e}),{});return Object.values(this.state.producers).forEach((function(n){var r=e.state.islands[n.islandId].fields[n.position.x][n.position.y],i=r.fieldId,a=r.playerId;m(65535!==i),m(a<7);var o=e.configLoader.getFieldData().get(i);m(o),t[a]+=o.production.upkeep[n.active?"active":"inactive"]}),this),t}}])&&x(n.prototype,r),i&&x(n,i),t}(h.EventEmitter),_=n("qVmS"),A=n("p0ib"),I=n("0/uQ"),P=n("bne5"),O=n("Rney");function T(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}var C=64,N=32,G=function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.world=t,this.spriteLoader=n,this.render=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return r.spriteLoader.getIslandSprites(e)})));case 2:return n=e.sent,console.log("Map sprites loaded."),n.forEach((function(e){return e.sprites.forEach((function(e){return e.filter((function(e){return null!==e})).forEach((function(e){return r.world.addChild(e.sprite)}))}))})),console.log("Map sprites drawn."),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){T(a,r,i,o,s,"next",e)}function s(e){T(a,r,i,o,s,"throw",e)}o(void 0)}))});return function(e){return t.apply(this,arguments)}}()};function j(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D,M=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.isTrader=n,this.animation=void 0,this.bugAnimation=void 0,this.whiteFlag=void 0,this.flag=void 0,this.hp=void 0,this.HP_WIDTH=38,this.HP_HEIGHT=7}var t,n,r,i,o;return t=e,(n=[{key:"begin",value:(i=regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getShipAnimation(t);case 2:return this.animation=e.sent,m(this.animation.config.Bugfignr),e.next=6,n.getAnimation(this.animation.config.Bugfignr);case 6:return this.bugAnimation=e.sent,e.next=9,n.getAnimation("FAHNEWEISS");case 9:if(this.whiteFlag=e.sent,this.isTrader){e.next=18;break}return r="FAHNE".concat(5===t.playerId?"PIRAT":t.playerId+1),e.next=14,n.getAnimation(r);case 14:this.flag=e.sent,this.hp=new a.Graphics,this.hp.beginFill(65280),this.hp.drawRect(0,0,this.HP_WIDTH,this.HP_HEIGHT);case 18:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){j(a,n,r,o,s,"next",e)}function s(e){j(a,n,r,o,s,"throw",e)}o(void 0)}))},function(e,t){return o.apply(this,arguments)})},{key:"render",value:function(e,t){var n=e.rotation,r=V.fieldPosToWorldPos(e.position),i=r.x,a=r.y,o=this.animation.animations[0].rotations[n].main,u=i+(-Math.floor(o.width/2)+C/2),c=a+(this.animation.config.Posoffs[0]+18),l=function(e){return Math.sign(e)*Math.floor(Math.abs(e))},d=this.animation.config.Fahnoffs,f=i+C/2;switch(n){case 0:case 2:f+=l(d[1]*C/2);break;case 4:case 6:f+=-l(d[1]*C/2);break;case 1:f+=l(d[1]*C*Math.SQRT2/2);break;case 5:f+=-l(d[1]*C*Math.SQRT2/2);break;case 3:case 7:f+=0;break;default:Object(s.a)(n)}var p=a+48;switch(n){case 2:case 4:p+=l(d[1]*N/2);break;case 0:case 6:p+=-l(d[1]*N/2);break;case 3:p+=l(d[1]*N*Math.SQRT2/2);break;case 7:p+=-l(d[1]*N*Math.SQRT2/2);break;case 1:case 5:p+=0;break;default:Object(s.a)(n)}if(this.animation.config.Bugfignr){var h=this.bugAnimation.animations[0].rotations[n].main;h.x=f-Math.floor(h.width/2),h.y=p-30,t.addChild(h),h.play()}if(o.x=u,o.y=c,t.addChild(o),o.play(),!this.isTrader){var m=this.flag.animations[0].rotations[0].main,g=f-Math.floor(m.width/2),v=p-Math.floor(d[2]*N);m.x=g,m.y=v,t.addChild(m),m.play();var y=i+C/2-this.HP_WIDTH/2,b=v-m.height-this.HP_HEIGHT;this.hp.position.set(y,b),t.addChild(this.hp)}}}])&&F(t.prototype,n),r&&F(t,r),e}();function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Stopped=0]="Stopped",e[e.Sailing=55]="Sailing",e[e.Unknown=53]="Unknown",e[e.Unknown2=52]="Unknown2",e[e.Unknown3=54]="Unknown3",e[e.Unknown4=51]="Unknown4"}(D||(D={}));var B=function(){var e,t,n;function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.position=e,this.state=t}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read32(),n=t>>8&255,i=t>>16&255,o=t>>24&255,s=t>>0&255;return m(s in D),new r(new a.Point(o+((15&n)<<8),i+((240&n)<<4)),s)}}],(t=null)&&L(e.prototype,t),n&&L(e,n),r}(),H={21:"HANDEL1",23:"HANDEL2",25:"KRIEG1",27:"KRIEG2",29:"HANDLER",31:"PIRAT",37:"TRADER1"};function U(e){var t=e.readString(28),n=new a.Point(e.read16(),e.read16()),r=(e.read(12),B.fromSaveGame(e),B.fromSaveGame(e),B.fromSaveGame(e),e.read32(),e.read16()),i=(e.read32(),e.read8(),e.read8(),e.read16(),e.read16()),o=e.read16(),s=e.read8(),u=e.read8(),c=(e.read32(),e.read16()),l=function(e,t){for(var n=[],r=0;r<t;r++)n.push({id:e.read8(),kontor_id:e.read8(),_1:e.read16(),goods:z(e,2),_2:e.read(16)});return n}(e,8);e.read16();return{id:i,type:o,kind:s,playerId:u,position:n,rotation:c,name:t,hp:r,tradeStops:l,cargo:z(e,8)}}function z(e,t){for(var n=[],r=0;r<t;r++)n.push({good_id:e.read16(),amount:e.read16(),action:e.read32()});return n}function W(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function K(e,t,n){return t&&Z(e.prototype,t),n&&Z(e,n),e}var V=function(){function e(t,n,r,i,o,s,u){var c=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.islandSpriteLoader=n,this.app=r,this.viewport=i,this.configLoader=o,this.animationRenderer=s,this.myPlayerId=u,this.money=void 0,this.simulationSpeedDisplay=void 0,this.WIDTH=500,this.HEIGHT=350,this.fields=void 0,this.keyboardManager=void 0,this.setMoney=function(e){c.money.text="Money: ".concat(e)},this.cull=function(){for(var t=c.viewport.getVisibleBounds(),n=e.worldPosToFieldPos(new a.Point(t.x-C,t.y-N)),r=e.worldPosToFieldPos(new a.Point(t.x+t.width+C,t.y+t.height+N+200)),i=0;i<c.WIDTH;i++)for(var o=0;o<c.HEIGHT;o++){var s=c.fields[i][o];s&&(s.visible=i+o>=n.x+n.y&&i-o>=n.x-n.y&&i+o<=r.x+r.y&&i-o<=r.x-r.y)}},this.keyboardManager=new _.b,this.setupHotKeys(),this.money=new a.Text("",{fontFamily:"Arial",fontSize:24,fill:16715792}),this.money.y=0,this.simulationSpeedDisplay=new a.Text("",{fontFamily:"Arial",fontSize:24,fill:16715792}),this.simulationSpeedDisplay.y=150}var t,n;return K(e,null,[{key:"fieldPosToWorldPos",value:function(e){var t=e.x,n=e.y,r=C/2*(t-n),i=(t+n)*(N/2);return new a.Point(r,i)}},{key:"worldPosToFieldPos",value:function(e){var t=(e.x/(C/2)+e.y/(N/2))/2,n=(e.y/(N/2)-e.x/(C/2))/2;return new a.Point(Math.round(t),Math.round(n)+1)}},{key:"worldPosToFieldPosLand",value:function(e){var t=new a.Point;return t.copyFrom(e),t.y-=-20,this.worldPosToFieldPos(t)}}]),K(e,[{key:"begin",value:(t=regeneratorRuntime.mark((function t(){var n,r,i,o,u,c,l,d=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.keyboardManager.enable(),this.app.ticker.add((function(){d.keyboardManager.update()})),this.viewport.removeChildren(),this.debugControls(),n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,i=new a.Graphics;i.position.set(e,t),i.beginFill(65280),i.drawRect(0,0,n,r),d.viewport.addChild(i)},t.next=7,Promise.all(Object.values(this.game.state.islands).map((function(e){return d.islandSpriteLoader.getIslandSprites(e)})));case 7:r=t.sent,console.log("Map sprites loaded."),r.forEach((function(e){e.sprites.forEach((function(e){return e.filter((function(e){return null!==e})).forEach((function(e){return d.viewport.addChild(e.sprite)}))})),e.smokeSprites.forEach((function(e){d.viewport.addChild(e),e.play(),n(e.x,e.y,3,3)}))})),console.log("Map sprites drawn."),i=Object(s.d)(this.WIDTH,this.HEIGHT),r.forEach((function(e){return e.sprites.forEach((function(e){return e.filter((function(e){return null!==e})).forEach((function(e){return i[e.mapPosition.x][e.mapPosition.y]=e.sprite}))}))})),o=null,u=0;case 15:if(!(u<this.WIDTH)||o){t.next=27;break}c=0;case 17:if(!(c<this.HEIGHT)){t.next=24;break}if(!i[u][c]){t.next=21;break}return o=i[u][c].texture,t.abrupt("break",24);case 21:c++,t.next=17;break;case 24:u++,t.next=15;break;case 27:return i.forEach((function(t,n){return t.forEach((function(t,r){if(null===t){var s=new a.Sprite(o),u=e.fieldPosToWorldPos(new a.Point(n,r)),c=u.x,l=u.y;s.anchor.set(0,1),s.x=c,s.y=l,i[n][r]=s,d.viewport.addChild(s)}}))})),this.fields=i,this.moveCameraToStartPosition(this.myPlayerId),l=this.game.state.ships.filter((function(e){return"TRADER1"!==H[e.type]})).map((function(e){return new M(e.id,4===e.playerId)})),t.next=33,Promise.all(this.game.state.ships.filter((function(e){return"TRADER1"!==H[e.type]})).map((function(e){return l.find((function(t){return t.id===e.id})).begin(e,d.animationRenderer)})));case 33:this.game.state.ships.filter((function(e){return"TRADER1"!==H[e.type]})).forEach((function(e){l.find((function(t){return t.id===e.id})).render(e,d.viewport)})),Object(A.a)(Object(I.a)(["initial"]),Object(P.a)(this.viewport,"zoomed"),Object(P.a)(this.viewport,"moved")).pipe(Object(O.a)(200)).subscribe(this.cull),this.game.addListener("player/money",(function(e){var t=e.playerId,n=e.money;t===d.myPlayerId&&d.setMoney(n)})),this.game.addListener("producer/good-produced",(function(e){var t=e.island,n=e.position,r=e.stock;d.onProduced(t,n,r)})),this.game.addListener("simulation-speed",(function(e){return d.simulationSpeedDisplay.text="Simulation speed: ".concat(e)}));case 38:case"end":return t.stop()}}),t,this)})),n=function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(e){W(a,r,i,o,s,"next",e)}function s(e){W(a,r,i,o,s,"throw",e)}o(void 0)}))},function(){return n.apply(this,arguments)})},{key:"setupHotKeys",value:function(){var e=this,t=_.a.F1;this.keyboardManager.onKeyPressedWithPreventDefault(t,(function(){var t=e.game.state.players[e.myPlayerId],n=e.game.state.tasks[t.assignedTaskId];void 0!==n?console.info(n.text):console.info("It appears like you have no task :/")}));for(var n=[{key:_.a.F2,zoom:1},{key:_.a.F3,zoom:2},{key:_.a.F4,zoom:3}],r=function(){var t=a[i];e.keyboardManager.onKeyPressedWithPreventDefault(t.key,(function(){return e.zoom(t.zoom)}))},i=0,a=n;i<a.length;i++)r();for(var o=[{keys:[_.a.PAUSE],speed:d.Paused},{keys:[_.a.F5],speed:d.Slow},{keys:[_.a.F6],speed:d.Medium},{keys:[_.a.F7],speed:d.Fast},{keys:[_.a.SHIFT,_.a.F8],speed:d.SuperFast}],s=function(){var t=c[u];e.keyboardManager.onKeysPressedWithPreventDefault(t.keys,(function(){return e.game.setSimulationSpeed(t.speed)}))},u=0,c=o;u<c.length;u++)s();[_.a.LEFT,_.a.RIGHT,_.a.UP,_.a.DOWN].forEach((function(t){return e.keyboardManager.setPreventDefault(t)})),this.keyboardManager.on("down",(function(t){switch(console.log("key down",t),t){case _.a.LEFT:e.viewport.moveCorner(e.viewport.corner.x-50,e.viewport.corner.y),e.cull();break;case _.a.RIGHT:e.viewport.moveCorner(e.viewport.corner.x+50,e.viewport.corner.y),e.cull();break;case _.a.UP:e.viewport.moveCorner(e.viewport.corner.x,e.viewport.corner.y-50),e.cull();break;case _.a.DOWN:e.viewport.moveCorner(e.viewport.corner.x,e.viewport.corner.y+50),e.cull()}}))}},{key:"zoom",value:function(e){var t=this.viewport.center;this.viewport.scale.set(1/e),this.viewport.moveCenter(t.x,t.y),this.cull()}},{key:"onProduced",value:function(t,n,r){var i=this;console.log("Producer at island ".concat(t.id," (").concat(n.x,", ").concat(n.y,") has now stock: ").concat(r,"."));var o=new a.Text("Stock: ".concat(r),{fontFamily:"Arial",fontSize:24,fill:16715792}),s=e.fieldPosToWorldPos(new a.Point(t.position.x+n.x,t.position.y+n.y));o.position.set(s.x,s.y),this.viewport.addChild(o);var u=this.app.ticker.lastTime;this.app.ticker.add((function e(){o.position.y=o.position.y-100*i.app.ticker.deltaMS/2e3,i.app.ticker.lastTime-u>2e3&&(i.app.ticker.remove(e),i.viewport.removeChild(o))}))}},{key:"debugControls",value:function(){var t=this,n=new a.Container;n.addChild(this.money);var r=new a.Text("",{fontFamily:"Arial",fontSize:24,fill:16715792});r.y=30,n.addChild(r);var i=new a.Text("",{fontFamily:"Arial",fontSize:24,fill:16715792});i.y=60,n.addChild(i);var o=new a.Text("",{fontFamily:"Arial",fontSize:24,fill:16715792});o.y=90,n.addChild(o),n.addChild(this.simulationSpeedDisplay);var s=this.app.renderer.plugins.interaction,u=function(){var n=e.worldPosToFieldPosLand(t.viewport.toWorld(s.mouse.global));r.text="x: ".concat(n.x,", y: ").concat(n.y);var u=Object.values(t.game.state.islands).find((function(e){return e.positionRect.contains(n.x,n.y)}));if(u){var c=new a.Point(n.x-u.position.x,n.y-u.position.y);i.text="Island id: ".concat(u.id,", x: ").concat(c.x," y: ").concat(c.y);var l=t.game.state.producers.find((function(e){return e.islandId===u.id&&e.position.x===c.x&&e.position.y===c.y}));if(l){var d=t.game.getFieldAtIsland(u,l.position),f=t.configLoader.getFieldData().get(d.fieldId);o.text="Producer: Stock: ".concat(l.stock," (max: ").concat(f.production.maxStock,", good: ").concat(f.production.good,"), Good A: ").concat(l.firstGoodStock," (required: ").concat(f.production.amount1,", good: ").concat(f.production.good1,"), Good B: ").concat(l.secondGoodStock," (required: ").concat(f.production.amount2,", good: ").concat(f.production.good2,"),\n Active: ").concat(l.active,", Timer: ").concat(l.timer,", Rotation: ").concat(d.rotation)}else o.text="No Producer"}else i.text="Island id: ?"};u(),this.viewport.on("moved",u),this.viewport.on("wheel-scroll",u),s.on("pointermove",u),this.viewport.parent.addChild(n)}},{key:"moveCameraToStartPosition",value:function(e){var t=this.game.state.kontors.find((function(t){return t.playerId===e}));if(void 0===t){var n=this.game.state.ships.find((function(t){return t.playerId===e}));void 0===n?this.moveTo(new a.Point(250,150)):this.moveTo(n.position)}else{var r=t.position,i=Object.values(this.game.state.islands).find((function(e){return e.id===t.islandId}));this.moveTo(new a.Point(i.position.x+r.x,i.position.y+r.y))}}},{key:"moveTo",value:function(t){this.viewport.moveCenter(e.fieldPosToWorldPos(t))}}]),e}();function q(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Y(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function X(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Y(a,r,i,o,s,"next",e)}function s(e){Y(a,r,i,o,s,"throw",e)}o(void 0)}))}}function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var $=function(){function e(t,n,r,i,a,o,s,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.gamParser=n,this.islandSpriteLoader=r,this.app=i,this.viewport=a,this.configLoader=o,this.musicPlayer=s,this.animationRenderer=u}var t,n,r,i,a,o;return t=e,(n=[{key:"loadByName",value:(o=X(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadSavesAndMissions();case 2:if(n=e.sent,r=n.find((function(e){return e.name===t}))){e.next=6;break}throw new Error("Could not find ".concat(t,". The following files are available: ").concat(n.map((function(e){return e.name})).join(", ")));case 6:return e.next=8,this.load(r);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"load",value:(a=X(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.openAndGetContentAsStream(t);case 2:return n=e.sent,e.next=5,this.gamParser.getWorld(n);case 5:return r=e.sent,i=new R(this.configLoader,r),a=new V(i,this.islandSpriteLoader,this.app,this.viewport,this.configLoader,this.animationRenderer,0),e.next=11,a.begin();case 11:return e.next=13,this.musicPlayer.playAll();case 13:i.setSimulationSpeed(d.Default);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"loadSavesAndMissions",value:(i=X(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.t0=t.push,e.t1=t,e.t2=q,e.next=7,this.fs.ls("/saves",".gam");case 7:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4),e.next=14;break;case 12:e.prev=12,e.t5=e.catch(1);case 14:return n=[],e.prev=15,e.t6=n.push,e.t7=n,e.t8=q,e.next=21,this.fs.ls("/missions-original",".szs|.szm");case 21:return e.t9=e.sent,e.t10=(0,e.t8)(e.t9),e.t6.apply.call(e.t6,e.t7,e.t10),e.t11=n.push,e.t12=n,e.t13=q,e.next=29,this.fs.ls("/missions-custom",".szs|.szm");case 29:e.t14=e.sent,e.t15=(0,e.t13)(e.t14),e.t11.apply.call(e.t11,e.t12,e.t15),e.next=36;break;case 34:e.prev=34,e.t16=e.catch(15);case 36:return e.abrupt("return",t.concat(n));case 37:case"end":return e.stop()}}),e,this,[[1,12],[15,34]])}))),function(){return i.apply(this,arguments)})}])&&J(t.prototype,n),r&&J(t,r),e}();function Q(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ee(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Q(a,r,i,o,s,"next",e)}function s(e){Q(a,r,i,o,s,"throw",e)}o(void 0)}))}}function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ne=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.animationData=t,this.spriteLoader=n}var t,n,r,i,o,s;return t=e,(n=[{key:"getAnimation",value:(s=ee(regeneratorRuntime.mark((function e(t){var n,r,i,o,s,u,c,l,d,f,p,h,g,v,y,b,w,x,k,S,E,R,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.animationData.objects.FIGUR.items[t]){e.next=4;break}throw console.log(this.animationData.objects.FIGUR.items),new Error("Invalid animation name: ".concat(t));case 4:if(console.log(n),!["FAHNE1","FAHNE2","FAHNE3","FAHNE4","FAHNEWEISS","FAHNEPIRAT"].includes(t)){e.next=9;break}r={0:this.animationData.objects.FIGUR.items.FAHNEMARKT.nested_objects.ANIM[0]},e.next=13;break;case 9:if(0!==Object.values(n.nested_objects).length){e.next=11;break}throw new Error('Animation "'.concat(t,'" does not include sufficient animation data.'));case 11:m(n.nested_objects.ANIM),r=n.nested_objects.ANIM;case 13:return i=n.Gfx,o=n.Rotate,s=0===o?1:8,m(n.GfxCategoryMapped.startsWith("GFX")),u=n.GfxCategoryMapped.substr("GFX".length),e.next=20,this.spriteLoader.getTextures(u);case 20:for(c=e.sent,l={config:n,animations:{}},d=0,f=Object.keys(r);d<f.length;d++){for(p=f[d],h=[],g=r[p],v=n.Bugfignr?1:g.AnimAnz,y=1/60*(1e3/g.AnimSpeed),b=g.AnimAdd,g.AnimRept&&g.AnimRept,w=g.Rotate?g.Rotate:o,x=0;x<s;x++){for(k=[],S=i+g.AnimOffs+x*w,E=[],R=0;R<v;R++)E.push(c.get(S)),S+=b;(_=new a.AnimatedSprite(E)).anchor.set(0,1),_.loop="ENDLESS"===g.Kind,_.animationSpeed=y,k.push(_),h.push({main:_})}l.animations[p]={rotations:h,config:g}}return e.abrupt("return",l);case 24:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"renderAnimation",value:(o=ee(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAnimation(t);case 2:for(r=e.sent,console.log(r),i=200,a=function(){var e=s[o],t=r.animations[e].rotations,a=0;t.forEach((function(e){u.debugDrawSprite(e.main,n,a,i),a+=e.main.width})),i+=50},o=0,s=Object.keys(r.animations);o<s.length;o++)a();case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getShipAnimation",value:(i=ee(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=H[t.type],e.abrupt("return",this.getAnimation(n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"debugDrawSprite",value:function(e,t,n,r){var i=new a.Graphics;i.position.set(n,r),i.lineStyle(1,16711680),i.drawRect(0,0,e.width,-e.height),e.position.set(n,r),t.addChild(e),t.addChild(i),e.play()}}])&&te(t.prototype,n),r&&te(t,r),e}();function re(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ie(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){re(a,r,i,o,s,"next",e)}function s(e){re(a,r,i,o,s,"throw",e)}o(void 0)}))}}function ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var oe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=void 0,this.gfxId=void 0,this.kind=void 0,this.size=void 0,this.rotate=void 0,this.animAdd=void 0,this.yOffset=void 0,this.animTime=void 0,this.animAnz=void 0,this.production=void 0,this.id=t.Id,this.gfxId=t.Gfx,this.kind=t.Kind,this.size=new a.Point(t.Size.x,t.Size.y),this.rotate=t.Rotate,this.animAdd=t.AnimAdd,this.animAnz=t.AnimAnz,this.animTime="TIMENEVER"===t.AnimTime?-1:t.AnimTime,this.yOffset=-t.Posoffs;var n=t.nested_objects.HAUS_PRODTYP[0],r={active:0,inactive:0};Array.isArray(n.Kosten)?(r.active=n.Kosten[0],r.inactive=n.Kosten[1]):r.active=r.inactive=void 0!==n.Kosten?n.Kosten:0,this.production={good:n.Ware,upkeep:r,good1:n.Rohstoff,good2:n.Workstoff,amount1:n.Rohmenge,amount2:void 0!==n.Workmenge?n.Workmenge:0,radius:n.Radius,interval:n.Interval,maxStock:n.Maxlager,smokeAnimationNames:Array.isArray(n.Rauchfignr)?n.Rauchfignr:n.Rauchfignr?[n.Rauchfignr]:[]}}var t,n,r,i;return t=e,(n=[{key:"getSprites",value:(i=ie(regeneratorRuntime.mark((function e(t,n,r,i,o,s,u){var c,l,d,f,p,h,m,g,v,y,b,w,x,k,S,E,R,_,A;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(c=[],l=[],d=i%2==0?this.size.x:this.size.y,f=i%2==0?this.size.y:this.size.x,p=0;p<f;p++)for(h=0;h<d;h++){if(m=r.x+h,g=r.y+p,v=V.fieldPosToWorldPos(new a.Point(m,g)),y=v.x,b=v.y,w=void 0,0===this.animAdd||-1===this.animTime)x=this.getTexture(h,p,i,o,s),w=new a.Sprite(x);else{for(k=[],S=0;S<this.animAnz;S++)k.push(this.getTexture(h,p,i,S,s));(E=new a.AnimatedSprite(k)).animationSpeed=1/60*(1e3/this.animTime),E.play(),w=E}w.anchor.set(0,1),w.x=y,w.y=b+this.yOffset,l.push({sprite:w,pixelPosition:new a.Point(w.x,w.y),mapPosition:new a.Point(m,g),mapPositionOnIsland:new a.Point(m-n.x,g-n.y)})}if(!this.production.smokeAnimationNames){e.next=9;break}return R=V.fieldPosToWorldPos(new a.Point(r.x,r.y)),_=R.x,A=R.y,e.next=9,Promise.all(this.production.smokeAnimationNames.map(function(){var e=ie(regeneratorRuntime.mark((function e(n){var r,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("FAHNEKONTOR"!==n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,u.getAnimation(n);case 4:r=e.sent,o=Object.keys(r.animations).length>1?r.animations[t]:r.animations[0],(s=o.rotations[0].main).x=_-Math.floor(s.width/2)+.75*C-.25*C*(f-d+1)+Math.floor((r.config.Fahnoffs[0]*(0===i||3===i?1:-1)-r.config.Fahnoffs[1]*(0===i||1===i?1:-1))*C/2),s.y=A-N/2+(d+f-2)*N*.25+Math.floor((r.config.Fahnoffs[0]*(0===i||1===i?1:-1)+r.config.Fahnoffs[1]*(0===i||3===i?1:-1))*N/2)-Math.floor(N*r.config.Fahnoffs[2]),s.anchor=new a.Point(0,1),c.push(s),n.startsWith("RAUCH")&&(s.alpha=.7),"RAUCHGOLD"===n&&(window.FOO=s);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 9:return e.abrupt("return",{sprites:l,smokeAnimations:c});case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,a,o,s){return i.apply(this,arguments)})},{key:"getTexture",value:function(e,t,n,r,i){var a=this.gfxId;if(this.rotate>0&&(a+=n*this.size.x*this.size.y),a+=r*this.animAdd,0===n)a+=t*this.size.x+e;else if(1===n)a+=this.size.x*this.size.y-1-(e*this.size.x+(this.size.x-1-t));else if(2===n)a+=(this.size.y-1-t)*this.size.x+(this.size.x-1-e);else{if(3!==n)throw new Error("Invalid building rotation: ".concat(n,"."));a+=e*this.size.x+(this.size.x-1-t)}var o=i.get(a);if(void 0===o)throw new Error("Could not load texture ".concat(a,"."));return o}}])&&ae(t.prototype,n),r&&ae(t,r),e}();function se(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ce=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.loaded=!1,this.fieldData=new Map}var t,n,r,i,a;return t=e,(n=[{key:"load",value:(i=regeneratorRuntime.mark((function e(){var t,n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.fs.openAndGetContentAsText("/fields.json");case 3:for(e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1).objects.HAUS.items,n=0,r=Object.keys(t);n<r.length;n++)i=r[n],a=parseInt(t[i].Id,10),this.fieldData.set(a,new oe(t[i]));this.loaded=!0;case 7:case"end":return e.stop()}}),e,this)})),a=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){se(a,n,r,o,s,"next",e)}function s(e){se(a,n,r,o,s,"throw",e)}o(void 0)}))},function(){return a.apply(this,arguments)})},{key:"getFieldData",value:function(){if(!this.loaded)throw new Error("Configuration is not loaded. Call .load() first!");return this.fieldData}}])&&ue(t.prototype,n),r&&ue(t,r),e}();function le(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function de(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var fe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t}var t,n,r,i,o;return t=e,(n=[{key:"load",value:(i=regeneratorRuntime.mark((function e(){var t,n,r,i,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={ZEI20V:{size:24}},n=regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i[r],console.log("Loading font ".concat(t,".")),e.next=4,o.fs.openAndGetContentAsUint8Array("/fonts/".concat(t,"/font.xml"));case 4:return n=e.sent,e.next=7,new Promise((function(e){a.Loader.shared.add(t,"data:application/xml;base64,".concat(Object(s.e)(n))).load(e)}));case 7:console.log("Finished loading font ".concat(t,"."));case 8:case"end":return e.stop()}}),e)})),r=0,i=Object.keys(t);case 3:if(!(r<i.length)){e.next=8;break}return e.delegateYield(n(),"t0",5);case 5:r++,e.next=3;break;case 8:case"end":return e.stop()}}),e)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){le(a,n,r,o,s,"next",e)}function s(e){le(a,n,r,o,s,"throw",e)}o(void 0)}))},function(){return o.apply(this,arguments)})}])&&de(t.prototype,n),r&&de(t,r),e}();function pe(e){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function me(e,t){return!t||"object"!==pe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ve(e,t){return(ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ye=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=me(this,(e=ge(t)).call.apply(e,[this].concat(i)))).dragging=!1,n.topY=void 0,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ve(e,t)}(t,e),n=t,(r=[{key:"setSliderData",value:function(e,t,n){var r=this;this.position.set(this.position.x,this.position.y+(e-n)/2),this.topY=this.position.y,this.on("mousedown",(function(e){r.dragging=!0})),this.on("mouseup",(function(e){r.dragging=!1})),this.on("mousemove",(function(e){if(r.dragging){var t=e.data.originalEvent.offsetY-r.texture.height/2;r.position.y=r.clamp(t,r.topY,r.topY+n-r.texture.height/2)}}))}},{key:"clamp",value:function(e,t,n){return Math.min(Math.max(t,e),n)}}])&&he(n.prototype,r),i&&he(n,i),t}(a.Sprite);function be(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var xe=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stage=t,this.spriteLoader=n,this.videos=[]}var t,n,r,i,o;return t=e,(n=[{key:"render",value:(i=regeneratorRuntime.mark((function e(t,n){var r,i,o,s,u,c,l,d,f,p,h,g=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.destroyVideos(),this.stage.removeChildren(),r=new Map,i=0,o=Object.keys(t.variables);i<o.length;i++)s=o[i],u=t.variables[s],s.startsWith("BLK_")&&r.set(u,s.substring(4));c=[],l=0,d=t.objects.GADGET.items,f=regeneratorRuntime.mark((function e(){var t,i,o,s,u,f,v,y,b,w,x,k,S,E,R,_,A,I,P,O;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h[p],i=d[t],o=i.Id,s=i.Blocknr,u=i.Gfxnr,"GAD_UNUSED"!==(f=i.Kind)){e.next=8;break}return e.abrupt("return","continue");case 8:v=new a.Point(i.Pos[0],i.Pos[1]),i.Posoffs&&v.set(v.x+i.Posoffs[0],v.y+i.Posoffs[1]),y=void 0!==i.Size?new a.Point(i.Size.x,i.Size.y):null,b=void 0===i.Noselflg||0===i.Noselflg,w=i.Pressoff,(x=1===i.Reiheflg)&&m(b),m(void 0!==s),k=void 0!==i.Slidverflg,S=i.Slidoffs,E=i.Slidsize,e.t0=f,e.next="GAD_GFX"===e.t0?22:"GAD_TEXTL"===e.t0?34:"GAD_TEXTZ"===e.t0?34:"GAD_TEXTR"===e.t0?34:43;break;case 22:return e.next=24,g.spriteLoader.getTextures("TOOLS/".concat(r.get(s)));case 24:return R=e.sent,_=R.get(u),A=R.get(u+w),(I=k?new ye(_):new a.Sprite(_)).position.set(v.x,v.y),I.name="menu-".concat(o),k&&I.setSliderData(y.y,S[1],E[1]),b&&(I.buttonMode=!0,I.interactive=!0,P=n.buttons[l],x&&(0===c.length&&(I.texture=A),c.push({sprite:I,activeTexture:A,defaultTexture:_})),I.on("mousedown",(function(){if(I.texture=A,x){var e=!0,t=!1,n=void 0;try{for(var r,i=c[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;a.sprite!==I&&(a.sprite.texture=a.defaultTexture)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}P(g.stage)})),x||I.on("mouseup",(function(){return I.texture=_})),l++),g.stage.addChild(I),e.abrupt("break",44);case 34:return(O=new a.BitmapText("Here goes text!",{font:{name:"ZEI20V",size:24}})).position.set(v.x,v.y),O.pivot.set(0,24),O.name="menu-".concat(o),O.hitArea=new a.Rectangle(0,0,y.x,y.y),f.endsWith("Z")?O.pivot.set(O.x/2,O.pivot.y):f.endsWith("R"),g.stage.addChild(O),e.abrupt("break",44);case 43:console.warn("Unsupported kind: ".concat(f));case 44:case"end":return e.stop()}}),e)})),p=0,h=Object.keys(d);case 9:if(!(p<h.length)){e.next=17;break}return e.delegateYield(f(),"t0",11);case 11:if("continue"!==e.t0){e.next=14;break}return e.abrupt("continue",14);case 14:p++,e.next=9;break;case 17:n.onLoad(this.stage);case 18:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){be(a,n,r,o,s,"next",e)}function s(e){be(a,n,r,o,s,"throw",e)}o(void 0)}))},function(e,t){return o.apply(this,arguments)})},{key:"renderVideo",value:function(e,t){var n=this;e.texture.baseTexture.resource.source.addEventListener("ended",(function(){n.stage.removeChild(e),t()}),{once:!0}),this.stage.addChild(e),this.videos.push(e)}},{key:"renderVideoFullscreen",value:function(e,t){var n=this;this.destroyVideos(),this.stage.removeChildren(),e.texture.baseTexture.resource.source.addEventListener("ended",(function(){n.stage.removeChild(e),t()}),{once:!0}),e.scale.set(2,2);var r=512-e.texture.width*e.scale.x/2,i=384-e.texture.height*e.scale.y/2;e.position.set(r,i),this.stage.addChild(e)}},{key:"destroyVideos",value:function(){this.videos.forEach((function(e){return e.destroy({texture:!0,baseTexture:!0})})),this.videos=[]}}])&&we(t.prototype,n),r&&we(t,r),e}(),ke=n("aNYc"),Se=n.n(ke);function Ee(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Re(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function _e(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Re(a,r,i,o,s,"next",e)}function s(e){Re(a,r,i,o,s,"throw",e)}o(void 0)}))}}var Ae=function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.configLoader=t,this.spriteLoader=n,this.animationRenderer=r,this.inited=!1,this.fields=new Map,this.textures=new Map,this.lock=new Se.a,this.init=_e(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.lock.acquire("init",_e(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.inited){e.next=6;break}return e.next=3,i.spriteLoader.getTextures("STADTFLD");case 3:i.textures=e.sent,i.fields=i.configLoader.getFieldData(),i.inited=!0;case 6:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)}))),this.getIslandSprites=function(){var e=_e(regeneratorRuntime.mark((function e(t){var n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.init();case 2:n=[],r=Object(s.d)(t.size.x,t.size.y),a=0;case 5:if(!(a<t.size.x)){e.next=16;break}o=0;case 7:if(!(o<t.size.y)){e.next=13;break}return e.next=10,i.loadSpritesOfField(t,a,o,r,n);case 10:o++,e.next=7;break;case 13:a++,e.next=5;break;case 16:return e.abrupt("return",{sprites:r,smokeSprites:n});case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.loadSpritesOfField=function(){var e=_e(regeneratorRuntime.mark((function e(t,n,r,o,s){var u,c,l,d,f,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(u=t.fields[n][r])){e.next=3;break}return e.abrupt("return");case 3:if(void 0!==(c=i.fields.get(u.fieldId))){e.next=6;break}throw new Error("Could not load config for ".concat(u.fieldId,"."));case 6:return l=new a.Point(t.position.x+n,t.position.y+r),e.next=9,c.getSprites(u.playerId,t.position,l,u.rotation,u.ani,i.textures,i.animationRenderer);case 9:d=e.sent,f=d.sprites,p=d.smokeAnimations,f.forEach((function(e){var t=e.mapPositionOnIsland,n=t.x,r=t.y;null===o[n][r]&&(o[n][r]=e)})),s.push.apply(s,Ee(p));case 14:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()};function Ie(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Pe(e){return Oe.apply(this,arguments)}function Oe(){var e;return e=regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=document.createElement("video")).src="data:video/mp4;base64,".concat(Object(s.e)(t)),r=a.Texture.from(n),e.next=5,new Promise((function(e,t){r.baseTexture.addListener("loaded",e),r.baseTexture.addListener("error",t)}));case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})),(Oe=function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Ie(a,r,i,o,s,"next",e)}function s(e){Ie(a,r,i,o,s,"throw",e)}o(void 0)}))}).apply(this,arguments)}function Te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ce,Ne,Ge=function(){var e,t,n;function r(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.type=e,this.ready=t,this.hp=n}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read8(),n=e.read8();e.read16();var i=e.read16();return e.read16(),new r(t,0!=(16&n),i)}}],(t=null)&&Te(e.prototype,t),n&&Te(e,n),r}();function je(e){var t=e.read8(),n=new a.Point(e.read8(),e.read8());e.read8(),e.read32();var r=e.read16(),i=e.read16(),o=e.read16();e.read16();var s=function(e){for(var t=[],n=0;n<8;n++)t.push(Ge.fromSaveGame(e));return t}(e);return e.read(32),{islandId:t,position:n,numSwords:r,numMuscets:i,numCanons:o,units:s}}function Fe(e){for(var t=e.read8(),n=e.read8(),r=e.read16(),i=!e.read8Bool(),a=(e.read(87),[]),o=0;o<5;o++)a.push(e.read32());e.read(15);for(var s=[],u=0;u<5;u++)s.push(e.read8());e.read(3);return{islandId:t,playerId:r,cityIslandNum:n,progressAllowed:i,inhabitants:a,taxes:s,name:e.readString(33)}}function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Iron=2]="Iron",e[e.Gold=3]="Gold"}(Ce||(Ce={})),function(e){e[e.Small=1]="Small",e[e.Big=0]="Big"}(Ne||(Ne={}));var Me,Le,Be=function(){var e,t,n;function r(e,t,n,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.kind=e,this.size=t,this.amount=n,this.position=i,this.discoveredBy=a}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read8(),n=new a.Point(e.read8(),e.read8()),i=e.read8(),o=e.read8();return e.read8(),new r(t,o,e.read16(),n,i)}}],(t=null)&&De(e.prototype,t),n&&De(e,n),r}();function He(e,t,n,r,i){i.read8();var o=new a.Point(i.read8(),i.read8());return{id:e,position:t,size:o,positionRect:new a.Rectangle(t.x,t.y,o.x,o.y),numBaseIsland:r,numOreLocations:0,oreLocations:[],fertility:{tobacco:!1,sugarcane:!1,wine:!1,cotton:!1,cacao:!1,spice:!1},isSouth:n,differsFromBaseIsland:!1,fertilityDiscovered:!1,fields:[]}}function Ue(e,t,n,r,i){return He(e,t,n,r,i)}function ze(e,t,n,r,i){return He(e,t,n,r,i)}function We(e){var t=e.read8(),n=e.read8(),r=e.read8(),i=(e.read8(),e.read16()),o=e.read16();e.read16(),e.read16(),e.read(8);m(e.read(3).every((function(e){return 0===e})));e.read8(),e.read8Bool(),e.read8();var s=e.read8(),u=e.read8(),c=[Be.fromSaveGame(e),Be.fromSaveGame(e)],l=(e.read(48),function(e){return{tobacco:(e&1<<Me.TOBACCO)>0,sugarcane:(e&1<<Me.SUGARCANE)>0,wine:(e&1<<Me.WINE)>0,cotton:(e&1<<Me.COTTON)>0,cacao:(e&1<<Me.CACAO)>0,spice:(e&1<<Me.SPICE)>0}}(e.read32())),d=e.read16(),f=(e.read16(),e.read8Bool()),p=e.read8Bool();e.read8(),e.read8(),e.read32(),e.read32();e.read32();return{id:t,position:new a.Point(i,o),size:new a.Point(n,r),positionRect:new a.Rectangle(i,o,n,r),numBaseIsland:d,numOreLocations:s,oreLocations:c,fertility:l,isSouth:f,differsFromBaseIsland:p,fertilityDiscovered:0!==u,fields:[]}}function Ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.TOBACCO=1]="TOBACCO",e[e.SUGARCANE=3]="SUGARCANE",e[e.WINE=5]="WINE",e[e.COTTON=4]="COTTON",e[e.CACAO=6]="CACAO",e[e.SPICE=2]="SPICE"}(Me||(Me={})),function(e){e[e.None=0]="None",e[e.Sell=1]="Sell",e[e.Buy=2]="Buy"}(Le||(Le={}));var Ke,Ve=function(){var e,t,n;function r(e,t,n,i,a,o,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.goodId=e,this.sellingPrice=t,this.buyingPrice=n,this.wantedSellingAmount=i,this.wantedBuyingAmount=a,this.currentAmount=o,this.action=s}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read32(),n=(1023&t)>>0,i=(1047552&t)>>10,a=(4293918720&t)>>20,o=(e.read32(),e.read16()>>5),s=e.read16()>>5,u=e.read16()>>5,c=(e.read16(),e.read16());return e.read16(),new r(c,n,i,o,s,u,a)}}],(t=null)&&Ze(e.prototype,t),n&&Ze(e,n),r}();function qe(e){return{islandId:e.read8(),position:new a.Point(e.read8(),e.read8()),playerId:e.read8(),goods:function(e){for(var t=[],n=0;n<2;n++)Ve.fromSaveGame(e);for(var r=2;r<25;r++)t.push(Ve.fromSaveGame(e));for(var i=25;i<50;i++)Ve.fromSaveGame(e);return t}(e)}}function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Inactive=0]="Inactive",e[e.OfferedByMe=1]="OfferedByMe",e[e.OfferedByOther=2]="OfferedByOther",e[e.Active=3]="Active"}(Ke||(Ke={}));var Xe,Je=function(){var e,t,n;function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.state=e,this.time=t}return e=r,n=[{key:"fromSaveGame",value:function(e){return new r(e.read32(),e.read32())}}],(t=null)&&Ye(e.prototype,t),n&&Ye(e,n),r}();function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Xe||(Xe={});var Qe,et,tt=function(){var e,t,n;function r(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.kind=e,this.otherPlayerId=t,this.time=n}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read8(),n=e.read8();return m(0===e.read16()),new r(t,n,e.read32())}}],(t=null)&&$e(e.prototype,t),n&&$e(e,n),r}();function nt(e){var t=e.read32S(),n=e.read8(),r=e.read8(),i=(e.read8(),e.read8()),a=e.read8();m(0===e.read8());var o=e.read16(),s=e.read8(),u=e.read8(),c=e.read8Bool(),l=e.read8Bool(),d=e.read16(),f=e.read16(),p=e.read16(),h=e.read16(),g=e.read16(),v=e.read16(),y=e.read8(),b=e.read8(),w=(1&b)>0,x=(2&b)>0,k=e.read(6),S=e.read8()/32+1,E=e.read8()/32+1;m(e.read(14).every((function(e){return 0===e})));var R=e.read32(),_=e.read16(),A=e.read16();m(4294967295===e.read32());e.read(264);for(var I=[],P=0;P<3;P++)I.push(Je.fromSaveGame(e));for(var O=[],T=0;T<3;T++)O.push(Je.fromSaveGame(e));e.read(72);for(var C=[],N=0;N<64;N++)C.push(tt.fromSaveGame(e));var G=e.readString(64),j=e.readString(48);return console.log("player ".concat(r,":  "),a,o,u,y,k),{id:r,kind:n,color:i,fullName:G,shortName:j,tradeContracts:I,peaceContracts:O,money:t,enemiesDefeated:d,triumphArchesBuilt:f,soldiersKilled:p,soldiersFallen:h,shipsSunken:g,shipsKilled:v,accessibleBuildings:R,statues:_,statuesBuilt:A,palaceBuilt:c,cathedralBuilt:l,enablePositiveWillInfluence:w,enableNegativeWillInfluence:x,positiveWillInfluence:S,negativeWillInfluence:E,assignedTaskId:s,playerEvents:C}}function rt(e){var t=e.read8(),n=new a.Point(e.read8(),e.read8()),r=e.read8(),i=e.read8(),o=Math.floor(e.read16()/32);m(Number.isInteger(o)),e.read8();var s=e.read16(),u=Math.floor(e.read16()/32),c=Math.floor(e.read16()/32);m(Number.isInteger(c)),m(Number.isInteger(u)),e.read8();var l=e.read8(),d=e.read16()/32,f=e.read16(),p=e.read8(),h=(1&p)>0,g=(2&p)>0,v=p>>2&15,y=0==(64&p),b=15&e.read8();return m(0===e.read16()),{islandId:t,position:n,speed:r,speedCount:i,stock:o,timer:s,firstGoodStock:c,secondGoodStock:u,producedGood:l,prodCnt:d,timeCnt:f,active:h,connectedToMarket:g,animCnt:v,allowGoodPickup:y,noGoodCnt:b}}function it(e){var t=new a.Point(e.read16()/2,e.read16()/2),n=e.read16(),r=e.read16(),i=e.read16(),o=(e.read(4),e.read16(),e.read16(),e.read8(),e.read8(),e.read32(),e.read8()),s=(e.read8(),e.read8(),e.read8()),u=(e.read8(),e.read8Bool());e.read(4),e.read(4),e.read(30);return{id:i,playerId:o,type:r,position:t,rotation:s,isPatrolling:u,hp:n}}function at(e){var t=e.read32(),n=e.read(28),r=e.read8();m(0===e.read8());var i=e.read8();m(0===e.read8());var a=e.read8();m(e.read(6).every((function(e){return 0===e})));var o=[];e.read8Bool()&&o.push("any"),e.read8Bool()&&o.push("red"),e.read8Bool()&&o.push("blue"),e.read8Bool()&&o.push("yellow"),e.read8Bool()&&o.push("white"),e.read8Bool()&&o.push("trader"),e.read8Bool()&&o.push("pirate"),e.read8Bool()&&o.push("native");for(var s=e.read(25),u=e.read32(),c=e.read32(),l=e.read32(),d=e.read(16),f=e.readString(2048),p=e.read(8),h=[],g=0;g<3;g++)h.push({count:e.read32(),requiredLevel:e.read32(),requiredLevelCount:e.read32()});var v=e.read(36),y={count:e.read32(),requiredLevel:e.read32(),requiredLevelCount:e.read32()};return console.log("task",t,n,s,d,p,v),{id:t,text:f,successVideoId:c,playersToKill:o,requiredBalance:u,requiredTradeBalance:l,ownCityReachInhabitants:h,helpOtherToReachInhabitantsPlayerId:a,helpOtherToReachInhabitants:y,monopolyGoodId1:r,monopolyGoodId2:i}}function ot(e){var t=e.read8(),n=e.read8(),r=e.read8(),i=e.read8(),a=e.read8();m(e.read(63).every((function(e){return 0===e})));var o=e.read(32),s=e.read(32),u=e.read32(),c=e.read32(),l=e.read32(),d=e.read32(),f=e.read32(),p=e.read32(),h=e.read32(),g=e.read32(),v=e.read8(),y=e.read8(),b=e.read8(),w=e.read8(),x=e.read32(),k=0==(64&x),S=0==(8&x),E=0==(4&x),R=0==(1&x),_=0==(256&x),A=e.read32(),I=e.read32(),P=e.read32(),O=e.read32(),T=e.read32(),C=e.read32();e.read(4),e.read(4);var N=e.read32(),G=e.read32();e.read(49,4);var j={cntCity:t,cntIsland:n,cntShipyard:r,cntMilitary:i,cntProduction:a,cntSettlers:o,cntGrowth:s,timeCity:u,timeIsland:c,timeShipyard:l,timeMilitary:d,timeProduction:f,timeGoodToolsCnt:p,timeGoodToolsMax:h,timeGame:g,noErzOutFlg:v,tutorFlg:y,aiLevel:b,missionNumber:w,gameId:A,cityNameNumber:I,timeNextDrought:P,timePirateSec:O,missionSubNumber:T,shipMax:C,timeNextVulcano:N,cntVulcano:G,timeSettlers:e.read(32,4),timeGrowth:e.read(32,4),enableTrader:k,bigIronRunsOut:S,enableDroughts:E,enablePirate:R,enableVulcano:_};return console.log(j),j}function st(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.HUMAN=0]="HUMAN",e[e.AI=9]="AI",e[e.TRADER=13]="TRADER",e[e.PIRATE=14]="PIRATE",e[e.NATIVE=11]="NATIVE"}(Qe||(Qe={})),function(e){e[e.Swordsman=0]="Swordsman",e[e.Cavalry=1]="Cavalry",e[e.Musketeer=2]="Musketeer",e[e.Gunner=3]="Gunner",e[e.Native=8]="Native"}(et||(et={}));var ut=function(){var e,t,n;function r(e,t,n,i,a,o,s,u,c,l,d,f,p){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.numNativesNorth=e,this.numNativesSouth=t,this.numBigIronOre=n,this.numSmallIronOre=i,this.numGoldOre=a,this.numWine=o,this.numSugarCane=s,this.numSpice=u,this.numCacao=c,this.numTobacco=l,this.numCotton=d,this.numTreasures=f,this.islandTemplates=p}return e=r,n=[{key:"fromSaveGame",value:function(e){for(var t=e.slice(100),n=t[64],i=t[68],o=e.read32(),s=e.slice(268),u=s[46],c=s[54],l=s[62],d=s[110],f=s[95],p=s[86],h=s[118],g=s[78],v=s[102],y=s[174],b=[],w=0;w<o;w++){var x=e.read8(),k=0===x,S=1===x,E=e.read8();if(E<0||E>4)throw new Error("Invalid island size category: ".concat(E,"."));m(0===e.read8());var R=e.read8(),_=e.read16();m(0===e.read16());var A=new a.Point(e.read32(),e.read32());b.push({num:R,size:E,position:A,climate:k?"NORTH":S?"SOUTH":"ANY",numBaseIsland:_})}var I=!0,P=!1,O=void 0;try{for(var T,C=e.slice(e.length-e.position())[Symbol.iterator]();!(I=(T=C.next()).done);I=!0)m(0===T.value)}catch(e){P=!0,O=e}finally{try{I||null==C.return||C.return()}finally{if(P)throw O}}return new r(n,i,u,c,l,d,f,p,h,g,v,y,b)}},{key:"empty",value:function(){return new r(0,0,0,0,0,0,0,0,0,0,0,0,[])}}],(t=null)&&st(e.prototype,t),n&&st(e,n),r}();function ct(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var dt=function(){var e,t,n;function r(e,t,n){ct(this,r),this.type=e,this.length=t,this.data=void 0,this.data=new o.a(n.slice(t))}return e=r,n=[{key:"empty",value:function(e){return new r(e,0,new o.a(new Uint8Array))}},{key:"fromStream",value:function(e){return new r(e.readString(16),e.read32(),e)}}],(t=null)&&lt(e.prototype,t),n&&lt(e,n),r}();function ft(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function pt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ht(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var mt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islandLoader=t}var t,n,r,i,a;return t=e,(n=[{key:"populateWorld",value:(i=regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u,c,l,d,f,p,h,g,v,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Math.max.apply(Math,ft(t.islands.map((function(e){return e.id}))))+1,i=!0,a=!1,o=void 0,e.prev=4,s=n.islandTemplates[Symbol.iterator]();case 6:if(i=(u=s.next()).done){e.next=46;break}if(65535!==(c=u.value).numBaseIsland){e.next=14;break}return e.next=11,this.islandLoader.loadRandomIslandFile(c.size,c.climate);case 11:e.t0=e.sent,e.next=20;break;case 14:return e.t1="SOUTH"===c.climate,e.t2=c.numBaseIsland,e.next=18,this.islandLoader.loadIslandFileNum({isSouth:"SOUTH"===c.climate,numBaseIsland:c.numBaseIsland,size:c.size});case 18:e.t3=e.sent,e.t0={isSouth:e.t1,id:e.t2,data:e.t3};case 20:for(l=e.t0,d=l.data,f=l.isSouth,p=l.id,h=[];!d.eof();)h.push(dt.fromStream(d));m(void 0!==(g=h.find((function(e){return["INSEL5","INSEL4","INSEL3"].includes(e.type)})))),m(void 0!==(v=h.find((function(e){return"INSELHAUS"===e.type})))),y=void 0,e.t4=g.type,e.next="INSEL5"===e.t4?34:"INSEL4"===e.t4?36:"INSEL3"===e.t4?38:40;break;case 34:return y=ze(r++,c.position,f,p,g.data),e.abrupt("break",41);case 36:return y=Ue(r++,c.position,f,p,g.data),e.abrupt("break",41);case 38:return y=He(r++,c.position,f,p,g.data),e.abrupt("break",41);case 40:throw new Error("This code cannot be reached.");case 41:this.islandLoader.setIslandFields(y,[v]),t.islands.push(y);case 43:i=!0,e.next=6;break;case 46:e.next=52;break;case 48:e.prev=48,e.t5=e.catch(4),a=!0,o=e.t5;case 52:e.prev=52,e.prev=53,i||null==s.return||s.return();case 55:if(e.prev=55,!a){e.next=58;break}throw o;case 58:return e.finish(55);case 59:return e.finish(52);case 60:case"end":return e.stop()}}),e,this,[[4,48,52,60],[53,,55,59]])})),a=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){pt(a,n,r,o,s,"next",e)}function s(e){pt(a,n,r,o,s,"throw",e)}o(void 0)}))},function(e,t){return a.apply(this,arguments)})}])&&ht(t.prototype,n),r&&ht(t,r),e}();function gt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function vt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function yt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){vt(a,r,i,o,s,"next",e)}function s(e){vt(a,r,i,o,s,"throw",e)}o(void 0)}))}}function bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var wt,xt,kt,St,Et,Rt,_t,At,It,Pt,Ot,Tt,Ct,Nt,Gt,jt,Ft,Dt,Mt,Lt,Bt,Ht,Ut,zt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islandLoader=t,this.worldGenerator=void 0,this.worldGenerator=t?new mt(t):null}var t,n,r,i,a,o;return t=e,(n=[{key:"parse",value:function(e){for(var t=new Map;!e.eof();){var n=dt.fromStream(e);if("INSELHAUS"!==n.type)t.has(n.type)||t.set(n.type,[]),t.get(n.type).push(n);else{var r=t.get("INSEL5")[t.get("INSEL5").length-1];void 0===r.inselHausBlocks&&(r.inselHausBlocks=[]),r.inselHausBlocks.push(n)}}return t}},{key:"getWorld",value:(o=yt(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.parse(t),e.next=3,this.doParse(n);case 3:return r=e.sent,i=r.world,a=r.worldGenerationSettings,e.next=8,this.worldGenerator.populateWorld(i,a);case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"doParse",value:(a=yt(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,d,f,p,h,v,y,b,w,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(gt(t.keys()).filter((function(e){return void 0!==t.get(e).find((function(e){return e.length>0}))})).map((function(e){return[e,t.get(e)]}))),n="",t.has("NAME")&&(r=t.get("NAME")[0],n=r.data.readString(r.length)),i=t.get("PLAYER4")[0],a=this.parsePlayers(i),o=t.has("INSEL5")?t.get("INSEL5"):[],e.next=8,this.parseIslands(o);case 8:return s=e.sent,u=this.handleBlock(t,"AUFTRAG4",at),c=this.handleBlock(t,"SHIP4",U),l=this.handleBlock(t,"SOLDAT3",it),d=this.handleBlock(t,"KONTOR2",qe),f=this.handleBlock(t,"MILITAR",je),p=this.handleBlock(t,"STADT4",Fe),h=this.handleBlock(t,"PRODLIST2",rt),v=null,t.has("HANDLER")&&t.get("HANDLER")[0].length>0&&(k=t.get("HANDLER")[0].data,S=void 0,E=void 0,R=void 0,_=void 0,S=k.read32(),E=k.read(20),R=function(e){for(var t=[],n=0;n<24;n++)t.push({goodId:e.read32(),_1:e.read32(),_2:e.read32()});return t}(k),_=k.read(292),console.log("trader",S,E,R,_),v={goods:R}),m(t.has("TIMERS")),m(1===t.get("TIMERS").length),y=ot(t.get("TIMERS")[0].data),b=ut.empty(),t.has("SZENE")&&(w=t.get("SZENE")[0].data,b=ut.fromSaveGame(w)),x=new g(s,a,u,n,l,c,d,f,p,v,y,h),e.abrupt("return",{world:x,worldGenerationSettings:b});case 25:case"end":return e.stop()}var k,S,E,R,_}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"handleBlock",value:function(e,t,n){if(!e.has(t))return[];var r=[],i=!0,a=!1,o=void 0;try{for(var s,u=e.get(t)[Symbol.iterator]();!(i=(s=u.next()).done);i=!0)for(var c=s.value;!c.data.eof();)r.push(n(c.data))}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}return r}},{key:"parseIslands",value:(i=yt(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,d,f,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],this.islandLoader){e.next=3;break}return e.abrupt("return",n);case 3:r=!0,i=!1,a=void 0,e.prev=6,o=t[Symbol.iterator]();case 8:if(r=(s=o.next()).done){e.next=32;break}if(u=s.value,c=We(u.data),l=void 0!==u.inselHausBlocks?u.inselHausBlocks:[],d=dt.empty("INSELHAUS"),f=void 0,c.differsFromBaseIsland||!(l.length<=1)){e.next=24;break}return 1===l.length&&(d=l[0]),e.next=18,this.islandLoader.loadIslandFile(c);case 18:p=e.sent,dt.fromStream(p),m("INSELHAUS"===(f=dt.fromStream(p)).type),e.next=27;break;case 24:m(l.length>=1&&l.length<=2),f=l[0],2===l.length&&(d=l[1]);case 27:this.islandLoader.setIslandFields(c,[f,d]),n.push(c);case 29:r=!0,e.next=8;break;case 32:e.next=38;break;case 34:e.prev=34,e.t0=e.catch(6),i=!0,a=e.t0;case 38:e.prev=38,e.prev=39,r||null==o.return||o.return();case 41:if(e.prev=41,!i){e.next=44;break}throw a;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return e.abrupt("return",n);case 47:case"end":return e.stop()}}),e,this,[[6,34,38,46],[39,,41,45]])}))),function(e){return i.apply(this,arguments)})},{key:"parsePlayers",value:function(e){for(var t=[];!e.data.eof();)t.push(nt(e.data));return t}}])&&bt(t.prototype,n),r&&bt(t,r),e}();!function(e){e[e["menu.divider.orginal_missions"]=85]="menu.divider.orginal_missions",e[e["menu.divider.missions"]=86]="menu.divider.missions",e[e["menu.divider.new_missions"]=87]="menu.divider.new_missions",e[e["menu.divider.custom_missions"]=88]="menu.divider.custom_missions",e[e.exit_game=89]="exit_game",e[e.exit_game_question=90]="exit_game_question"}(wt||(wt={})),xt||(xt={}),function(e){e[e["player.color.red"]=0]="player.color.red",e[e["player.color.blue"]=1]="player.color.blue",e[e["player.color.yellow"]=2]="player.color.yellow",e[e["player.color.white"]=3]="player.color.white"}(kt||(kt={})),function(e){e[e["videos.event"]=0]="videos.event",e[e["videos.battle"]=1]="videos.battle",e[e["videos.diplomacy"]=2]="videos.diplomacy"}(St||(St={})),function(e){e[e["speech.event"]=0]="speech.event",e[e["speech.island_status"]=1]="speech.island_status",e[e["speech.player"]=2]="speech.player",e[e["speech.trade"]=3]="speech.trade",e[e["speech.battle"]=4]="speech.battle",e[e["speech.order"]=5]="speech.order",e[e["speech.diplomacy"]=6]="speech.diplomacy"}(Et||(Et={})),function(e){e[e["path.custom_missions"]=0]="path.custom_missions"}(Rt||(Rt={})),function(e){e[e["endless.difficulty.easy"]=0]="endless.difficulty.easy",e[e["endless.difficulty.medium"]=1]="endless.difficulty.medium",e[e["endless.difficulty.difficult"]=2]="endless.difficulty.difficult",e[e["endless.difficulty.hard"]=3]="endless.difficulty.hard"}(_t||(_t={})),function(e){e[e["tutorial.mission_0"]=0]="tutorial.mission_0",e[e["tutorial.mission_1"]=1]="tutorial.mission_1",e[e["tutorial.mission_2"]=2]="tutorial.mission_2",e[e["tutorial.mission_3"]=3]="tutorial.mission_3",e[e["tutorial.mission_4"]=4]="tutorial.mission_4"}(At||(At={})),function(e){e[e["campaign.0.mission_0"]=0]="campaign.0.mission_0",e[e["campaign.0.mission_1"]=1]="campaign.0.mission_1",e[e["campaign.0.mission_2"]=2]="campaign.0.mission_2",e[e["campaign.0.mission_3"]=3]="campaign.0.mission_3",e[e["campaign.0.mission_4"]=4]="campaign.0.mission_4",e[e["campaign.1.mission_0"]=5]="campaign.1.mission_0",e[e["campaign.1.mission_1"]=6]="campaign.1.mission_1",e[e["campaign.1.mission_2"]=7]="campaign.1.mission_2",e[e["campaign.1.mission_3"]=8]="campaign.1.mission_3",e[e["campaign.1.mission_4"]=9]="campaign.1.mission_4",e[e["campaign.2.mission_0"]=10]="campaign.2.mission_0",e[e["campaign.2.mission_1"]=11]="campaign.2.mission_1",e[e["campaign.2.mission_2"]=12]="campaign.2.mission_2",e[e["campaign.2.mission_3"]=13]="campaign.2.mission_3",e[e["campaign.2.mission_4"]=14]="campaign.2.mission_4",e[e["campaign.3.mission_0"]=15]="campaign.3.mission_0",e[e["campaign.3.mission_1"]=16]="campaign.3.mission_1",e[e["campaign.3.mission_2"]=17]="campaign.3.mission_2",e[e["campaign.3.mission_3"]=18]="campaign.3.mission_3",e[e["campaign.3.mission_4"]=19]="campaign.3.mission_4",e[e["campaign.4.mission_0"]=20]="campaign.4.mission_0",e[e["campaign.4.mission_1"]=21]="campaign.4.mission_1",e[e["campaign.4.mission_2"]=22]="campaign.4.mission_2",e[e["campaign.4.mission_3"]=23]="campaign.4.mission_3",e[e["campaign.4.mission_4"]=24]="campaign.4.mission_4",e[e["campaign.5.mission_0"]=25]="campaign.5.mission_0",e[e["campaign.5.mission_1"]=26]="campaign.5.mission_1",e[e["campaign.5.mission_2"]=27]="campaign.5.mission_2",e[e["campaign.5.mission_3"]=28]="campaign.5.mission_3",e[e["campaign.5.mission_4"]=29]="campaign.5.mission_4"}(It||(It={})),function(e){e[e["figure.unused"]=0]="figure.unused",e[e["figure.infantry"]=1]="figure.infantry",e[e["figure.cavalry"]=2]="figure.cavalry",e[e["figure.musketeer"]=3]="figure.musketeer",e[e["figure.artiellery"]=4]="figure.artiellery"}(Pt||(Pt={})),function(e){e[e["good.empty"]=0]="good.empty",e[e["good.each"]=1]="good.each",e[e["good.iron_ore"]=2]="good.iron_ore",e[e["good.gold_ore"]=3]="good.gold_ore",e[e["good.wool"]=4]="good.wool",e[e["good.sugarcane"]=5]="good.sugarcane",e[e["good.tobacco"]=6]="good.tobacco",e[e["good.cattle"]=7]="good.cattle",e[e["good.grain"]=8]="good.grain",e[e["good.flour"]=9]="good.flour",e[e["good.iron"]=10]="good.iron",e[e["good.swords"]=11]="good.swords",e[e["good.muskets"]=12]="good.muskets",e[e["good.cannons"]=13]="good.cannons",e[e["good.food"]=14]="good.food",e[e["good.tobacco_products"]=15]="good.tobacco_products",e[e["good.spices"]=16]="good.spices",e[e["good.cocoa"]=17]="good.cocoa",e[e["good.liquor"]=18]="good.liquor",e[e["good.cloth"]=19]="good.cloth",e[e["good.clothes"]=20]="good.clothes",e[e["good.jewlry"]=21]="good.jewlry",e[e["good.tools"]=22]="good.tools",e[e["good.wood"]=23]="good.wood",e[e["good.bricks"]=24]="good.bricks"}(Ot||(Ot={})),function(e){e[e["rohst.grain"]=0]="rohst.grain",e[e["rohst.tobacco"]=1]="rohst.tobacco",e[e["rohst.spices"]=2]="rohst.spices",e[e["rohst.sugarcane"]=3]="rohst.sugarcane",e[e["rohst.cotton"]=4]="rohst.cotton",e[e["rohst.vines"]=5]="rohst.vines",e[e["rohst.cocoa"]=6]="rohst.cocoa",e[e["rohst.grazing_land"]=7]="rohst.grazing_land",e[e["rohst.tree"]=8]="rohst.tree",e[e["rohst.stones"]=9]="rohst.stones",e[e["rohst.ores"]=10]="rohst.ores",e[e["rohst.wild_game"]=11]="rohst.wild_game",e[e["rohst.fish"]=12]="rohst.fish"}(Tt||(Tt={})),function(e){e[e["rohst_field.grain"]=0]="rohst_field.grain",e[e["rohst_field.tobacco"]=1]="rohst_field.tobacco",e[e["rohst_field.spices"]=2]="rohst_field.spices",e[e["rohst_field.sugarcane"]=3]="rohst_field.sugarcane",e[e["rohst_field.cotton"]=4]="rohst_field.cotton",e[e["rohst_field.vines"]=5]="rohst_field.vines",e[e["rohst_field.cocoa"]=6]="rohst_field.cocoa",e[e["rohst_field.grazing_land"]=7]="rohst_field.grazing_land",e[e["rohst_field.tree"]=8]="rohst_field.tree",e[e["rohst_field.stones"]=9]="rohst_field.stones",e[e["rohst_field.ores"]=10]="rohst_field.ores",e[e["rohst_field.wild_game"]=11]="rohst_field.wild_game",e[e["rohst_field.fish"]=12]="rohst_field.fish"}(Ct||(Ct={})),function(e){e[e["buildings.military.wooden.wall"]=0]="buildings.military.wooden.wall",e[e["buildings.military.wooden.gate"]=1]="buildings.military.wooden.gate",e[e["buildings.military.wooden.watchtower"]=2]="buildings.military.wooden.watchtower",e[e["buildings.military.stone.wall"]=3]="buildings.military.stone.wall",e[e["buildings.military.stone.gate"]=4]="buildings.military.stone.gate",e[e["buildings.military.stone.watchtower"]=5]="buildings.military.stone.watchtower",e[e["buildings.military.stone.gate_big"]=6]="buildings.military.stone.gate_big",e[e["buildings.military.castle.small"]=7]="buildings.military.castle.small",e[e["buildings.military.castle.medium"]=8]="buildings.military.castle.medium",e[e["buildings.military.castle.large"]=9]="buildings.military.castle.large"}(Nt||(Nt={})),function(e){e[e["buildings.house.house"]=0]="buildings.house.house"}(Gt||(Gt={})),function(e){e[e["buildings.street.dirt.street"]=0]="buildings.street.dirt.street",e[e["buildings.street.stone.street"]=1]="buildings.street.stone.street",e[e["buildings.street.dirt.bridge"]=2]="buildings.street.dirt.bridge",e[e["buildings.street.stone.bridge"]=3]="buildings.street.stone.bridge",e[e["buildings.street.square.0"]=4]="buildings.street.square.0",e[e["buildings.street.square.1"]=5]="buildings.street.square.1",e[e["buildings.street.square.2"]=6]="buildings.street.square.2",e[e["buildings.street.square.3"]=7]="buildings.street.square.3"}(jt||(jt={})),function(e){e[e["buildings.mine.quarry"]=0]="buildings.mine.quarry",e[e["buildings.mine.iron"]=1]="buildings.mine.iron",e[e["buildings.mine.iron_deep"]=2]="buildings.mine.iron_deep",e[e["buildings.mine.gold"]=3]="buildings.mine.gold"}(Ft||(Ft={})),function(e){e[e["buildings.production.weaver"]=0]="buildings.production.weaver",e[e["buildings.production.butcher"]=1]="buildings.production.butcher",e[e["buildings.production.flour_mill"]=2]="buildings.production.flour_mill",e[e["buildings.production.bakery"]=3]="buildings.production.bakery",e[e["buildings.production.tobacco"]=4]="buildings.production.tobacco",e[e["buildings.production.distillery"]=5]="buildings.production.distillery",e[e["buildings.production.tailor"]=6]="buildings.production.tailor",e[e["buildings.production.weaving_mill"]=7]="buildings.production.weaving_mill",e[e["buildings.production.stonemason"]=8]="buildings.production.stonemason",e[e["buildings.production.water_mill"]=9]="buildings.production.water_mill",e[e["buildings.production.ore_smelter"]=10]="buildings.production.ore_smelter",e[e["buildings.production.tool_maker"]=11]="buildings.production.tool_maker",e[e["buildings.production.gold_smith"]=12]="buildings.production.gold_smith",e[e["buildings.production.armourer"]=13]="buildings.production.armourer",e[e["buildings.production.musket_maker"]=14]="buildings.production.musket_maker",e[e["buildings.production.canon_foundry"]=15]="buildings.production.canon_foundry"}(Dt||(Dt={})),function(e){e[e["buildings.farm.hunter"]=0]="buildings.farm.hunter",e[e["buildings.farm.forester"]=1]="buildings.farm.forester",e[e["buildings.field.forest"]=2]="buildings.field.forest",e[e["buildings.farm.grain"]=3]="buildings.farm.grain",e[e["buildings.field.grain"]=4]="buildings.field.grain",e[e["buildings.farm.sheep"]=5]="buildings.farm.sheep",e[e["buildings.farm.cattle"]=6]="buildings.farm.cattle",e[e["buildings.farm.tobacco"]=7]="buildings.farm.tobacco",e[e["buildings.field.tobacco"]=8]="buildings.field.tobacco",e[e["buildings.farm.spice"]=9]="buildings.farm.spice",e[e["buildings.field.spice"]=10]="buildings.field.spice",e[e["buildings.farm.wine"]=11]="buildings.farm.wine",e[e["buildings.field.wine"]=12]="buildings.field.wine",e[e["buildings.farm.sugarcane"]=13]="buildings.farm.sugarcane",e[e["buildings.field.sugarcane"]=14]="buildings.field.sugarcane",e[e["buildings.farm.cotton"]=15]="buildings.farm.cotton",e[e["buildings.field.cotton"]=16]="buildings.field.cotton",e[e["buildings.farm.cocoa"]=17]="buildings.farm.cocoa",e[e["buildings.field.cocoa"]=18]="buildings.field.cocoa"}(Mt||(Mt={})),function(e){e[e["buildings.docks.warehouse.0"]=0]="buildings.docks.warehouse.0",e[e["buildings.docks.warehouse.1"]=1]="buildings.docks.warehouse.1",e[e["buildings.docks.warehouse.2"]=2]="buildings.docks.warehouse.2",e[e["buildings.docks.warehouse.3"]=3]="buildings.docks.warehouse.3",e[e["buildings.docks.fisher"]=4]="buildings.docks.fisher",e[e["buildings.docks.dock"]=5]="buildings.docks.dock",e[e["buildings.docks.shipyard.small"]=6]="buildings.docks.shipyard.small",e[e["buildings.docks.shipyard.large"]=7]="buildings.docks.shipyard.large"}(Lt||(Lt={})),function(e){e[e["buildings.public.house"]=0]="buildings.public.house",e[e["buildings.public.marketplace"]=1]="buildings.public.marketplace",e[e["buildings.public.chapel"]=2]="buildings.public.chapel",e[e["buildings.public.church"]=3]="buildings.public.church",e[e["buildings.public.cathedral"]=4]="buildings.public.cathedral",e[e["buildings.public.tavern"]=5]="buildings.public.tavern",e[e["buildings.public.doctor"]=6]="buildings.public.doctor",e[e["buildings.public.school"]=7]="buildings.public.school",e[e["buildings.public.college"]=8]="buildings.public.college",e[e["buildings.public.bathhouse"]=9]="buildings.public.bathhouse",e[e["buildings.public.theater"]=10]="buildings.public.theater",e[e["buildings.public.firefighters"]=11]="buildings.public.firefighters",e[e["buildings.public.palace"]=12]="buildings.public.palace",e[e["buildings.public.gallows"]=13]="buildings.public.gallows",e[e["buildings.public.monument"]=14]="buildings.public.monument",e[e["buildings.public.triumphal_arch"]=15]="buildings.public.triumphal_arch"}(Bt||(Bt={})),function(e){e[e.demolish=0]="demolish"}(Ht||(Ht={})),function(e){e[e["natives.0.head_lodge"]=0]="natives.0.head_lodge",e[e["natives.0.hut.0"]=1]="natives.0.hut.0",e[e["natives.0.hut.1"]=2]="natives.0.hut.1",e[e["natives.0.hut.2"]=3]="natives.0.hut.2",e[e["natives.0.hut.3"]=4]="natives.0.hut.3",e[e["natives.1.head_lodge"]=5]="natives.1.head_lodge",e[e["natives.1.hut.0"]=6]="natives.1.hut.0",e[e["natives.1.hut.1"]=7]="natives.1.hut.1",e[e["natives.1.hut.2"]=8]="natives.1.hut.2",e[e["natives.1.hut.3"]=9]="natives.1.hut.3",e[e["natives.pyramid"]=10]="natives.pyramid",e[e["pirates.warehouse"]=11]="pirates.warehouse",e[e["pirates.1"]=12]="pirates.1",e[e["pirates.2"]=13]="pirates.2",e[e["pirates.tower"]=14]="pirates.tower",e[e["forest.mixed"]=15]="forest.mixed",e[e["forest.palm"]=16]="forest.palm"}(Ut||(Ut={}));var Wt={GAME:wt,LEISTE:xt,PATH:Rt,ENDLESSKIND:_t,PLAYCOL:kt,VIDEOKIND:St,SPEECHKIND:Et,TUTORKIND:At,KAMPAGNE:It,FIGKIND:Pt,WARE:Ot,ROHST:Tt,ROHSTFELD:Ct,MILITAR:Nt,WOHNHAUS:Gt,STRASSE:jt,BERGWERK:Ft,HANDWERK:Dt,FARM:Mt,HAFEN:Lt,DIVERS:Bt,ABRISS:Ht,LANDSCHAFT:Ut};function Zt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}var Kt=new Map;function Vt(e){return Kt.get(e)||"?"}function qt(e){return Yt.apply(this,arguments)}function Yt(){var e;return e=regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,t.openAndGetContentAsText("/translations.json");case 3:for(e.t1=e.sent,n=e.t0.parse.call(e.t0,e.t1),r=0,i=Object.keys(n);r<i.length;r++)for(s in a=i[r],o=Wt[a])parseInt(s,10)>=0&&(u=o[s],Kt.set(u,n[a][s]));case 6:case"end":return e.stop()}}),e)})),(Yt=function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Zt(a,r,i,o,s,"next",e)}function s(e){Zt(a,r,i,o,s,"throw",e)}o(void 0)}))}).apply(this,arguments)}function Xt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Jt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Xt(a,r,i,o,s,"next",e)}function s(e){Xt(a,r,i,o,s,"throw",e)}o(void 0)}))}}function $t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Qt=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.menuStructure=n,this.buttons=[this.renderNewGame.bind(this),this.renderLoadGame.bind(this),Jt(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.menuStructure.renderScreen("menu_loading");case 2:r.menuStructure.emit("load-game","/saves/lastgame.gam");case 3:case"end":return e.stop()}}),e)}))),Jt(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.menuStructure.renderScreen("menu_main"));case 1:case"end":return e.stop()}}),e)}))),function(){var e=Jt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.currentPage=Math.max(0,r.currentPage-1),e.next=3,r.renderNewGame(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=Jt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.currentPage=Math.min(Math.ceil(r.newGameLines.length/r.ROWS)-1,r.currentPage+1),e.next=3,r.renderNewGame(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()],this.ROWS=14,this.SCROLL_UP="menu-31011",this.SCROLL_DOWN="menu-31012",this.newGameLines=[],this.currentPage=0,this.gamParser=void 0,this.gamParser=new zt(null)}var t,n,r,i,a,o,s,u;return t=e,(n=[{key:"onLoad",value:(u=Jt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getNewGameLines();case 2:return e.next=4,this.renderNewGame(t);case 4:return e.next=6,this.menuStructure._playMainMenuMusic();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"renderNewGame",value:(s=Jt(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this.currentPage*this.ROWS,r=0;r<this.ROWS;r++)(i=t.getChildByName("menu-".concat(31021+r))).off("click"),i.visible=!1,i.interactive=!1,i.buttonMode=!1,r+n<this.newGameLines.length&&function(){var e=s.newGameLines[r+n];i.text=e.name,i.visible=!0,e.file&&(i.interactive=!0,i.buttonMode=!0,i.once("click",Jt(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.menuStructure.renderScreen("menu_loading");case 2:s.menuStructure.emit("load-game",e.file.fullPath);case 3:case"end":return t.stop()}}),t)})))))}();for(a=0;a<this.ROWS;a++)t.getChildByName("menu-".concat(31041+a)).visible=a+n<this.newGameLines.length&&!!this.newGameLines[a+n].file;for(o=0;o<this.ROWS;o++)t.getChildByName("menu-".concat(31061+o)).visible=!1;t.getChildByName(this.SCROLL_UP).visible=!0,t.getChildByName(this.SCROLL_DOWN).visible=!0;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"renderLoadGame",value:(o=Jt(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.ls("/saves",".gam");case 2:for(e.t0=function(e){return"lastgame.gam"!==e.name},n=e.sent.filter(e.t0),r=function(e){var r=t.getChildByName("menu-".concat(31021+e));r.visible=e<12,e<n.length?(r.text="Game".concat(e.toString().padStart(2,"0")),r.interactive=!0,r.buttonMode=!0,r.once("click",Jt(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.menuStructure.renderScreen("menu_loading");case 2:s.menuStructure.emit("load-game",n[e].fullPath);case 3:case"end":return t.stop()}}),t)}))))):r.text="Empty".concat(e.toString().padStart(2,"0"))},i=0;i<this.ROWS;i++)r(i);for(a=0;a<this.ROWS;a++)t.getChildByName("menu-".concat(31041+a)).visible=!1;for(o=0;o<this.ROWS;o++)t.getChildByName("menu-".concat(31061+o)).visible=o<12;t.getChildByName(this.SCROLL_UP).visible=!1,t.getChildByName(this.SCROLL_DOWN).visible=!1;case 11:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getNewGameLines",value:(a=Jt(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadMissions();case 2:return t=e.sent,this.newGameLines.push({name:Vt("menu.divider.orginal_missions")}),t.filter((function(e){return-1!==e.missionNum})).forEach((function(e){n.newGameLines.push({name:e.name,file:e.file})})),this.newGameLines.push({name:Vt("menu.divider.missions")}),this.newGameLines.push({name:Vt("menu.divider.new_missions")}),t.filter((function(e){return-1===e.missionNum})).forEach((function(e){n.newGameLines.push({name:e.name,file:e.file})})),this.newGameLines.push({name:Vt("menu.divider.custom_missions")}),e.next=11,this.fs.ls("/missions-custom",".szs");case 11:e.sent.forEach((function(e){n.newGameLines.push({name:e.name.replace(".szs",""),file:e})}));case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"loadMissions",value:(i=Jt(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Promise,e.next=3,this.fs.ls("/missions-original",".szs");case 3:return e.t1=function(){var e=Jt(regeneratorRuntime.mark((function e(t){var r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.fs.openAndGetContentAsStream(t);case 2:return r=e.sent,i=n.gamParser.parse(r),a=-1,i.has("SZENE_RANKING")&&(m(1===i.get("SZENE_RANKING").length),a=i.get("SZENE_RANKING")[0].data.read32()),o=-1,i.has("SZENE_KAMPAGNE")&&(m(1===i.get("SZENE_KAMPAGNE").length),o=i.get("SZENE_KAMPAGNE")[0].data.read32()),s=-1,i.has("SZENE_MISSNR")&&(m(1===i.get("SZENE_MISSNR").length),s=i.get("SZENE_MISSNR")[0].data.read32()),e.abrupt("return",{blocks:i,ranking:a,campaignNum:o,missionNum:s,name:t.name,file:t});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.t2=e.sent.map(e.t1),e.next=7,e.t0.all.call(e.t0,e.t2);case 7:return(t=e.sent).sort((function(e,t){return-1!==e.missionNum&&-1===t.missionNum?-1:-1===e.missionNum&&-1!==t.missionNum?1:-1!==e.missionNum&&-1!==t.missionNum?e.missionNum<t.missionNum?-1:e.missionNum>t.missionNum?1:0:0})),console.table(t),e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}])&&$t(t.prototype,n),r&&$t(t,r),e}();function en(e){return(en="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function nn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){tn(a,r,i,o,s,"next",e)}function s(e){tn(a,r,i,o,s,"throw",e)}o(void 0)}))}}function rn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function an(e){return(an=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function on(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function sn(e,t){return(sn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var un=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(e,t){return!t||"object"!==en(t)&&"function"!=typeof t?on(e):t}(this,an(t).call(this))).fs=e,i.gadRenderer=n,i.musicPlayer=r,i.structure={menu_main:{onLoad:function(){return i._playMainMenuMusic()},buttons:[nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.renderScreen("menu_missions"));case 1:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Multiplayer"));case 1:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.musicPlayer.stop(),e.next=3,i.loadVideoSprite(10);case 3:(t=e.sent).width=439,t.height=353,t.position.set(507,366),i.gadRenderer.renderVideo(t,(function(){return i._playMainMenuMusic}));case 8:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.loadVideoSprite(58);case 2:t=e.sent,i.musicPlayer.stop(),i.gadRenderer.renderVideoFullscreen(t,(function(){return i.renderScreen("menu_main")}));case 5:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Exit"));case 1:case"end":return e.stop()}}),e)})))]},menu_missions:new Qt(i.fs,on(i)),menu_loading:{onLoad:function(){},buttons:[]},menu_mission_details:{onLoad:function(){},buttons:[nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Start Mission"));case 1:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.renderScreen("menu_missions"));case 1:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Highscores up"));case 1:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Highscores down"));case 1:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Sub-Mission 0"));case 1:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Sub-Mission 1"));case 1:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Sub-Mission 2"));case 1:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Sub-Mission 3"));case 1:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Sub-Mission 4"));case 1:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Mission Description up"));case 1:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Mission Description down"));case 1:case"end":return e.stop()}}),e)}))),nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Mission Description Slider"));case 1:case"end":return e.stop()}}),e)})))]}},i}var n,r,i,o,s,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sn(e,t)}(t,e),n=t,(r=[{key:"renderScreen",value:(u=nn(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.fs.openAndGetContentAsText("/screens/".concat(t,".json"));case 3:return e.t1=e.sent,n=e.t0.parse.call(e.t0,e.t1),console.log(n),r=this.structure[t]||{onLoad:function(){},buttons:[]},e.next=9,this.gadRenderer.render(n,r);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"_playMainMenuMusic",value:(s=nn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.musicPlayer.play("1st Beginning",!0);case 2:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"loadVideoSprite",value:(o=nn(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.openAndGetContentAsUint8Array("/videos/".concat(t,".mp4"));case 2:return n=e.sent,e.t0=a.Sprite,e.next=6,Pe(n);case 6:return e.t1=e.sent,e.abrupt("return",e.t0.from.call(e.t0,e.t1));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})}])&&rn(n.prototype,r),i&&rn(n,i),t}(a.utils.EventEmitter);function cn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ln(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){cn(a,r,i,o,s,"next",e)}function s(e){cn(a,r,i,o,s,"throw",e)}o(void 0)}))}}function dn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var fn=n("9/1U").a.Sound,pn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.playing=!1,this.songs=[],this.currentSongIdx=void 0}var t,n,r,i,a,o,s;return t=e,(n=[{key:"load",value:(s=ln(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.ls("/music");case 2:t=e.sent,n=!0,r=!1,i=void 0,e.prev=6,a=t[Symbol.iterator]();case 8:if(n=(o=a.next()).done){e.next=25;break}return s=o.value,console.log("Loading music ".concat(s.name)),e.next=13,this.fs.openAndGetContentAsUint8Array(s);case 13:return u=e.sent.buffer,e.t0=this.songs,e.t1=s.name,e.next=18,this.loadSound(u);case 18:e.t2=e.sent,e.t3={name:e.t1,sound:e.t2},e.t0.push.call(e.t0,e.t3),console.log("Finished loading music ".concat(s.name));case 22:n=!0,e.next=8;break;case 25:e.next=31;break;case 27:e.prev=27,e.t4=e.catch(6),r=!0,i=e.t4;case 31:e.prev=31,e.prev=32,n||null==a.return||a.return();case 34:if(e.prev=34,!r){e.next=37;break}throw i;case 37:return e.finish(34);case 38:return e.finish(31);case 39:case"end":return e.stop()}}),e,this,[[6,27,31,39],[32,,34,38]])}))),function(){return s.apply(this,arguments)})},{key:"play",value:(o=ln(regeneratorRuntime.mark((function e(t){var n,r,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],void 0!==(r=this.songs.find((function(e){return e.name===t+".wav"})))){e.next=5;break}return console.warn("Song ".concat(t," not found.")),e.abrupt("return");case 5:if(r.sound.isPlaying){e.next=8;break}return e.next=8,r.sound.play({loop:n});case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"playAll",value:(a=ln(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.songs.length){e.next=3;break}return console.warn("No music to play found :("),e.abrupt("return");case 3:if(!this.playing){e.next=6;break}return console.warn("Music is already playing!"),e.abrupt("return");case 6:return this.stop(),this.playing=!0,this.currentSongIdx=-1,e.next=11,this.playNext();case 11:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"stop",value:function(){this.songs.forEach((function(e){return e.sound.stop()}))}},{key:"playNext",value:(i=ln(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentSongIdx++,this.currentSongIdx===this.songs.length&&(this.currentSongIdx=0),e.next=4,this.songs[this.currentSongIdx].sound.play(this.playNext.bind(this));case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"loadSound",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(n,r){var i=fn.from({source:e,preload:t,singleInstance:!0,loaded:function(e,i){t&&(e?r(e):n(i))}});t||n(i)}))}}])&&dn(t.prototype,n),r&&dn(t,r),e}();function hn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var mn=function(){var e,t,n;function r(e,t,n,i,a,o,s,u,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.fieldId=e,this.x=t,this.y=n,this.islandId=i,this.islandCityNum=a,this.rotation=o,this.ani=s,this.random=u,this.playerId=c}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read16()+2e4,n=e.read8(),i=e.read8(),a=e.read32(),o=a>>0&Math.pow(2,2)-1,s=a>>2&Math.pow(2,4)-1,u=a>>6&Math.pow(2,8)-1,c=a>>14&Math.pow(2,3)-1,l=a>>17&Math.pow(2,5)-1,d=a>>22&Math.pow(2,4)-1;return Math.pow(2,6),new r(t,n,i,u,c,o,s,l,d)}}],(t=null)&&hn(e.prototype,t),n&&hn(e,n),r}();function gn(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function vn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function yn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){vn(a,r,i,o,s,"next",e)}function s(e){vn(a,r,i,o,s,"throw",e)}o(void 0)}))}}function bn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}mn.saveGameDataLength=8;var wn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.fieldData=n,this.islandSizes=[{id:0,name:"lit",maxSize:35},{id:1,name:"mit",maxSize:45},{id:2,name:"med",maxSize:55},{id:3,name:"big",maxSize:85},{id:4,name:"lar",maxSize:100}]}var t,n,r,i,a,o,s,u;return t=e,(n=[{key:"loadIslandFile",value:(u=yn(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.isSouth?"south":"north",r=t.numBaseIsland.toString().padStart(2,"0"),i=!0,a=!1,o=void 0,e.prev=5,s=this.islandSizes[Symbol.iterator]();case 7:if(i=(u=s.next()).done){e.next=14;break}if(c=u.value,!(t.size.x<=c.maxSize)){e.next=11;break}return e.abrupt("return",this.fs.openAndGetContentAsStream("/islands/".concat(n,"/").concat(c.name).concat(r,".scp")));case 11:i=!0,e.next=7;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(5),a=!0,o=e.t0;case 20:e.prev=20,e.prev=21,i||null==s.return||s.return();case 23:if(e.prev=23,!a){e.next=26;break}throw o;case 26:return e.finish(23);case 27:return e.finish(20);case 28:throw new Error("Could not load island");case 29:case"end":return e.stop()}}),e,this,[[5,16,20,28],[21,,23,27]])}))),function(e){return u.apply(this,arguments)})},{key:"loadIslandFileNum",value:(s=yn(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.isSouth?"south":"north",r=t.numBaseIsland.toString().padStart(2,"0"),i=this.islandSizes.find((function(e){return e.id===t.size})),e.abrupt("return",this.fs.openAndGetContentAsStream("/islands/".concat(n,"/").concat(i.name).concat(r,".scp")));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"loadIslandFileByName",value:(o=yn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fs.openAndGetContentAsStream("/islands/".concat(t,".scp")));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"loadRandomIslandFile",value:(a=yn(regeneratorRuntime.mark((function e(t,n){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(r=this.islandSizes.find((function(e){return e.id===t})))){e.next=3;break}throw new Error("This should never happen.");case 3:if(i=[],!["ANY","NORTH"].includes(n)){e.next=13;break}return e.t0=i.push,e.t1=i,e.t2=gn,e.next=10,this.loadIslandsWithSizeAndClimate(r.name,"north");case 10:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 13:if(!["ANY","SOUTH"].includes(n)){e.next=22;break}return e.t5=i.push,e.t6=i,e.t7=gn,e.next=19,this.loadIslandsWithSizeAndClimate(r.name,"south");case 19:e.t8=e.sent,e.t9=(0,e.t7)(e.t8),e.t5.apply.call(e.t5,e.t6,e.t9);case 22:return a=i[Math.floor(Math.random()*i.length)],e.next=25,this.fs.openAndGetContentAsStream(a.file.fullPath);case 25:return e.t10=e.sent,e.t11="south"===a.climate,e.t12=a.id,e.abrupt("return",{data:e.t10,isSouth:e.t11,id:e.t12});case 29:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"setIslandFields",value:function(e,t){e.fields=[];for(var n=0;n<e.size.x;n++)e.fields.push(new Array(e.size.y).fill(null));var r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)for(var u=o.value,c=this.parseIslandFields(e,u),l=0;l<e.size.x;l++)for(var d=0;d<e.size.y;d++){var f=c[l][d];null!==f&&(e.fields[l][d]=f)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},{key:"parseIslandFields",value:function(e,t){for(var n=t.data,r=t.length,i=[],a=0;a<e.size.x;a++)i.push(new Array(e.size.y).fill(null));for(var o=0;o<r/mn.saveGameDataLength;o++){var s=mn.fromSaveGame(n);m(s.x<e.size.x),m(s.y<e.size.y),i[s.x][s.y]=s}return i}},{key:"loadIslandsWithSizeAndClimate",value:(i=yn(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.ls("/islands/".concat(n));case 2:return e.t0=function(e){return e.name.startsWith(t)},e.t1=function(e){return null!==/\d\d\.scp$/.exec(e.name)},e.t2=function(e){return{file:e,climate:n,id:parseInt(e.name.substr(3,2),10)}},e.abrupt("return",e.sent.filter(e.t0).filter(e.t1).map(e.t2));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})}])&&bn(t.prototype,n),r&&bn(t,r),e}();function xn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function kn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){xn(a,r,i,o,s,"next",e)}function s(e){xn(a,r,i,o,s,"throw",e)}o(void 0)}))}}var Sn=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.textures=new Map,this.lock=new Se.a,this.getTextures=function(){var e=kn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="/gfx/".concat(t),e.next=3,n.lock.acquire(t,kn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.textures.has(t)){e.next=3;break}return e.next=3,n.loadTextures(t);case 3:case"end":return e.stop()}}),e)}))));case 3:return e.abrupt("return",n.textures.get(t));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.loadTextures=function(){var e=kn(regeneratorRuntime.mark((function e(t){var r,i,o,u,c,l,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,e.next=3,n.fs.ls(t);case 3:i=e.sent,o=!0,u=!1,c=void 0,e.prev=7,l=i[Symbol.iterator]();case 9:if(o=(d=l.next()).done){e.next=17;break}if(f=d.value,"png"!==f.name.substr(f.name.lastIndexOf(".")+1)){e.next=14;break}return e.delegateYield(regeneratorRuntime.mark((function e(){var t,i,o,u,c,l,d,p,h,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.fullPath.substring(0,f.fullPath.lastIndexOf("."))+".json",e.t0=JSON,e.next=4,n.fs.openAndGetContentAsText(t);case 4:return e.t1=e.sent,i=e.t0.parse.call(e.t0,e.t1),e.next=8,n.fs.openAndGetContentAsUint8Array(f);case 8:return o=e.sent,g=o,u=a.Texture.from("data:image/png;base64,".concat(Object(s.e)(g))),c=new a.Spritesheet(u.baseTexture,i),e.next=13,new Promise((function(e,t){c.parse((function(t,n){e(t)}))}));case 13:for(l=e.sent,d=0,p=Object.keys(l);d<p.length;d++)h=p[d],m=l[h],r.set(parseInt(h,10),m);case 15:case"end":return e.stop()}var g}),e)}))(),"t0",14);case 14:o=!0,e.next=9;break;case 17:e.next=23;break;case 19:e.prev=19,e.t1=e.catch(7),u=!0,c=e.t1;case 23:e.prev=23,e.prev=24,o||null==l.return||l.return();case 26:if(e.prev=26,!u){e.next=29;break}throw c;case 29:return e.finish(26);case 30:return e.finish(23);case 31:n.textures.set(t,r);case 32:case"end":return e.stop()}}),e,null,[[7,19,23,31],[24,,26,30]])})));return function(t){return e.apply(this,arguments)}}()},En=n("fDnD"),Rn=n.n(En),_n=n("q1tI"),An=n("i8i4"),In=n("/ia5");function Pn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}for(var On=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.root=void 0,this.root={x:0,y:0,w:t,h:n}}var t,n,r;return t=e,(n=[{key:"addBlock",value:function(e){var t=this.findNode(this.root,e.w,e.h);return!!t&&this.splitNode(t,e.w,e.h)}},{key:"findNode",value:function(e,t,n){return e.used?this.findNode(e.right,t,n)||this.findNode(e.down,t,n):t<=e.w&&n<=e.h?e:null}},{key:"splitNode",value:function(e,t,n){return e.used=!0,e.down={x:e.x,y:e.y+n,w:e.w,h:e.h-n},e.right={x:e.x+t,y:e.y,w:e.w-t,h:n},e}}])&&Pn(t.prototype,n),r&&Pn(t,r),e}(),Tn=new Uint8Array([0,0,0,128,0,0,0,128,0,128,128,0,0,0,128,109,31,108,0,128,128,192,192,192,255,0,255,255,0,255,0,0,0,0,4,4,0,8,8,0,16,0,11,6,3,21,8,0,37,4,0,0,20,4,6,22,6,0,33,0,3,38,3,14,28,5,8,49,4,32,24,0,27,44,0,10,12,18,8,28,20,24,22,16,35,23,12,1,41,21,12,44,19,24,43,17,35,41,15,10,22,37,10,44,37,36,31,31,34,49,29,18,36,44,38,46,41,19,34,64,4,61,6,16,59,6,21,62,8,37,61,4,14,60,40,33,59,35,41,61,32,14,55,64,24,61,61,33,49,61,37,61,57,17,58,72,41,61,66,17,60,78,17,58,94,13,77,0,37,78,0,18,77,8,23,77,37,28,77,72,25,77,88,22,73,110,17,95,3,37,98,0,22,93,61,22,112,45,21,150,36,25,124,107,28,148,113,0,82,140,8,74,144,248,194,48,8,82,148,8,86,148,12,78,140,23,82,136,0,99,140,24,94,140,8,90,156,12,90,160,18,99,148,18,101,148,10,117,150,8,90,173,8,99,169,12,103,165,21,104,165,6,121,173,19,115,171,33,115,165,10,118,181,24,119,177,33,115,173,33,123,177,24,117,187,8,136,189,11,136,196,17,136,220,33,156,132,0,156,148,24,156,177,0,156,214,12,148,206,196,120,94,11,173,216,8,148,231,8,148,239,12,160,230,28,152,226,21,178,225,16,177,239,24,189,231,33,189,222,0,148,247,80,150,226,0,156,255,224,138,108,242,153,122,233,113,2,255,125,2,8,165,247,251,216,52,244,175,45,16,156,247,24,148,239,20,152,251,255,252,157,33,165,247,54,17,4,74,17,4,53,45,12,70,44,11,60,74,11,41,99,0,59,90,19,45,103,0,46,112,0,45,99,8,44,106,17,55,109,2,55,106,17,66,106,3,68,108,16,59,47,38,62,68,41,59,61,64,61,74,63,60,97,45,65,91,68,63,77,75,60,99,75,49,76,90,63,75,85,46,98,90,65,101,86,58,95,104,55,98,117,55,102,140,94,22,5,89,42,20,90,64,26,89,96,11,90,94,45,88,80,70,87,102,68,89,79,80,85,103,80,93,107,77,90,88,89,86,111,90,87,99,98,88,102,117,115,33,10,113,65,20,111,95,17,111,82,57,108,111,65,111,107,90,107,104,107,143,29,4,137,86,13,140,88,31,137,99,64,172,39,5,166,93,37,197,49,8,205,84,30,41,126,2,49,123,0,53,127,0,66,123,0,52,123,11,54,123,20,54,122,73,49,132,4,66,132,0,49,132,20,64,132,22,53,140,0,53,134,55,49,141,50,49,167,29,83,130,9,91,126,62,87,121,107,108,123,103,82,171,6,85,145,47,89,182,41,119,126,60,119,119,105,116,180,48,170,128,42,145,125,103,133,187,58,202,172,52,43,133,116,83,127,115,127,124,115,125,142,115,74,126,126,73,128,164,118,132,123,118,135,143,43,160,124,95,156,132,45,181,136,63,193,138,92,169,189,63,222,167,86,237,200,144,137,123,141,153,133,152,149,127,175,154,124,152,165,140,152,178,141,169,176,140,204,194,133,154,176,173,185,182,160,179,200,167,172,209,207,221,218,181,225,239,226,254,250,230,0,148,255,160,160,164,128,128,128,255,0,0,0,255,0,255,255,0,0,0,255,255,0,255,0,255,255,255,255,255]),Cn=Tn,Nn={},Gn=0;Gn<Tn.length/3;Gn++){Nn[((Tn[3*Gn+0]<<24)+(Tn[3*Gn+1]<<16)+(Tn[3*Gn+2]<<8)+255).toString()]=Gn}var jn=Nn;function Fn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Dn=n("V4eY"),Mn=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=void 0,this.height=void 0,this.pixels=void 0,this.width=t,this.height=n,this.pixels=r}var t,n,r;return t=e,(n=[{key:"toPNG",value:function(){return Dn.encode([this.pixels.buffer],this.width,this.height)}}])&&Fn(t.prototype,n),r&&Fn(t,r),e}();function Ln(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Bn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Ln(a,r,i,o,s,"next",e)}function s(e){Ln(a,r,i,o,s,"throw",e)}o(void 0)}))}}function Hn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Un=n("V4eY"),zn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.SPRITESHEET_SIZE=2048,this.HEADER_SIZE=20,this.log=void 0,this.log=r.getLogger("bsh-parser")}var t,n,i,a,o,s,u,c;return t=e,(n=[{key:"decodeBSH",value:(c=Bn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.decode(t,"BSH"));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"decodeZEI",value:(u=Bn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.decode(t,"ZEI"));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"createSpriteSheets",value:function(e){for(var t=[],n=new On(this.SPRITESHEET_SIZE,this.SPRITESHEET_SIZE),r=new Uint8Array(this.SPRITESHEET_SIZE*this.SPRITESHEET_SIZE*4),i={meta:{},frames:{}},a=0;a<e.length;a++){var o=e[a],s=n.addBlock({w:o.width,h:o.height});if(!1===s&&(t.push({png:Un.encode([r.buffer],this.SPRITESHEET_SIZE,this.SPRITESHEET_SIZE),config:i}),n=new On(this.SPRITESHEET_SIZE,this.SPRITESHEET_SIZE),r=new Uint8Array(this.SPRITESHEET_SIZE*this.SPRITESHEET_SIZE*4),i={meta:{},frames:{}},s=n.addBlock({w:o.width,h:o.height})),!s)throw new Error("Could not add image to empty spritesheet!");for(var u=s.x,c=s.y,l=0,d=0;d<o.height;d++)for(var f=0;f<o.width;f++){var p=4*(u+f+this.SPRITESHEET_SIZE*d+this.SPRITESHEET_SIZE*c);r[p+0]=o.pixels[4*l+0],r[p+1]=o.pixels[4*l+1],r[p+2]=o.pixels[4*l+2],r[p+3]=o.pixels[4*l+3],l++}i.frames[a.toString(10)]={frame:{x:u,y:c,w:o.width,h:o.height},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:o.width,h:o.height},sourceSize:{w:o.width,h:o.height}}}return t.push({png:Un.encode([r.buffer],this.SPRITESHEET_SIZE,this.SPRITESHEET_SIZE),config:i}),t}},{key:"saveSpriteSheets",value:(s=Bn(regeneratorRuntime.mark((function e(t,n,r){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.mkdir(r);case 2:i=0;case 3:if(!(i<n.length)){e.next=9;break}return e.next=6,this.saveSpriteSheet(t,n[i],i,r);case 6:i++,e.next=3;break;case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"encodeBSH",value:function(e){var t=this,n=new In.SmartBuffer;return n.writeString("BSH".padEnd(16,"\0"),"ascii"),n.writeUInt32LE(42),e.forEach((function(){return n.writeUInt32LE(42)})),e.forEach((function(e,r){var i=t.encodeImage(e).toBuffer();n.writeUInt32LE(n.writeOffset-t.HEADER_SIZE,20+4*r),n.writeBuffer(i)})),n.writeUInt32LE(n.length-this.HEADER_SIZE,16),n.toBuffer()}},{key:"decode",value:(o=Bn(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(m(t.readString(16)===n),r=t.read32(),m(this.HEADER_SIZE+r===t.length),(i=[]).push(t.read32()),a=i[0]/4,o=1;o<a;o++)i.push(t.read32());for(s=[],u=0;u<a;u++)t.seek(i[u]+this.HEADER_SIZE),null!==(c=this.decodeImage(t))&&s.push(c);return e.abrupt("return",s);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"decodeImage",value:function(e){var t=e.read32(),n=e.read32();e.read32(),e.read32(),m(t>0),m(n>0);for(var r=new Uint8Array(t*n*4),i=0,a=0;;){var o=e.read8();if(255===o)break;if(254===o)a=++i*t*4;else{a+=4*o;for(var s=e.read8(),u=0;u<s;u++){var c=3*e.read8();r[a++]=Cn[c],r[a++]=Cn[c+1],r[a++]=Cn[c+2],r[a++]=255}}}return new Mn(t,n,r)}},{key:"encodeImage",value:function(e){var t=new In.SmartBuffer;t.writeUInt32LE(e.width).writeUInt32LE(e.height).writeUInt32LE(1).writeUInt32LE(42);for(var n=0,r=0;r<e.height;r++){for(var i=0,a=[],o="empty",s=0;s<e.width;s++){var u=(e.pixels[4*(r*e.width+s)+0]<<24)+(e.pixels[4*(r*e.width+s)+1]<<16)+(e.pixels[4*(r*e.width+s)+2]<<8)+(e.pixels[4*(r*e.width+s)+3]<<0);if(0===u){if("empty"===o)i++;else if("colored"===o){for(;n>0;)t.writeUInt8(254),n--;for(;i>253;)t.writeUInt8(253),t.writeUInt8(0),i-=253;t.writeUInt8(i);for(var c=0;c<a.length;c+=255){var l=a.slice(c,c+255);c>0&&t.writeUInt8(0),t.writeUInt8(l.length),l.forEach((function(e){var n=jn[e];t.writeUInt8(n)}))}i=1,a=[]}o="empty"}else o="colored",a.push(u)}if("colored"===o){for(;n>0;)t.writeUInt8(254),n--;for(;i>253;)t.writeUInt8(253),t.writeUInt8(0),i-=253;t.writeUInt8(i);for(var d=0;d<a.length;d+=255){var f=a.slice(d,d+255);d>0&&t.writeUInt8(0),t.writeUInt8(f.length),f.forEach((function(e){t.writeUInt8(jn[e.toString()])}))}}n++}t.writeUInt8(255);for(var p=(4-t.length%4)%4,h=0;h<p;h++)t.writeUInt8(0);return t.writeUInt32LE(t.length,12),t}},{key:"saveSpriteSheet",value:(a=Bn(regeneratorRuntime.mark((function e(t,n,r,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.write("".concat(i,"/sprite-sheet-").concat(r,".png"),n.png);case 2:return e.next=4,t.write("".concat(i,"/sprite-sheet-").concat(r,".json"),JSON.stringify(n.config));case 4:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return a.apply(this,arguments)})}])&&Hn(t.prototype,n),i&&Hn(t,i),e}(),Wn=n("daKf");function Zn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Kn(e){return(Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Yn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.log=void 0,this.variables=void 0,this.objects=void 0,this.template=void 0,this.gfxMap=void 0,this.lastGfxName=void 0,this.currentObject=void 0,this.currentNestedObject=void 0,this.currentItem=void 0,this.currentNestedItem=void 0,this.log=r.getLogger("dat-parser")}var t,n,i;return t=e,(n=[{key:"parse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;this.variables=t,this.objects={},this.template=null,this.gfxMap=new Map,this.lastGfxName=null,this.currentObject=null,this.currentNestedObject=null,this.currentItem=null,this.currentNestedItem=0;var n=!0,r=!1,i=void 0;try{for(var a,o=e.split("\n")[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(0!==(s=s.split(";")[0].trim()).length&&!(s.startsWith("Nahrung:")||s.startsWith("Soldat:")||s.startsWith("Turm:")))if('Include: "TOOLS.INC"'!==s){var u=void 0;if(u=/^(@?)(\w+)\s*=\s*((?:\d+|\+|\w+)+)$/.exec(s))this.handleConstantAssignment(u);else if(u=/^ObjFill:\s*([\w,]+)$/.exec(s))this.handleObjFill(u);else if(u=/^Objekt:\s*(\w+)$/.exec(s))this.handleNestedObjectBegin(u);else if("EndObj"!==s){if(!(u=/^(@?)(\w+):\s*(.*?)\s*$/.exec(s)))throw new Error("Could not parse: "+s);this.handleProperty(u)}else this.handleNestedObjectEnd()}else m(t.size>0)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return{variables:this.mapToObject(this.variables),objects:this.objects,gfx_category_map:this.mapToObject(this.gfxMap)}}},{key:"handleObjFill",value:function(e){m(null!=this.currentObject),m(null!=this.currentItem);var t=e[1],n=this.objects[this.currentObject].items[this.currentItem];if(t.startsWith("0,MAX"))m(null===this.template),this.template=n;else{m(Object.prototype.hasOwnProperty.call(n,"nested_objects"));var r=this.getValue(null,t,!1),i=this.objects[this.currentObject].items[r];this.objects[this.currentObject].items[this.currentItem]=this.deepCopy(i),null!=this.lastGfxName&&(n.GfxCategory=this.lastGfxName)}}},{key:"handleConstantAssignment",value:function(e){var t=e[1].length>0,n=e[2],r=e[3];if(n.startsWith("GFX"))if("0"===r)this.gfxMap.set(n,n);else if(r.startsWith("GFX")){var i=r.split("+")[0];this.gfxMap.has(i)&&this.gfxMap.set(n,this.gfxMap.get(i))}this.variables.set(n,this.getValue(n,r,t))}},{key:"handleNestedObjectBegin",value:function(e){var t=e[1];if(null===this.currentObject)this.currentObject=t,this.objects[t]={items:{}};else{if(null!==this.currentNestedObject)throw new Error("It appears like there is more than one nesting level. This is not supported by this parser.");m(null!==this.currentItem),this.currentNestedObject=t,this.currentNestedItem=0;var n=this.objects[this.currentObject].items[this.currentItem];void 0!==n.nested_objects[this.currentNestedObject]&&void 0!==n.nested_objects[this.currentNestedObject][this.currentNestedItem]||(n.nested_objects[this.currentNestedObject]=Vn({},this.currentNestedItem,{}))}}},{key:"handleNestedObjectEnd",value:function(){if(null!==this.currentNestedObject)this.currentNestedObject=null,this.currentNestedItem=null;else{if(null===this.currentObject)throw new Error("Received EndObj without current object!");this.currentObject=null,this.currentItem=null}}},{key:"handleProperty",value:function(e){var t=e[1].length>0,n=e[2],r=e[3],i=this.deepCopy(this.getValue(n,r,t));if(this.variables.set(n,i),"Nummer"!==n){var a=this.objects[this.currentObject].items[this.currentItem];if("Gfx"===n&&r.startsWith("GFX")&&(this.lastGfxName=r.split("+")[0]),null==this.currentNestedObject)a[n]=i,null!=this.lastGfxName&&(a.GfxCategory=this.lastGfxName,a.GfxCategoryMapped=this.gfxMap.get(this.lastGfxName));else{var o=a.nested_objects[this.currentNestedObject][this.currentNestedItem];Object.keys(o).includes(n)&&this.isObject(o[n])?o[n]=this.deepMerge(o[n],i):o[n]=i}}else if(null===this.currentNestedObject){if(this.currentItem=i,this.objects[this.currentObject].items[this.currentItem]={nested_objects:{}},null!==this.template){var s=this.deepCopy(this.template);this.objects[this.currentObject].items[this.currentItem]=this.deepMerge(s,this.objects[this.currentObject].items[this.currentItem])}}else this.currentNestedItem=i,this.objects[this.currentObject].items[this.currentItem].nested_objects[this.currentNestedObject][this.currentNestedItem]={}}},{key:"getValue",value:function(e,t,n){var r,i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;if(n&&(r=/^([+-])(\d+)$/.exec(t))){var o=this.variables.has(e)?this.deepCopy(this.variables.get(e)):null;if("RUINE_KONTOR_1"===o.toString()&&(o=424242),a>-1&&(o="Size"===e?o[0===a?"x":"y"]:o[a]),"+"===r[1])return o+parseInt(r[2],10);if("-"===r[1])return o-parseInt(r[2],10);throw new Error("This code should not be reached.")}if(/^[-+]?\d+$/.exec(t))return parseInt(t,10);if(/^[-+]?\d+\.\d+$/.exec(t))return parseFloat(t);if(r=/^([A-Za-z0-9_]+)(?:\[(\d+)])?$/.exec(t)){var s=r[1],u=r[2],c=this.variables.has(s)?this.deepCopy(this.variables.get(s)):s;return void 0!==u?c[u]:c}if(t.includes(",")){var l=t.split(",").map((function(t,r){return i.getValue(e,t.trim(),n,r)}));if("Size"===e)return{x:l[0],y:l[1]};if("Ware"===e){var d={};return d[l[0]]=l[1],d}return l}if(r=/^([A-z]+(?:\[\d+])?|\d+)([+-])([A-z]+(?:\[\d+])?|\d+)$/.exec(t)){var f=r[2],p=this.getValue(e,r[1],!1),h=this.getValue(e,r[3],!1);return"+"===f?p+h:p-h}throw new Error("This code should not be reached.")}},{key:"deepCopy",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"isObject",value:function(e){return e&&"object"===Kn(e)&&!Array.isArray(e)}},{key:"deepMerge",value:function(e,t){var n=this,r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zn(n,!0).forEach((function(t){Vn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);return this.isObject(e)&&this.isObject(t)&&Object.keys(t).forEach((function(i){n.isObject(t[i])&&i in e?r[i]=n.deepMerge(e[i],t[i]):Object.assign(r,Vn({},i,t[i]))})),r}},{key:"mapToObject",value:function(e){var t={};return e.forEach((function(e,n){return t[n]=e})),t}}])&&qn(t.prototype,n),i&&qn(t,i),e}(),Xn=n("/dzE");function Jn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function $n(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Jn(a,r,i,o,s,"next",e)}function s(e){Jn(a,r,i,o,s,"throw",e)}o(void 0)}))}}function Qn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var er=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ffmpeg=void 0,this.memory=1e8}var t,n,r,i,a;return t=e,(n=[{key:"parse",value:(a=$n(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Xn.a)();case 2:return this.ffmpeg=e.sent,n=[{data:t,name:"input.smk"}],e.prev=4,r=this.prepareArguments(!0),e.next=8,this.convert(r,n);case 8:return e.abrupt("return",e.sent);case 11:if(e.prev=11,e.t0=e.catch(4),"only-one-audio-stream"!==e.t0.message){e.next=20;break}return i=this.prepareArguments(!1),e.next=17,this.convert(i,n);case 17:return e.abrupt("return",e.sent);case 20:throw e.t0;case 21:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(e){return a.apply(this,arguments)})},{key:"prepareArguments",value:function(e){var t=["-i","input.smk"];return e&&t.push.apply(t,["-filter_complex","[0:a]amerge[c]","-map","[c]","-map","0:v:0"]),t.push.apply(t,["-ac","2","-c:v","libx264","-pix_fmt","yuv420p","-preset","ultrafast","-movflags","+faststart","output.mp4"]),t}},{key:"convert",value:(i=$n(regeneratorRuntime.mark((function e(t,n){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Converting video with arguments ".concat(t.join(" "))),e.abrupt("return",new Promise((function(e,i){var a="",o=function(e){a+=e+"\n",console.log(e)};r.ffmpeg({arguments:t,files:n,print:o,printErr:o,stdin:function(){},TOTAL_MEMORY:r.memory,noExitRuntime:!1,returnCallback:function(t){a.includes("Cannot find a matching stream for unlabeled input pad 1")?i(new Error("only-one-audio-stream")):1!==t.length?i(new Error("unknown-error")):e(new Uint8Array(t[0].data))}})})));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})}])&&Qn(t.prototype,n),r&&Qn(t,r),e}(),tr=n("B16k");function nr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var rr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adpcmIndexTable=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],this.adpcmStepTable=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767]}var t,n,r;return t=e,(n=[{key:"decode",value:function(e){var t=new tr.a(e),n=t.fmt.bitsPerSample,r=t.fmt.sampleRate,i=t.fmt.numChannels;if(4!==n)throw new Error("Can only convert .wav files with 4 bits per sample.");if(2!==i)throw new Error("Can only convert .wav files with stereo sound.");for(var a={step_index:0,predictor:0},o={step_index:0,predictor:0},s=t.data.samples,u=new Int16Array(s.length),c=new Int16Array(s.length),l=0;l<s.length;l++)u[l]=this.decodeADPCM_IMA(a,s[l]>>>4),c[l]=this.decodeADPCM_IMA(o,15&s[l]);return{left:u,right:c,sampleRate:r}}},{key:"encode",value:function(e){for(var t=e.left.length,n=new Int16Array(2*t),r=0;r<t;r++)n[2*r+0]=e.left[r],n[2*r+1]=e.right[r];var i=new tr.a;return i.fromScratch(2,e.sampleRate,"16",n),i.toBuffer()}},{key:"av_clip",value:function(e,t,n){return Math.min(Math.max(t,e),n)}},{key:"av_clip_int16",value:function(e){return e+32768&-65536?e>>31^32767:e}},{key:"decodeADPCM_IMA",value:function(e,t){var n=this.adpcmStepTable[e.step_index],r=this.av_clip(e.step_index+this.adpcmIndexTable[t],0,88),i=8&t,a=(2*(7&t)+1)*n>>>3,o=e.predictor;return i?o-=a:o+=a,e.predictor=this.av_clip_int16(o),e.step_index=r,e.predictor}}])&&nr(t.prototype,n),r&&nr(t,r),e}();function ir(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ar(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var or=n("1Y70"),sr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r,i,a;return t=e,(n=[{key:"createBitmapFont",value:(i=regeneratorRuntime.mark((function e(t,n){var r,i,a,o,u,c,l,d,f,p,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],i=[],a=0;a<t.length;a++)for(o=t[a],r.push({page:[{_attr:{id:a,file:"data:image/png;base64,".concat(Object(s.e)(new Uint8Array(o.png)))}}]}),u=0,c=Object.keys(o.config.frames);u<c.length;u++)l=c[u],d=o.config.frames[l],f=parseInt(l,10)+32,i.push({char:[{_attr:{id:f,x:d.frame.x,y:d.frame.y,width:d.frame.w,height:d.frame.h,xoffset:0,yoffset:0,xadvance:d.frame.w,page:a,chnl:15,letter:String.fromCharCode(f)}}]});return p=t[0].config.frames[0].sourceSize.h,h={font:[{info:[{_attr:{face:n,size:p,padding:"0,0,0,0",spacing:"0,0",italic:"0",bold:"0",stretchH:"100",smooth:"1",aa:"1"}}]},{common:[{_attr:{pages:t.length,lineHeight:p,packed:0}}]},{pages:r},{chars:i}]},e.abrupt("return",or(h,{indent:"  "}));case 6:case"end":return e.stop()}}),e)})),a=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){ir(a,n,r,o,s,"next",e)}function s(e){ir(a,n,r,o,s,"throw",e)}o(void 0)}))},function(e,t){return a.apply(this,arguments)})}])&&ar(t.prototype,n),r&&ar(t,r),e}();function ur(e){var t={},n=null,r=!0,i=!1,a=void 0;try{for(var o,s=e.split("\r\n")[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;n?"[END]"===u?n=null:t[n].push(u):u.startsWith("[")&&(t[n=u.split(/[[\]]/)[1]]=[])}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return t}function cr(e){return(cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function dr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){lr(a,r,i,o,s,"next",e)}function s(e){lr(a,r,i,o,s,"throw",e)}o(void 0)}))}}function fr(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function pr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gr(e){return(gr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yr(e,t){return(yr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var br=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==cr(t)&&"function"!=typeof t?vr(e):t}(this,gr(t).call(this,e))).info=function(e){n.log(e,"info")},n.warn=function(e){n.log(e,"warn")},n.error=function(e){n.log(e,"error")},n.log=function(e,t){n.setState((function(n){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pr(n,!0).forEach((function(t){hr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pr(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n,{messages:[{msg:e,type:t}].concat(fr(n.messages.filter((function(e,t){return"info"!==e.type||t<50}))))})}))},n.zipUploaded=function(){var e=dr(regeneratorRuntime.mark((function e(t){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(r=t.target.files)&&1===r.length){e.next=4;break}return alert("Please select the zipped Anno1602 folder to upload."),e.abrupt("return");case 4:if((i=r[0]).name.endsWith(".zip")){e.next=8;break}return alert("You need to upload a .zip file!"),e.abrupt("return");case 8:return n.setState({isUploading:!0}),e.next=11,n.props.onUploaded(i);case 11:a=e.sent,n.setState({isUploading:!1}),a?(n.info("Upload finished. Please reload the page."),alert("Upload finished. Please reload the page.")):(n.error("The upload failed."),alert("The upload failed."));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.resetFiles=dr(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.onReset();case 2:alert("All files deleted. The page will now refresh."),window.location.reload(!0);case 4:case"end":return e.stop()}}),e)}))),n.state={isUploading:!1,messages:[]},n.props.setLogger(vr(n)),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yr(e,t)}(t,e),n=t,(r=[{key:"render",value:function(){return _n.createElement("div",{style:{marginLeft:"1em",marginRight:"1em",fontFamily:"Arial",maxWidth:"800px",lineHeight:1.4}},_n.createElement("h1",null,"Anno 2018"),_n.createElement("p",null,"Welcome to Anno 2018, an effort to port twenty-year-old Anno 1602 to the browser. This is in early development, however, you can already load your savegames and start new games. Much of the actual simulation is still missing though. For copyright reasons, we can't include the original Anno 1602 files and graphics."," ",_n.createElement("strong",null,"You need own your own copy of Anno 1602 for Anno 2018 work.")),_n.createElement("p",null,"The following versions have been tested by us and confirmed to work:"),_n.createElement("ul",null,_n.createElement("li",null,'German "Anno 1602 Köngisedition"'),_n.createElement("li",null,'English "Anno 1602 A.D." from GOG')),_n.createElement("p",null,"Anno 2018 is tested in the latest versions of"," ",_n.createElement("strong",null,"Chrome (preferred, faster) and Firefox")," only. Other browsers ",_n.createElement("em",null,"might")," work, but aren't supported."),_n.createElement("p",null,'To get started, follow these steps. You will need to "upload" your Anno files on this website. Don\'t worry though, the files'," ",_n.createElement("em",null,"never")," leave your PC and are only uploaded into your browser. Once uploaded, the files remain in your browser and will be there when you re-open this website."),_n.createElement("ol",null,_n.createElement("li",null,"Find your Anno 1602 files and zip them. If you are using a version of Anno 1602 which came with a physical CD, copy the videosmk and music8 folders into your Anno 1602 root folder before creating the zip file."),_n.createElement("li",null,"Use the upload button below to upload the zip file. The file should be around 50MB if it doesn't contain music and videos, and around 500MB if it does."),_n.createElement("li",null,_n.createElement("p",null,"Grab a coffee. The upload takes some time. Progress is being logged below. Should anything go wrong, take a look at the error message. It might tell you what to do. If it doesn't, make sure you're using a recent version of Chrome or Firefox. If it is still not working,"," ",_n.createElement("a",{href:"https://reddit.com/u/cmfcmf"},"drop me a note at reddit"),", ",_n.createElement("a",{href:"https://twitter.com/christianmflach"},"twitter"),", or"," ",_n.createElement("a",{href:"https://github.com/cmfcmf/Anno2018"},"create an issue at GitHub"),". Make sure to include the upload progress output."),"Upload:"," ",_n.createElement("input",{type:"file",multiple:!1,accept:".zip",onChange:this.zipUploaded,disabled:this.state.isUploading}))),_n.createElement("h2",null,"Upload Progress ",_n.createElement("small",null,"(newest at the top)")),0===this.state.messages.length&&_n.createElement("p",null,"Nothing yet..."),_n.createElement("div",{style:{fontSize:"10px"}},this.state.messages.map((function(e,t){return _n.createElement("div",{key:t},_n.createElement("span",{style:{color:"info"===e.type?"blue":"warn"===e.type?"orange":"red"}},e.type.toUpperCase()),": ",e.msg)}))),_n.createElement("h2",null,"Uploading custom missions and additional savegames"),_n.createElement("p",null,"Use this button to upload additional missions or savegames after you uploaded the main game:"," ",_n.createElement("input",{type:"file",multiple:!0,accept:".szm,.szs,.gam",onChange:this.props.onSaveOrMissionUploaded})),_n.createElement("h2",null,"Resetting files"),_n.createElement("p",null,'You can use the "Reset all files" button to delete all uploaded files if needed: ',_n.createElement("button",{onClick:this.resetFiles},"Reset all files")))}}])&&mr(n.prototype,r),i&&mr(n,i),t}(_n.Component);function wr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function xr(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){wr(a,r,i,o,s,"next",e)}function s(e){wr(a,r,i,o,s,"throw",e)}o(void 0)}))}}function kr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Sr=n("oxjq"),Er=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.logger=void 0,this.logger=r}var t,n,i,a,u,c,l,d,f,p,h,m,g,v,y,b,w,x,k,S;return t=e,(n=[{key:"init",value:(S=xr(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=console,e.next=3,this.fs.ls("/");case 3:e.t1=e.sent,e.t0.table.call(e.t0,e.t1);case 5:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"render",value:function(e){var t,n=this,r=document.createElement("div");An.render(_n.createElement(br,{onUploaded:this.uploadAndParse.bind(this),onReset:this.reset.bind(this),onSaveOrMissionUploaded:(t=xr(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(r=t.target.files)&&0!==r.length){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Promise.all(Array.from(r).map((function(e){return n.uploadSaveOrMission(e)})));case 5:alert("Upload finished. The page will now refresh."),window.location.reload(!0);case 7:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)}),setLogger:this.setLogger.bind(this)}),e),e.appendChild(r)}},{key:"isUploaded",value:(k=xr(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fs.exists("/fields.dat"));case 1:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"setLogger",value:function(e){this.logger=e}},{key:"reset",value:(x=xr(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.rmRoot();case 2:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"uploadAndParse",value:(w=xr(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fs.write("/original.zip",t);case 3:return e.next=5,this.fs.open("/original.zip");case 5:return r=e.sent,e.next=8,Rn.a.loadAsync(r);case 8:n=e.sent,e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(0),this.logger.error("Could not upload the ZIP file: ".concat(e.t0.message)),e.abrupt("return",!1);case 15:return e.prev=15,i=Object(s.b)(n),e.next=19,this.fs.rmRoot();case 19:return e.next=21,this.copyIslands(i);case 21:return e.next=23,this.copySaves(i);case 23:return e.next=25,this.parseTranslations(i);case 25:return a=e.sent,e.next=28,this.copyMissions(i,a);case 28:return e.next=30,this.decryptCODs(i);case 30:return e.next=32,this.parseDATs();case 32:return e.next=34,this.parseGADs(i);case 34:return e.next=36,this.parseBSHs(i);case 36:return e.next=38,this.parseZEIs(i);case 38:return e.next=40,this.parseMusic(i);case 40:return e.next=42,this.parseVideos(i);case 42:e.next=48;break;case 44:return e.prev=44,e.t1=e.catch(15),this.logger.error(e.t1.message),e.abrupt("return",!1);case 48:return e.abrupt("return",!0);case 49:case"end":return e.stop()}}),e,this,[[0,11],[15,44]])}))),function(e){return w.apply(this,arguments)})},{key:"uploadSaveOrMission",value:(b=xr(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".gam")){e.next=5;break}return e.next=3,this.fs.write("/saves/".concat(t.name),t);case 3:e.next=7;break;case 5:return e.next=7,this.fs.write("/missions-custom/".concat(t.name),t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"parseDATs",value:(y=xr(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([["/fields.dat","/fields.json"],["/animations.dat","/animations.json"]].map(function(){var e=xr(regeneratorRuntime.mark((function e(n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n[0],i=n[1],t.logger.info('Started parsing "'.concat(r,'".')),a=new Yn,e.t0=a,e.next=7,t.fs.openAndGetContentAsText(r);case 7:return e.t1=e.sent,o=e.t0.parse.call(e.t0,e.t1),e.next=11,t.fs.write(i,JSON.stringify(o));case 11:t.logger.info('Finished parsing "'.concat(r,'".'));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}}),e)}))),function(){return y.apply(this,arguments)})},{key:"parseGADs",value:(v=xr(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,d,f,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.mkdir("/screens");case 2:return n=new Yn,r="GADDATA/TOOLS.INC",this.logger.info('Started parsing "'.concat(r,'".')),i=this.findFileCaseInsensitive(t,r),e.t0=n,e.next=9,i.async("text");case 9:e.t1=e.sent,a=e.t0.parse.call(e.t0,e.t1),o=new Map(Object.entries(a.variables)),this.logger.info('Finished parsing "'.concat(r,'".')),s=0,u=[["Anno.gad",""],["BASE.GAD","menu_main"],["BAU.GAD",""],["BAUKONT.GAD",""],["BAUSHIP.GAD",""],["BERGWERK.GAD",""],["BUBBLE01.GAD",""],["BUBBLE.GAD",""],["CHAT.GAD",""],["CLIENT.GAD",""],["CTRL.GAD",""],["DISK.GAD",""],["ENDE.GAD","menu_points"],["FARBWAHL.GAD","menu_player_selection"],["HANDEL.GAD",""],["HOST.GAD","menu_missions"],["INFO.GAD",""],["INFRA.GAD",""],["KONTOR.GAD",""],["LAGER.GAD",""],["LEIST.GAD",""],["MARKT.GAD",""],["MILITAR.GAD",""],["MISSION.GAD","menu_mission_details"],["MISSZIEL.GAD",""],["MKSHIP.GAD",""],["MKSOLDAT.GAD",""],["MUSIK.GAD",""],["OPTION.GAD",""],["PIRAT.GAD",""],["PIRATORD.GAD",""],["PLANTAGE.GAD",""],["PROD.GAD",""],["ROUTE.GAD",""],["SCAPE.GAD",""],["SHIP.GAD",""],["SHIPLIST.GAD",""],["SIEDLER.GAD",""],["SKSHIP.GAD",""],["SKSOLDAT.GAD",""],["STADT.GAD",""],["STADTLST.GAD",""],["TRADE.GAD",""],["TRADER.GAD",""],["TRANSFER.GAD",""],["TRIBUT.GAD",""],["TUTOR.GAD",""],["VERTRAG.GAD",""],["WAITLOAD.GAD","menu_loading"],["WERFT.GAD",""]];case 15:if(!(s<u.length)){e.next=34;break}return""===(c=u[s])[1]&&(c[1]=c[0]),l="GADDATA/".concat(c[0]),d="/screens/".concat(c[1],".json"),this.logger.info('Started parsing "'.concat(l,'".')),f=this.findFileCaseInsensitive(t,l),e.t2=n,e.next=25,f.async("text");case 25:return e.t3=e.sent,e.t4=o,p=e.t2.parse.call(e.t2,e.t3,e.t4),e.next=30,this.fs.write(d,JSON.stringify(p));case 30:this.logger.info('Finished parsing "'.concat(l,'".'));case 31:s++,e.next=15;break;case 34:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"decryptCODs",value:(g=xr(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Wn.a,e.abrupt("return",Promise.all([["haeuser.cod","/fields.dat"],["figuren.cod","/animations.dat"]].map(function(){var e=xr(regeneratorRuntime.mark((function e(i){var a,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i[0],s=i[1],r.logger.info('Started parsing "'.concat(a,'".')),u=r.findFileCaseInsensitive(t,a),e.next=6,o.a.fromZipObject(u);case 6:return c=e.sent,e.next=9,r.fs.write(s,n.decrypt(c));case 9:r.logger.info('Finished parsing "'.concat(a,'".'));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 2:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},{key:"parseBSHs",value:(m=xr(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,u,c,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new zn,r=0,i=[["GFX/NUMBERS","NUMBERS"],["GFX/STADTFLD","STADTFLD"],["GFX/EFFEKTE","EFFEKT"],["GFX/FISCHE","WAL"],["GFX/GAUKLER","GAUKLER"],["GFX/MAEHER","MAEHER"],["GFX/SCHATTEN","SCHATTEN"],["GFX/SHIP","SHIP"],["GFX/SOLDAT","SOLDAT"],["GFX/TIERE","RIND"],["GFX/TRAEGER","TRAEGER"],["ToolGfx/BAUHAUS","TOOLS/BAUHAUS"],["ToolGfx/BAUSHIP","TOOLS/BAUSHIP"],["ToolGfx/START","TOOLS/START"],["ToolGfx/SYMBOL","TOOLS/SYMBOL"],["ToolGfx/TOOLS","TOOLS/TOOLS"]];case 3:if(!(r<i.length)){e.next=23;break}return a=i[r],s=a[0]+".BSH",u=a[1],this.logger.info('Started parsing "'.concat(s,'".')),c=this.findFileCaseInsensitive(t,s),e.t0=n,e.next=12,o.a.fromZipObject(c);case 12:return e.t1=e.sent,e.next=15,e.t0.decodeBSH.call(e.t0,e.t1);case 15:return l=e.sent,d=n.createSpriteSheets(l),e.next=19,n.saveSpriteSheets(this.fs,d,"/gfx/".concat(u));case 19:this.logger.info('Finished parsing "'.concat(s,'".'));case 20:r++,e.next=3;break;case 23:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"parseTranslations",value:(h=xr(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("Started parsing translations."),n=this.findFileCaseInsensitive(t,"text.cod"),r=new Wn.a,e.t0=ur,e.t1=r,e.next=7,o.a.fromZipObject(n);case 7:return e.t2=e.sent,e.t3=e.t1.decrypt.call(e.t1,e.t2),i=(0,e.t0)(e.t3),e.next=12,this.fs.write("/translations.json",JSON.stringify(i));case 12:return this.logger.info("Finished parsing translations."),e.abrupt("return",i.PATH[0]);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"parseZEIs",value:(p=xr(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,u,c,l,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.mkdir("/fonts");case 2:n=new zn,r=new sr,i=0,a=["ZEI11A","ZEI14A","ZEI14V","ZEI16G","ZEI16H","ZEI16V","ZEI20H","ZEI20V","ZEI24V","ZEI28V","ZEI2","ZEI9A"];case 6:if(!(i<a.length)){e.next=30;break}return s=a[i],u="TOOLGFX/".concat(s,".ZEI"),this.logger.info('Started parsing "'.concat(u,'".')),c=this.findFileCaseInsensitive(t,u),e.t0=n,e.next=14,o.a.fromZipObject(c);case 14:return e.t1=e.sent,e.next=17,e.t0.decodeZEI.call(e.t0,e.t1);case 17:return l=e.sent,d=n.createSpriteSheets(l),e.next=21,n.saveSpriteSheets(this.fs,d,"/fonts/".concat(s));case 21:return e.next=23,r.createBitmapFont(d,s);case 23:return f=e.sent,e.next=26,this.fs.write("/fonts/".concat(s,"/font.xml"),f);case 26:this.logger.info('Finished parsing "'.concat(u,'".'));case 27:i++,e.next=6;break;case 30:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"parseMusic",value:(f=xr(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.mkdir("/music");case 2:if(this.hasFolderCaseInsensitive(t,"MUSIC8")){e.next=5;break}return this.logger.warn("No music files found."),e.abrupt("return");case 5:n=new rr,r=this.findFilesInZip(t,"MUSIC8",".wav"),i=!0,a=!1,o=void 0,e.prev=10,s=r[Symbol.iterator]();case 12:if(i=(u=s.next()).done){e.next=28;break}return c=u.value,l=c.path.substr(1),this.logger.info("Converting song ".concat(l)),e.t0=n,e.next=19,c.file.async("uint8array");case 19:return e.t1=e.sent,d=e.t0.decode.call(e.t0,e.t1),f=n.encode(d),e.next=24,this.fs.write("/music/".concat(l),f);case 24:this.logger.info("Finished converting song ".concat(l));case 25:i=!0,e.next=12;break;case 28:e.next=34;break;case 30:e.prev=30,e.t2=e.catch(10),a=!0,o=e.t2;case 34:e.prev=34,e.prev=35,i||null==s.return||s.return();case 37:if(e.prev=37,!a){e.next=40;break}throw o;case 40:return e.finish(37);case 41:return e.finish(34);case 42:case"end":return e.stop()}}),e,this,[[10,30,34,42],[35,,37,41]])}))),function(e){return f.apply(this,arguments)})},{key:"parseVideos",value:(d=xr(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.mkdir("/videos");case 2:if(this.hasFolderCaseInsensitive(t,"VIDEOSMK")){e.next=5;break}return this.logger.warn("No video files found."),e.abrupt("return");case 5:n=new er,r=this.findFilesInZip(t,"VIDEOSMK",".smk"),i=!0,a=!1,o=void 0,e.prev=10,s=r[Symbol.iterator]();case 12:if(i=(u=s.next()).done){e.next=28;break}return c=u.value,l=c.path.substr(1),this.logger.info("Converting video ".concat(l)),e.next=18,c.file.async("uint8array");case 18:return d=e.sent,e.next=21,n.parse(d);case 21:return f=e.sent,e.next=24,this.fs.write("/videos/".concat(l.replace(".smk",".mp4")),f);case 24:this.logger.info("Finished converting video ".concat(l));case 25:i=!0,e.next=12;break;case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(10),a=!0,o=e.t0;case 34:e.prev=34,e.prev=35,i||null==s.return||s.return();case 37:if(e.prev=37,!a){e.next=40;break}throw o;case 40:return e.finish(37);case 41:return e.finish(34);case 42:case"end":return e.stop()}}),e,this,[[10,30,34,42],[35,,37,41]])}))),function(e){return d.apply(this,arguments)})},{key:"copyIslands",value:(l=xr(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([["NOKLIMA","/islands/noklima"],["NORD","/islands/north"],["NORDNAT","/islands/northnat"],["SUED","/islands/south"],["SUEDNAT","/islands/southnat"]].map((function(e){return n.copyFolderFromZip(t,e[0],e[1],".scp")}))));case 1:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"copySaves",value:(c=xr(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyFolderFromZip(t,"SAVEGAME","/saves",".gam");case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"copyMissions",value:(u=xr(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyFolderFromZip(t,"Szenes","/missions-original",".szm|.szs|.hss");case 2:return e.next=4,this.copyFolderFromZip(t,n,"/missions-custom",".szm|.szs|.hss");case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"copyFolderFromZip",value:(a=xr(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s,u,c,l,d,f,p,h,m,g=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(g.length>4&&void 0!==g[4])||g[4],n="".concat(n,"/"),this.logger.info("Copying '".concat(i,"' files from '").concat(n,"' to '").concat(r,"'.")),o=this.findFilesInZip(t,n,i),e.next=6,this.fs.mkdir(r);case 6:s=!0,u=!1,c=void 0,e.prev=9,l=o[Symbol.iterator]();case 11:if(s=(d=l.next()).done){e.next=27;break}return f=d.value,p=a?f.path.toLowerCase():f.path,h=f.file,m="".concat(r,"/").concat(p),this.logger.info("Copying '".concat(p,"' to '").concat(m,"'.")),e.t0=this.fs,e.t1=m,e.next=21,h.async("blob");case 21:return e.t2=e.sent,e.next=24,e.t0.write.call(e.t0,e.t1,e.t2);case 24:s=!0,e.next=11;break;case 27:e.next=33;break;case 29:e.prev=29,e.t3=e.catch(9),u=!0,c=e.t3;case 33:e.prev=33,e.prev=34,s||null==l.return||l.return();case 36:if(e.prev=36,!u){e.next=39;break}throw c;case 39:return e.finish(36);case 40:return e.finish(33);case 41:case"end":return e.stop()}}),e,this,[[9,29,33,41],[34,,36,40]])}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"findFilesInZip",value:function(e,t,n){var r=[];return e.forEach((function(e,i){if(e.startsWith(t)){var a=!0,o=!1,s=void 0;try{for(var u,c=n.split("|")[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var l=u.value;if(e.toLowerCase().endsWith(l.toLowerCase())){e=(e=e.substring(t.length)).substring(0,e.length-l.length),e+=l,r.push({path:e,file:i});break}}}catch(e){o=!0,s=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw s}}}})),r}},{key:"findFileCaseInsensitive",value:function(e,t){var n=new RegExp(Sr(t),"i"),r=e.file(n)[0];if(void 0===r)throw new Error("Could not find file ".concat(t,"."));return r}},{key:"hasFolderCaseInsensitive",value:function(e,t){var n=new RegExp(Sr(t),"i");return void 0!==e.folder(n)[0]}}])&&kr(t.prototype,n),i&&kr(t,i),e}();function Rr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function _r(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Rr(a,r,i,o,s,"next",e)}function s(e){Rr(a,r,i,o,s,"throw",e)}o(void 0)}))}}_r(regeneratorRuntime.mark((function e(){var t,n,o,u,c,l,d,f,h,m,g,v,y,b,w,x,k,S,E,R,_,A,I,P,O,T,C,N,j,F;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.enableAll(),(t=document.createElement("style")).innerText="\n        body, html {\n            margin: 0;\n        }\n    ",(n=document.createElement("div")).id="game",(o=document.createElement("p")).innerHTML="Anno 2018, version ".concat("3d07921",',\n                         made by <a href="https://github.com/cmfcmf">@cmfcmf</a>.\n                         The sourcecode can be found at <a href="https://github.com/cmfcmf/Anno2018">GitHub</a>.'),document.head.appendChild(t),document.body.appendChild(n),document.body.appendChild(o),u=new p,2e3,e.next=14,u.init(2097152e3);case 14:return window.fs=u,c=new Er(u),e.next=18,c.init();case 18:return c.render(n),e.next=21,c.isUploaded();case 21:if(e.sent){e.next=24;break}return console.warn("Anno 1602 files not yet uploaded."),e.abrupt("return");case 24:return a.settings.SCALE_MODE=a.SCALE_MODES.NEAREST,a.settings.MIPMAP_TEXTURES=a.MIPMAP_MODES.OFF,l=new a.Application({width:window.innerWidth,height:window.innerHeight-120,antialias:!1,transparent:!1}),n.insertAdjacentElement("afterbegin",l.view),d=new i.a({screenWidth:l.screen.width,screenHeight:l.screen.height,passiveWheel:!1}),l.stage.addChild(d),d.drag({direction:"all",wheel:!1}).wheel().mouseEdges({distance:20,speed:15}),f=new i.a({screenWidth:l.screen.width,screenHeight:l.screen.height,worldWidth:1024,worldHeight:768}),l.stage.addChild(f),e.next=35,qt(u);case 35:return h=new fe(u),e.next=38,h.load();case 38:return m=new ce(u),e.next=41,m.load();case 41:return console.log("Finished loading config."),g=new pn(u),e.next=45,g.load();case 45:return console.log("Finished loading music."),v=new Sn(u),y=new wn(u,m.getFieldData()),e.t0=JSON,e.next=51,u.openAndGetContentAsText("/animations.json");case 51:if(e.t1=e.sent,b=e.t0.parse.call(e.t0,e.t1),w=new ne(b,v),x=new zt(y),k=new Ae(m,v,w),S=new $(u,x,k,l,d,m,g,w),E=Object(s.c)("load"),R=Object(s.c)("gad"),_=Object(s.c)("animation"),A=Object(s.c)("island"),null===E){e.next=67;break}return e.next=64,S.loadByName(E);case 64:f.visible=!1,e.next=104;break;case 67:if(null===R){e.next=75;break}return console.info('Rendering "'.concat(R,'" screen.')),I=new xe(f,v),P=new un(u,I,g),e.next=73,P.renderScreen(R);case 73:e.next=104;break;case 75:if(null===_){e.next=81;break}return console.log('Rendering animation "'.concat(_,'".')),e.next=79,w.renderAnimation(_,d);case 79:e.next=104;break;case 81:if(null===A){e.next=99;break}return console.info('Rendering island "'.concat(A,'".')),e.next=85,y.loadIslandFileByName(A);case 85:for(O=e.sent,T=[];!O.eof();)T.push(dt.fromStream(O));return console.table(T),C=We(T.find((function(e){return["INSEL5","INSEL4","INSEL3"].includes(e.type)})).data),y.setIslandFields(C,[T.find((function(e){return"INSELHAUS"===e.type}))]),C.position=new a.Point(0,0),C.positionRect=new a.Rectangle(0,0,C.size.x,C.size.y),f.visible=!1,N=new G(d,k),e.next=97,N.render([C]);case 97:e.next=104;break;case 99:return j=new xe(f,v),(F=new un(u,j,g)).on("load-game",function(){var e=_r(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.load(t);case 2:f.visible=!1;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=104,F.renderScreen("menu_main");case 104:case"end":return e.stop()}}),e)})))()},"/dzE":function(module,__webpack_exports__,__webpack_require__){"use strict";(function(__dirname){__webpack_require__.d(__webpack_exports__,"a",(function(){return loadFFmpeg}));var async_lock__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("aNYc"),async_lock__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(async_lock__WEBPACK_IMPORTED_MODULE_0__),loadedFFmpeg;function asyncGeneratorStep(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){asyncGeneratorStep(a,r,i,o,s,"next",e)}function s(e){asyncGeneratorStep(a,r,i,o,s,"throw",e)}o(void 0)}))}}var lock=new async_lock__WEBPACK_IMPORTED_MODULE_0___default.a;function loadFFmpeg(){return _loadFFmpeg.apply(this,arguments)}function _loadFFmpeg(){return(_loadFFmpeg=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lock.acquire("ffmpeg",_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(loadedFFmpeg){e.next=6;break}return e.next=3,doLoadFFmpeg();case 3:return loadedFFmpeg=e.sent,e.next=6,new Promise((function(e,t){loadedFFmpeg({arguments:["-version"],returnCallback:e})}));case 6:case"end":return e.stop()}}),e)}))));case 2:return e.abrupt("return",loadedFFmpeg);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function doLoadFFmpeg(){return _doLoadFFmpeg.apply(this,arguments)}function _doLoadFFmpeg(){return _doLoadFFmpeg=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var ffmpeg;return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(console.log("Loading FFmpeg"),"undefined"==typeof window){_context3.next=7;break}return _context3.next=4,loadFFmpegInBrowser();case 4:ffmpeg=_context3.sent,_context3.next=8;break;case 7:ffmpeg=eval("require")(__dirname+"/../../node_modules/smk2mp4/demo/ffmpeg.js");case 8:return console.log("Finished loading FFmpeg"),_context3.abrupt("return",ffmpeg);case 10:case"end":return _context3.stop()}}),_callee3)}))),_doLoadFFmpeg.apply(this,arguments)}function loadFFmpegInBrowser(){return _loadFFmpegInBrowser.apply(this,arguments)}function _loadFFmpegInBrowser(){return(_loadFFmpegInBrowser=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){var n=function(){var n=self.ffmpeg_run;n?e(n):t("Could not load FFmpeg!")},r=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.src="ffmpeg.js",i.onreadystatechange=n,i.onload=n,r.appendChild(i)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}).call(this,"/")},0:function(e,t,n){n("LSZE"),n("ls82"),n("ZPch"),e.exports=n("/7QA")},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},cE7O:function(e,t,n){"use strict";function r(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}n.d(t,"a",(function(){return o}));var o=function(){var e,t;function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.pos=void 0,this.data=void 0,this.pos=0,this.data=e}return a(n,null,[{key:"fromZipObject",value:(e=regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.async("uint8array");case 2:return r=e.sent,e.abrupt("return",new n(r));case 4:case"end":return e.stop()}}),e)})),t=function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,u,"next",e)}function u(e){r(o,i,a,s,u,"throw",e)}s(void 0)}))},function(e){return t.apply(this,arguments)})}]),a(n,[{key:"position",value:function(){return this.pos}},{key:"seek",value:function(e){this.pos=e}},{key:"readString",value:function(e){for(var t="",n=!1;e--;){var r=this.read8();n||0===r?n=!0:t+=String.fromCharCode(r)}return t}},{key:"readStringUnterminated",value:function(e){for(var t="";e--;)t+=String.fromCharCode(this.read8());return t}},{key:"read",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e*=t;for(var n=[];e>0;)n.push(this.readNBytes(t)),e-=t;return n}},{key:"slice",value:function(e){var t=this.data.slice(this.pos,this.pos+e);return this.pos+=e,t}},{key:"read16",value:function(){return this.readNBytes(2)}},{key:"read24",value:function(){return this.readNBytes(3)}},{key:"read32",value:function(){return this.readNBytes(4)}},{key:"read32S",value:function(){return this.readNBytes(4)>>0}},{key:"read64",value:function(){return this.readNBytes(8)}},{key:"read8",value:function(){return this.data[this.pos++]}},{key:"eof",value:function(){return this.pos===this.length}},{key:"read8Bool",value:function(){return 0!==this.read8()}},{key:"readNBytes",value:function(e){for(var t=0,n=0;n<e;n++)t+=this.read8()*Math.pow(2,8*n);return t}},{key:"length",get:function(){return this.data.length}}]),n}()},daKf:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o}));var r=n("rPnE"),i=n("cE7O");function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.encoding="win1252"}var n,o,s;return n=t,(o=[{key:"decrypt",value:function(t){for(var n=new e(t.length),i=0;i<t.length;i++)n[i]=256-t.read8();return Object(r.decode)(n,this.encoding)}},{key:"encrypt",value:function(t){for(var n=new i.a(Object(r.encode)(t,this.encoding)),a=new e(n.length),o=0;o<n.length;o++)a[o]=256-n.read8();return a}}])&&a(n.prototype,o),s&&a(n,s),t}()}).call(this,n("tjlA").Buffer)},vurl:function(module,__webpack_exports__,__webpack_require__){"use strict";function uInt8ToBase64(arr){for(var CHUNK_SIZE=32768,index=0,length=arr.length,result="";index<length;){var slice=arr.subarray(index,Math.min(index+CHUNK_SIZE,length));result+=String.fromCharCode.apply(null,slice),index+=CHUNK_SIZE}return"undefined"!=typeof window?btoa(result):eval("require")("btoa")(result)}function getQueryParameter(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=window.location.href;e=e.replace(/[[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(n);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":t}function findRootInZip(e){var t=e.filter((function(e){return("/"+e).endsWith("/GFX/")}));if(1===t.length)return e.folder(t[0].name.replace("GFX/",""));throw new Error("Your ZIP file does not have the expected structure.")}function make2DArray(e,t){return Array(e).fill(void 0).map((function(){return Array(t).fill(null)}))}function assertNever(e){throw new Error("Unexpected object: ".concat(e))}__webpack_require__.d(__webpack_exports__,"e",(function(){return uInt8ToBase64})),__webpack_require__.d(__webpack_exports__,"c",(function(){return getQueryParameter})),__webpack_require__.d(__webpack_exports__,"b",(function(){return findRootInZip})),__webpack_require__.d(__webpack_exports__,"d",(function(){return make2DArray})),__webpack_require__.d(__webpack_exports__,"a",(function(){return assertNever}))}},[[0,1,2]]]);
//# sourceMappingURL=app.3d61e2335d7979c0a4a4.js.map