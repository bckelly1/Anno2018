(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"/7QA":function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"createTick",function(){return L}),n.d(r,"createDonateMoney",function(){return D}),n.d(r,"createSetSimulationSpeed",function(){return B}),n.d(r,"createAddMoney",function(){return U}),n.d(r,"createUpdateProducer",function(){return z});var i=n("XH0y"),a=n("UFs8"),o=n.n(a),s=n("IqKQ"),u=n("cE7O"),c=n("vurl");function l(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function d(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){l(a,r,i,o,s,"next",e)}function s(e){l(a,r,i,o,s,"throw",e)}o(void 0)})}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=n("7GJN"),h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.filer=void 0,this.filer=new p}var t,n,r;return t=e,(n=[{key:"init",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){return n.filer.init({persistent:!0,size:t},e,r)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"create",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){return n.filer.create(t,!1,e,r)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"mkdir",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){return n.filer.mkdir(t,!1,e,r)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"ls",value:function(){var e=d(regeneratorRuntime.mark(function e(t,n){var r,i,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(e,n){a.filer.ls(t,e,n)});case 2:if(r=e.sent,n){e.next=5;break}return e.abrupt("return",r);case 5:return i=n.split("|"),e.abrupt("return",r.filter(function(e){return e.isFile&&i.some(function(t){return e.name.endsWith(t)})}));case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.fullPath?t.fullPath:t).startsWith("/")){e.next=3;break}throw new Error('exists() only works with absolute paths, "'.concat(n,'" given.'));case 3:r=n.split("/").filter(function(e){return""!==e}),n="",i=!0,a=!1,o=void 0,e.prev=8,s=r[Symbol.iterator]();case 10:if(i=(u=s.next()).done){e.next=22;break}return c=u.value,n+="/",e.next=15,this.ls(n);case 15:if(l=e.sent,n+=c,void 0!==l.find(function(e){return e.fullPath===n})){e.next=19;break}return e.abrupt("return",!1);case 19:i=!0,e.next=10;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(8),a=!0,o=e.t0;case 28:e.prev=28,e.prev=29,i||null==s.return||s.return();case 31:if(e.prev=31,!a){e.next=34;break}throw o;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return e.abrupt("return",!0);case 37:case"end":return e.stop()}},e,this,[[8,24,28,36],[29,,31,35]])}));return function(t){return e.apply(this,arguments)}}()},{key:"open",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){return n.filer.open(t,e,r)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"openAndGetContentAsText",value:function(){var e=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.open(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.getTextContentFromFile.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"openAndGetContentAsStream",value:function(){var e=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=u.a,e.t1=this,e.next=4,this.open(t);case 4:return e.t2=e.sent,e.next=7,e.t1.getUint8ContentFromFile.call(e.t1,e.t2);case 7:return e.t3=e.sent,e.abrupt("return",new e.t0(e.t3));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"openAndGetContentAsUint8Array",value:function(){var e=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.open(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.getUint8ContentFromFile.call(e.t0,e.t1));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTextContentFromFile",value:function(){var e=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var r=new FileReader;r.onload=function(t){null!==r.result?e(r.result):n()},r.onerror=function(e){n()},r.readAsText(t)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUint8ContentFromFile",value:function(){var e=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var r=new FileReader;r.onload=function(t){null!==r.result?e(new Uint8Array(r.result)):n()},r.onerror=function(e){n()},r.readAsArrayBuffer(t)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"df",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){t.filer.df(function(t,n,r){return e({used:t,free:n,cap:r})},n)}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=d(regeneratorRuntime.mark(function e(t,n){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,i){return r.filer.write(t,{data:n},e,i)}));case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"rm",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){return n.filer.rm(t,e,r)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"rmRoot",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ls("/");case 2:return t=e.sent,e.abrupt("return",Promise.all(t.map(function(e){return n.rm(e.fullPath)})));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.ls(t);case 3:n=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",this.downloadFile(t));case 9:return e.abrupt("return",this.downloadDirectory(n));case 10:case"end":return e.stop()}},e,this,[[0,6]])}));return function(t){return e.apply(this,arguments)}}()},{key:"downloadFile",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="string"==typeof t?t:t.fullPath,e.next=3,this.openAndGetContentAsUint8Array(t);case 3:r=e.sent,(i=document.createElement("a")).setAttribute("href","data:application/json;base64,".concat(Object(c.d)(r))),i.setAttribute("download",n),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"downloadDirectory",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,r=!1,i=void 0,e.prev=3,a=t[Symbol.iterator]();case 5:if(n=(o=a.next()).done){e.next=12;break}return s=o.value,e.next=9,this.download(s);case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,i=e.t0;case 18:e.prev=18,e.prev=19,n||null==a.return||a.return();case 21:if(e.prev=21,!r){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])}));return function(t){return e.apply(this,arguments)}}()}])&&f(t.prototype,n),r&&f(t,r),e}(),m=n("Mpt7"),v=n("qVmS"),g=n("ANjH"),y=n("c9yz"),b=n("5HXA"),w=n("0R0V"),x=n("Q1FS"),k=n("67Y/"),S=n("ad02"),E=n("VnD/");function R(e,t){if(!Boolean(e))throw new Error(t||"unknown assertion error")}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){I(e,t,n[t])})}return e}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _,O="TICK",P="DONATE_MONEY",T="SET_SIMULATION_SPEED",G="ADD_MONEY",C="UPDATE_PRODUCER";function N(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)%n!=0?e:(++e>=t&&(e=0),e)}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:var n=e.timeGame+1;return A({},e,{timeGame:n,cntCity:N(e.cntCity,8,100,n),cntIsland:N(e.cntIsland,8,100,n),cntShipyard:N(e.cntShipyard,8,10,n),cntMilitary:N(e.cntMilitary,8,10,n),cntProduction:N(e.cntProduction,8,10,n)});case T:return A({},e,{simulationSpeed:t.payload});default:return e}}function F(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;switch(n.type){case P:var r=n.payload;return A({},t,(I(e={},r.fromPlayer,A({},t[r.fromPlayer],{money:t[r.fromPlayer].money-r.amount})),I(e,r.toPlayer,A({},t[r.toPlayer],{money:t[r.toPlayer].money+r.amount})),e));case G:var i=n.payload.playerId,a=n.payload.money;return A({},t,I({},i,A({},t[i],{money:t[i].money+a})));default:return t}}function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(m.Map)(),t=arguments.length>1?arguments[1]:void 0;switch(t.type){case C:var n=t.payload,r=n.id,i=n.patch;return e.mergeIn([r],i);default:return e}}function L(){return{type:O}}function D(e,t,n){return{type:P,payload:{fromPlayer:e,toPlayer:t,amount:n}}}function B(e){return{type:T,payload:e}}function U(e,t){return{type:G,payload:{playerId:e,money:t}}}function z(e,t){return{type:C,payload:{id:e,patch:t}}}!function(e){e[e.Paused=0]="Paused",e[e.Default=1]="Default",e[e.Slow=1]="Slow",e[e.Medium=2]="Medium",e[e.Fast=4]="Fast",e[e.SuperFast=8]="SuperFast"}(_||(_={}));var H=function e(t,n,r,i,a,o,s,u,c,l,d,f){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islands=t,this.players=n,this.tasks=r,this.gameName=i,this.soldiers=a,this.ships=o,this.kontors=s,this.castles=u,this.cities=c,this.trader=l,this.timers=d,this.producers=f,console.table(r),console.log(i),console.table(t),console.table(n),console.table(a),console.table(o),console.table(s),console.table(u),console.table(c),console.log(l),console.log(d),console.table(f)};function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){K(e,t,n[t])})}return e}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Y={simulationSpeed:0,cntCity:0,cntIsland:0,cntShipyard:0,cntMilitary:0,cntProduction:0,cntSettlers:[],cntGrowth:[],timeCity:0,timeIsland:0,timeShipyard:0,timeMilitary:0,timeProduction:0,timeGoodToolsCnt:0,timeGoodToolsMax:0,timeGame:0,noErzOutFlg:0,tutorFlg:0,aiLevel:0,missionNumber:0,gameId:0,cityNameNumber:0,timeNextDrought:0,timePirateSec:0,missionSubNumber:0,shipMax:0,timeNextVulcano:0,cntVulcano:0,timeSettlers:[],timeGrowth:[],enableTrader:!1,bigIronRunsOut:!1,enableDroughts:!1,enablePirate:!1,enableVulcano:!1},X=Object(m.Record)({players:{},islands:{},tasks:{},cities:[],kontors:[],producers:Object(m.Map)(),timers:Y});function J(e){return new x.Observable(function(t){return t.next(e.getState()),e.subscribe(function(){t.next(e.getState())})})}var $=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gameRenderer=t,this.configLoader=n,this.store=void 0,this.timerId=void 0,this.myPlayerId=0,this.keyboardManager=void 0,this.getFieldAtIsland=function(e,t){return e.fields[t.x][t.y]},this.getFieldAt=function(e){var t=Object.values(r.store.getState().islands).find(function(t){return t.positionRect.contains(e.x,e.y)});if(!t)return null;var n=new s.Point(e.x-t.position.x,e.y-t.position.y);return r.getFieldAtIsland(t,n)},this.tick=function(){r.store.dispatch(L())},this.keyboardManager=new v.b,this.keyboardManager.enable(),this.setupHotKeys()}var t,n,i;return t=e,(n=[{key:"begin",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(t){var n,i,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(m.Map)(t.producers.map(function(e,t){return[t,e]})),i=X({players:this.mapArrayById(t.players),islands:this.mapArrayById(t.islands),tasks:this.mapArrayById(t.tasks),cities:t.cities,kontors:t.kontors,producers:n,timers:Z({},t.timers,{simulationSpeed:_.Paused})}),this.store=Object(g.createStore)(Object(y.enableBatching)(Object(w.combineReducers)({players:F,islands:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}},timers:j,tasks:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}},cities:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]},kontors:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]},producers:M})),i,Object(b.devToolsEnhancer)({actionsBlacklist:[O],actionCreators:r})),this.watchSimulationSpeed(),this.watchTicksForUpkeep(),this.watchTicksForProducing(),J(this.store).pipe(Object(k.a)(function(e){return e.players[0].money}),Object(S.a)()).subscribe(function(e){a.gameRenderer.setMoney(e)}),this.store.dispatch(B(_.Default)),this.keyboardManager.enable(),e.next=11,this.gameRenderer.begin(this.myPlayerId);case 11:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){V(a,r,i,o,s,"next",e)}function s(e){V(a,r,i,o,s,"throw",e)}o(void 0)})});return function(e){return t.apply(this,arguments)}}()},{key:"mapArrayById",value:function(e){return e.reduce(function(e,t){return e[t.id]=t,e},{})}},{key:"watchSimulationSpeed",value:function(){var e=this;J(this.store).pipe(Object(k.a)(function(e){return e.timers.simulationSpeed}),Object(S.a)()).subscribe(function(t){e.timerId&&clearInterval(e.timerId),t!==_.Paused&&(e.timerId=window.setInterval(e.tick,100/t))})}},{key:"watchTicksForUpkeep",value:function(){var e=this;J(this.store).pipe(Object(k.a)(function(e){return e.timers.timeGame}),Object(E.a)(function(e){return e%100==0}),Object(S.a)()).subscribe(function(){console.log("upkeep calculation");for(var t=e.calculateUpkeeps(),n=0,r=Object.keys(t);n<r.length;n++){var i=r[n],a=Math.floor(t[i]/6);e.store.dispatch(U(parseInt(i,10),-a))}})}},{key:"watchTicksForProducing",value:function(){var e=this;J(this.store).pipe(Object(E.a)(function(e){return e.timers.timeGame%10==0}),Object(S.a)(function(e,t){return e.timers.timeGame===t.timers.timeGame})).subscribe(function(t){console.log("update producers");var n=e.configLoader.getFieldData(),r=t.producers.entrySeq().flatMap(function(r){var i=W(r,2),a=i[0],o=i[1];if(!o.active)return[];var s=t.islands[o.islandId],u=e.getFieldAtIsland(s,o.position).fieldId,c=n.get(u);if(R(c),128===o.producedGood&&1===o.timer){var l=o.firstGoodStock>=2*c.production.amount1&&o.secondGoodStock>=2*c.production.amount2&&o.stock<c.production.maxStock-1,d=o.stock+1;return e.gameRenderer.onProduced(s,o.position,d),[z(a,{stock:d,timer:l?c.production.interval:11,firstGoodStock:o.firstGoodStock-c.production.amount1,secondGoodStock:o.secondGoodStock-c.production.amount2,producedGood:l?128:0})]}if(0!==o.producedGood||1!==o.timer&&0!==t.timers.cntProduction)return[z(a,{timer:o.timer<=1?11:o.timer-1})];var f=o.firstGoodStock>=c.production.amount1&&o.secondGoodStock>=c.production.amount2&&o.stock<c.production.maxStock;return[z(a,{timer:f?c.production.interval:o.timer<=1?11:o.timer-1,producedGood:f?128:0})]});e.store.dispatch(Object(y.batchActions)(r.toArray()))})}},{key:"calculateUpkeeps",value:function(){var e=this,t=this.store.getState(),n=Object.keys(t.players).reduce(function(e,t){return e[t]=0,e},{}),r=t.islands;return t.producers.forEach(function(t){var i=r[t.islandId].fields[t.position.x][t.position.y],a=i.fieldId,o=i.playerId;R(65535!==a),R(o<7);var s=e.configLoader.getFieldData().get(a);R(s),n[o]+=s.production.upkeep[t.active?"active":"inactive"]},this),n}},{key:"setupHotKeys",value:function(){var e=this,t=v.a.F1;this.keyboardManager.onKeyPressedWithPreventDefault(t,function(){var t=e.store.getState(),n=t.players[e.myPlayerId],r=t.tasks[n.assignedTaskId];void 0!==r?console.info(r.text):console.info("It appears like you have no task :/")});for(var n=[{key:v.a.F2,zoom:1},{key:v.a.F3,zoom:2},{key:v.a.F4,zoom:3}],r=function(){var t=a[i];e.keyboardManager.onKeyPressedWithPreventDefault(t.key,function(){return e.gameRenderer.zoom(t.zoom)})},i=0,a=n;i<a.length;i++)r();for(var o=[{keys:[v.a.PAUSE],speed:_.Paused},{keys:[v.a.F5],speed:_.Slow},{keys:[v.a.F6],speed:_.Medium},{keys:[v.a.F7],speed:_.Fast},{keys:[v.a.SHIFT,v.a.F8],speed:_.SuperFast}],s=function(){var t=c[u];e.keyboardManager.onKeysPressedWithPreventDefault(t.keys,function(){return e.store.dispatch(B(t.speed))})},u=0,c=o;u<c.length;u++)s()}}])&&q(t.prototype,n),i&&q(t,i),e}(),Q=n("p0ib"),ee=n("0/uQ"),te=n("bne5"),ne=n("Rney");function re(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ie(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){re(a,r,i,o,s,"next",e)}function s(e){re(a,r,i,o,s,"throw",e)}o(void 0)})}}var ae=64,oe=32,se=function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.world=t,this.spriteLoader=n,this.render=function(){var e=ie(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.spriteLoader.init();case 2:return e.next=4,Promise.all(t.map(function(){var e=ie(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.spriteLoader.getIslandSprites(t));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 4:return n=e.sent,console.log("Map sprites loaded."),n.forEach(function(e){return e.forEach(function(e){return e.filter(function(e){return null!==e}).forEach(function(e){return r.world.addChild(e.sprite)})})}),console.log("Map sprites drawn."),e.abrupt("return",n);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()};function ue(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function le(e,t,n){return t&&ce(e.prototype,t),n&&ce(e,n),e}var de=function(){function e(t,n,r,i){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.world=t,this.islandRenderer=n,this.app=r,this.viewport=i,this.money=void 0,this.WIDTH=500,this.HEIGHT=350,this.fields=void 0,this.setMoney=function(e){a.money.text="Money: ".concat(e)},this.cull=function(){for(var t=a.viewport.getVisibleBounds(),n=e.worldPosToFieldPos(new s.Point(t.x-ae,t.y-oe)),r=e.worldPosToFieldPos(new s.Point(t.x+t.width+ae,t.y+t.height+oe+200)),i=0;i<a.WIDTH;i++)for(var o=0;o<a.HEIGHT;o++){var u=a.fields[i][o];u&&(u.visible=i+o>=n.x+n.y&&i-o>=n.x-n.y&&i+o<=r.x+r.y&&i-o<=r.x-r.y)}},this.money=new s.Text("",{fontFamily:"Arial",fontSize:24,fill:16715792})}return le(e,null,[{key:"fieldPosToWorldPos",value:function(e){var t=e.x,n=e.y,r=ae/2*(t-n),i=(t+n)*(oe/2);return new s.Point(r,i)}},{key:"worldPosToFieldPos",value:function(e){var t=(e.x/(ae/2)+e.y/(oe/2))/2,n=(e.y/(oe/2)-e.x/(ae/2))/2;return new s.Point(Math.round(t),Math.round(n)+1)}},{key:"worldPosToFieldPosLand",value:function(e){var t=new s.Point;return t.copyFrom(e),t.y-=-20,this.worldPosToFieldPos(t)}}]),le(e,[{key:"begin",value:function(){var t,n=(t=regeneratorRuntime.mark(function t(n){var r,i,a,o,u,l=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.debugControls(),this.viewport.removeChildren(),t.next=4,this.islandRenderer.render(this.world.islands);case 4:r=t.sent,i=Object(c.c)(this.WIDTH,this.HEIGHT),r.forEach(function(e){return e.forEach(function(e){return e.filter(function(e){return null!==e}).forEach(function(e){return i[e.mapPosition.x][e.mapPosition.y]=e.sprite})})}),a=null,o=0;case 9:if(!(o<this.WIDTH)||a){t.next=21;break}u=0;case 11:if(!(u<this.HEIGHT)){t.next=18;break}if(!i[o][u]){t.next=15;break}return a=i[o][u].texture,t.abrupt("break",18);case 15:u++,t.next=11;break;case 18:o++,t.next=9;break;case 21:i.forEach(function(t,n){return t.forEach(function(t,r){if(null===t){var o=new s.Sprite(a),u=e.fieldPosToWorldPos(new s.Point(n,r)),c=u.x,d=u.y;o.anchor.set(0,1),o.x=c,o.y=d,i[n][r]=o,l.viewport.addChild(o)}})}),this.fields=i,this.moveCameraToStartPosition(n),Object(Q.a)(Object(ee.a)(["initial"]),Object(te.a)(this.viewport,"zoomed"),Object(te.a)(this.viewport,"moved")).pipe(Object(ne.a)(200)).subscribe(this.cull);case 25:case"end":return t.stop()}},t,this)}),function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(e){ue(a,r,i,o,s,"next",e)}function s(e){ue(a,r,i,o,s,"throw",e)}o(void 0)})});return function(e){return n.apply(this,arguments)}}()},{key:"zoom",value:function(e){var t=this.viewport.center;this.viewport.scale.set(1/e),this.viewport.moveCenter(t.x,t.y),this.cull()}},{key:"onProduced",value:function(t,n,r){console.log("Producer at island ".concat(t.id," (").concat(n.x,", ").concat(n.y,") has now stock: ").concat(r,"."));var i=new s.Text("Lager: ".concat(r),{fontFamily:"Arial",fontSize:24,fill:16715792}),a=e.fieldPosToWorldPos(new s.Point(t.position.x+n.x,t.position.y+n.y));i.position.set(a.x,a.y),this.viewport.addChild(i)}},{key:"debugControls",value:function(){var t=this,n=new s.Container;n.addChild(this.money);var r=new s.Text("",{fontFamily:"Arial",fontSize:24,fill:16715792});r.y=30;var i=new s.Text("",{fontFamily:"Arial",fontSize:24,fill:16715792});i.y=60;var a=this.app.renderer.plugins.interaction,o=function(){var n=e.worldPosToFieldPosLand(t.viewport.toWorld(a.mouse.global));r.text="x: ".concat(n.x,", y: ").concat(n.y);var o=t.world.islands.find(function(e){return e.positionRect.contains(n.x,n.y)});i.text=o?"Island id: ".concat(o.id,", x: ").concat(n.x-o.position.x," y: ").concat(n.y-o.position.y):"Island id: ?"};o(),this.viewport.on("moved",o),this.viewport.on("wheel-scroll",o),a.on("pointermove",o),n.addChild(r),n.addChild(i),this.viewport.parent.addChild(n)}},{key:"moveCameraToStartPosition",value:function(e){var t=this.world.kontors.find(function(t){return t.playerId===e});if(void 0===t){var n=this.world.ships.find(function(t){return t.playerId===e});void 0===n?this.moveTo(new s.Point(250,150)):this.moveTo(n.position)}else{var r=t.position,i=this.world.islands.find(function(e){return e.id===t.islandId});this.moveTo(new s.Point(i.position.x+r.x,i.position.y+r.y))}}},{key:"moveTo",value:function(t){this.viewport.moveCenter(e.fieldPosToWorldPos(t))}}]),e}();function fe(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function pe(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function he(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){pe(a,r,i,o,s,"next",e)}function s(e){pe(a,r,i,o,s,"throw",e)}o(void 0)})}}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ve=function(){function e(t,n,r,i,a,o,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.gamParser=n,this.islandRenderer=r,this.app=i,this.viewport=a,this.configLoader=o,this.musicPlayer=s}var t,n,r;return t=e,(n=[{key:"loadByName",value:function(){var e=he(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadSavesAndMissions();case 2:if(n=e.sent,r=n.find(function(e){return e.name===t})){e.next=6;break}throw new Error("Could not find ".concat(t,". The following files are available: ").concat(n.map(function(e){return e.name}).join(", ")));case 6:return e.next=8,this.load(r);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=he(regeneratorRuntime.mark(function e(t){var n,r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.openAndGetContentAsStream(t);case 2:return n=e.sent,e.next=5,this.gamParser.getWorld(n);case 5:return r=e.sent,i=new de(r,this.islandRenderer,this.app,this.viewport),a=new $(i,this.configLoader),e.next=10,a.begin(r);case 10:this.musicPlayer.playAll();case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadSavesAndMissions",value:function(){var e=he(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.t0=t.push,e.t1=t,e.t2=fe,e.next=7,this.fs.ls("/saves",".gam");case 7:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4),e.next=14;break;case 12:e.prev=12,e.t5=e.catch(1);case 14:return n=[],e.prev=15,e.t6=n.push,e.t7=n,e.t8=fe,e.next=21,this.fs.ls("/missions-original",".szs|.szm");case 21:return e.t9=e.sent,e.t10=(0,e.t8)(e.t9),e.t6.apply.call(e.t6,e.t7,e.t10),e.t11=n.push,e.t12=n,e.t13=fe,e.next=29,this.fs.ls("/missions-custom",".szs|.szm");case 29:e.t14=e.sent,e.t15=(0,e.t13)(e.t14),e.t11.apply.call(e.t11,e.t12,e.t15),e.next=36;break;case 34:e.prev=34,e.t16=e.catch(15);case 36:return e.abrupt("return",t.concat(n));case 37:case"end":return e.stop()}},e,this,[[1,12],[15,34]])}));return function(){return e.apply(this,arguments)}}()}])&&me(t.prototype,n),r&&me(t,r),e}();function ge(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ye(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){ge(a,r,i,o,s,"next",e)}function s(e){ge(a,r,i,o,s,"throw",e)}o(void 0)})}}function be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var we=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.animationData=t,this.spriteLoader=n}var t,n,r;return t=e,(n=[{key:"getAnimation",value:function(){var e=ye(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,u,c,l,d,f,p,h,m,v,g,y,b,w,x,k,S;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.animationData.objects.FIGUR.items[t],console.log(n),0!==Object.values(n.nested_objects).length){e.next=4;break}throw new Error('Animation "'.concat(t,'" does not include sufficient animation data.'));case 4:return R(n.nested_objects.ANIM),r=n.Gfx,i=n.Rotate,a=0===i?1:8,R(n.GfxCategoryMapped.startsWith("GFX")),o=n.GfxCategoryMapped.substr("GFX".length),e.next=12,this.spriteLoader.getTextures(o);case 12:for(u=e.sent,c={},l=0,d=Object.keys(n.nested_objects.ANIM);l<d.length;l++){for(f=d[l],p=[],h=n.nested_objects.ANIM[f],m=h.AnimAnz,v=1/60*(1e3/h.AnimSpeed),g=h.AnimAdd,h.AnimRept?h.AnimRept:0,y=h.Rotate?h.Rotate:i,b=0;b<a;b++){for(w=r+h.AnimOffs+b*y,x=[],k=0;k<m;k++)x.push(u.get(w)),w+=g;(S=new s.AnimatedSprite(x)).loop="ENDLESS"===h.Kind,S.animationSpeed=v,p.push(S)}c[f]={sprites:p,config:h}}return e.abrupt("return",c);case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"renderAnimation",value:function(){var e=ye(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAnimation(t);case 2:for(r=e.sent,i=0,a=function(){var e=s[o],t=r[e].sprites,a=0;t.forEach(function(e){e.position.set(a,i),a+=e.width,n.addChild(e),e.play()}),i+=50},o=0,s=Object.keys(r);o<s.length;o++)a();case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}])&&be(t.prototype,n),r&&be(t,r),e}();function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ke=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=void 0,this.gfxId=void 0,this.kind=void 0,this.size=void 0,this.rotate=void 0,this.animAdd=void 0,this.yOffset=void 0,this.animTime=void 0,this.animAnz=void 0,this.production=void 0,this.id=t.Id,this.gfxId=t.Gfx,this.kind=t.Kind,this.size=new s.Point(t.Size.x,t.Size.y),this.rotate=t.Rotate,this.animAdd=t.AnimAdd,this.animAnz=t.AnimAnz,this.animTime="TIMENEVER"===t.AnimTime?-1:t.AnimTime,this.yOffset=-t.Posoffs;var n=t.nested_objects.HAUS_PRODTYP[0],r={active:0,inactive:0};Array.isArray(n.Kosten)?(r.active=n.Kosten[0],r.inactive=n.Kosten[1]):r.active=r.inactive=void 0!==n.Kosten?n.Kosten:0,this.production={good:n.Ware,upkeep:r,good1:n.Rohstoff,good2:n.Workstoff,amount1:n.Rohmenge,amount2:void 0!==n.Workmenge?n.Workmenge:0,radius:n.Radius,interval:n.Interval,maxStock:n.Maxlager}}var t,n,r;return t=e,(n=[{key:"getSprites",value:function(e,t,n,r,i){for(var a=[],o=n%2==0?this.size.x:this.size.y,u=n%2==0?this.size.y:this.size.x,c=0;c<u;c++)for(var l=0;l<o;l++){var d=t.x+l,f=t.y+c,p=de.fieldPosToWorldPos(new s.Point(d,f)),h=p.x,m=p.y,v=void 0;if(0===this.animAdd||-1===this.animTime){var g=this.getTexture(l,c,n,r,i);v=new s.Sprite(g)}else{for(var y=[],b=0;b<this.animAnz;b++)y.push(this.getTexture(l,c,n,b,i));var w=new s.AnimatedSprite(y);w.animationSpeed=1/60*(1e3/this.animTime),w.play(),v=w}v.anchor.set(0,1),v.x=h,v.y=m+this.yOffset,a.push({sprite:v,pixelPosition:new s.Point(v.x,v.y),mapPosition:new s.Point(d,f),mapPositionOnIsland:new s.Point(d-e.x,f-e.y)})}return a}},{key:"getTexture",value:function(e,t,n,r,i){var a=this.gfxId;if(this.rotate>0&&(a+=n*this.size.x*this.size.y),a+=r*this.animAdd,0===n)a+=t*this.size.x+e;else if(1===n)a+=this.size.x*this.size.y-1-(e*this.size.x+(this.size.x-1-t));else if(2===n)a+=(this.size.y-1-t)*this.size.x+(this.size.x-1-e);else{if(3!==n)throw new Error("Invalid building rotation: ".concat(n,"."));a+=e*this.size.x+(this.size.x-1-t)}var o=i.get(a);if(void 0===o)throw new Error("Could not load texture ".concat(a,"."));return o}}])&&xe(t.prototype,n),r&&xe(t,r),e}();function Se(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Re=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.loaded=!1,this.fieldData=new Map}var t,n,r;return t=e,(n=[{key:"load",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(){var t,n,r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.fs.openAndGetContentAsText("/fields.json");case 3:for(e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1).objects.HAUS.items,n=0,r=Object.keys(t);n<r.length;n++)i=r[n],a=parseInt(t[i].Id,10),this.fieldData.set(a,new ke(t[i]));this.loaded=!0;case 7:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Se(a,r,i,o,s,"next",e)}function s(e){Se(a,r,i,o,s,"throw",e)}o(void 0)})});return function(){return t.apply(this,arguments)}}()},{key:"getFieldData",value:function(){if(!this.loaded)throw new Error("Configuration is not loaded. Call .load() first!");return this.fieldData}}])&&Ee(t.prototype,n),r&&Ee(t,r),e}();function Ae(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _e=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t}var t,n,r;return t=e,(n=[{key:"load",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(){var t,n,r,i,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t={ZEI20V:{size:24}},n=regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=i[r],console.log("Loading font ".concat(t,".")),e.next=4,a.fs.openAndGetContentAsUint8Array("/fonts/".concat(t,"/font.xml"));case 4:return n=e.sent,e.next=7,new Promise(function(e){s.Loader.shared.add(t,"data:application/xml;base64,".concat(Object(c.d)(n))).load(e)});case 7:console.log("Finished loading font ".concat(t,"."));case 8:case"end":return e.stop()}},e)}),r=0,i=Object.keys(t);case 3:if(!(r<i.length)){e.next=8;break}return e.delegateYield(n(),"t0",5);case 5:r++,e.next=3;break;case 8:case"end":return e.stop()}},e)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Ae(a,r,i,o,s,"next",e)}function s(e){Ae(a,r,i,o,s,"throw",e)}o(void 0)})});return function(){return t.apply(this,arguments)}}()}])&&Ie(t.prototype,n),r&&Ie(t,r),e}();function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Te(e,t){return!t||"object"!==Oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ge(e){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ce(e,t){return(Ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ne=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Te(this,(e=Ge(t)).call.apply(e,[this].concat(i)))).dragging=!1,n.topY=void 0,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ce(e,t)}(t,s["Sprite"]),n=t,(r=[{key:"setSliderData",value:function(e,t,n){var r=this;this.position.set(this.position.x,this.position.y+(e-n)/2),this.topY=this.position.y,this.on("mousedown",function(e){r.dragging=!0}),this.on("mouseup",function(e){r.dragging=!1}),this.on("mousemove",function(e){if(r.dragging){var t=e.data.originalEvent.offsetY-r.texture.height/2;r.position.y=r.clamp(t,r.topY,r.topY+n-r.texture.height/2)}})}},{key:"clamp",value:function(e,t,n){return Math.min(Math.max(t,e),n)}}])&&Pe(n.prototype,r),i&&Pe(n,i),t}();function je(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Me=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stage=t,this.spriteLoader=n,this.videos=[]}var t,n,r;return t=e,(n=[{key:"render",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(t,n){var r,i,a,o,u,c,l,d,f,p,h,m=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(this.destroyVideos(),this.stage.removeChildren(),r=new Map,i=0,a=Object.keys(t.variables);i<a.length;i++)o=a[i],u=t.variables[o],o.startsWith("BLK_")&&r.set(u,o.substring(4));c=[],l=0,d=t.objects.GADGET.items,f=regeneratorRuntime.mark(function e(){var t,i,a,o,u,f,v,g,y,b,w,x,k,S,E,A,I,_,O,P;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h[p],i=d[t],a=i.Id,o=i.Blocknr,u=i.Gfxnr,"GAD_UNUSED"!==(f=i.Kind)){e.next=8;break}return e.abrupt("return","continue");case 8:v=new s.Point(i.Pos[0],i.Pos[1]),i.Posoffs&&v.set(v.x+i.Posoffs[0],v.y+i.Posoffs[1]),g=void 0!==i.Size?new s.Point(i.Size.x,i.Size.y):null,y=void 0===i.Noselflg||0===i.Noselflg,b=i.Pressoff,(w=1===i.Reiheflg)&&R(y),R(void 0!==o),x=void 0!==i.Slidverflg,k=i.Slidoffs,S=i.Slidsize,e.t0=f,e.next="GAD_GFX"===e.t0?22:"GAD_TEXTL"===e.t0?34:"GAD_TEXTZ"===e.t0?34:"GAD_TEXTR"===e.t0?34:43;break;case 22:return e.next=24,m.spriteLoader.getTextures("TOOLS/".concat(r.get(o)));case 24:return E=e.sent,A=E.get(u),I=E.get(u+b),(_=x?new Ne(A):new s.Sprite(A)).position.set(v.x,v.y),_.name="menu-".concat(a),x&&_.setSliderData(g.y,k[1],S[1]),y&&(_.buttonMode=!0,_.interactive=!0,O=n.buttons[l],w&&(0===c.length&&(_.texture=I),c.push({sprite:_,activeTexture:I,defaultTexture:A})),_.on("mousedown",function(){if(_.texture=I,w)for(var e=0,t=c;e<t.length;e++){var n=t[e];n.sprite!==_&&(n.sprite.texture=n.defaultTexture)}O(m.stage)}),w||_.on("mouseup",function(){return _.texture=A}),l++),m.stage.addChild(_),e.abrupt("break",44);case 34:return 24,(P=new s.BitmapText("Here goes text!",{font:{name:"ZEI20V",size:24}})).position.set(v.x,v.y),P.pivot.set(0,24),P.name="menu-".concat(a),P.hitArea=new s.Rectangle(0,0,g.x,g.y),f.endsWith("Z")?P.pivot.set(P.x/2,P.pivot.y):f.endsWith("R"),m.stage.addChild(P),e.abrupt("break",44);case 43:console.warn("Unsupported kind: ".concat(f));case 44:case"end":return e.stop()}},e)}),p=0,h=Object.keys(d);case 9:if(!(p<h.length)){e.next=17;break}return e.delegateYield(f(),"t0",11);case 11:if("continue"!==e.t0){e.next=14;break}return e.abrupt("continue",14);case 14:p++,e.next=9;break;case 17:return e.next=19,n.onLoad(this.stage);case 19:case"end":return e.stop()}},e,this)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){je(a,r,i,o,s,"next",e)}function s(e){je(a,r,i,o,s,"throw",e)}o(void 0)})});return function(e,n){return t.apply(this,arguments)}}()},{key:"renderVideo",value:function(e,t){var n=this;e.texture.baseTexture.resource.source.addEventListener("ended",function(){n.stage.removeChild(e),t()},{once:!0}),this.stage.addChild(e),this.videos.push(e)}},{key:"renderVideoFullscreen",value:function(e,t){var n=this;this.destroyVideos(),this.stage.removeChildren(),e.texture.baseTexture.resource.source.addEventListener("ended",function(){n.stage.removeChild(e),t()},{once:!0}),e.scale.set(2,2);var r=512-e.texture.width*e.scale.x/2,i=384-e.texture.height*e.scale.y/2;e.position.set(r,i),this.stage.addChild(e)}},{key:"destroyVideos",value:function(){this.videos.forEach(function(e){return e.destroy({texture:!0,baseTexture:!0})}),this.videos=[]}}])&&Fe(t.prototype,n),r&&Fe(t,r),e}();function Le(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function De(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Le(a,r,i,o,s,"next",e)}function s(e){Le(a,r,i,o,s,"throw",e)}o(void 0)})}}var Be=function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.configLoader=n,this.spriteLoader=r,this.inited=!1,this.fields=new Map,this.textures=new Map,this.init=De(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i.inited){e.next=6;break}return e.next=3,i.spriteLoader.getTextures("STADTFLD");case 3:i.textures=e.sent,i.fields=i.configLoader.getFieldData(),i.inited=!0;case 6:case"end":return e.stop()}},e)})),this.getIslandSprites=function(){var e=De(regeneratorRuntime.mark(function e(t){var n,r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.init();case 2:for(n=Object(c.c)(t.size.x,t.size.y),r=0;r<t.size.x;r++)for(a=0;a<t.size.y;a++)i.handleField(t,r,a,n);return e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),this.handleField=function(e,t,n,r){var a=e.fields[t][n];if(null!==a){var o=i.fields.get(a.fieldId);if(void 0===o)throw new Error("Could not load config for ".concat(a.fieldId,"."));var u=new s.Point(e.position.x+t,e.position.y+n);o.getSprites(e.position,u,a.rotation,a.ani,i.textures).forEach(function(e){var t=e.mapPositionOnIsland,n=t.x,i=t.y;null===r[n][i]&&(r[n][i]=e)})}}};function Ue(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ze(e){return He.apply(this,arguments)}function He(){var e;return e=regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=document.createElement("video")).src="data:video/mp4;base64,".concat(Object(c.d)(t)),r=s.Texture.from(n),e.next=5,new Promise(function(e,t){r.baseTexture.addListener("loaded",e),r.baseTexture.addListener("error",t)});case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}),(He=function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Ue(a,r,i,o,s,"next",e)}function s(e){Ue(a,r,i,o,s,"throw",e)}o(void 0)})}).apply(this,arguments)}function We(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ze,Ke,Ve=function(){var e,t,n;function r(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.type=e,this.ready=t,this.hp=n}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read8(),n=e.read8();e.read16();var i=e.read16();return e.read16(),new r(t,0!=(16&n),i)}}],(t=null)&&We(e.prototype,t),n&&We(e,n),r}();function qe(e){var t=e.read8(),n=new s.Point(e.read8(),e.read8());e.read8(),e.read32();var r=e.read16(),i=e.read16(),a=e.read16();e.read16();var o=function(e){for(var t=[],n=0;n<8;n++)t.push(Ve.fromSaveGame(e));return t}(e);return e.read(32),{islandId:t,position:n,numSwords:r,numMuscets:i,numCanons:a,units:o}}function Ye(e){for(var t=e.read8(),n=e.read8(),r=e.read16(),i=!e.read8Bool(),a=(e.read(87),[]),o=0;o<5;o++)a.push(e.read32());e.read(15);for(var s=[],u=0;u<5;u++)s.push(e.read8());e.read(3);return{islandId:t,playerId:r,cityIslandNum:n,progressAllowed:i,inhabitants:a,taxes:s,name:e.readString(33)}}function Xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Iron=2]="Iron",e[e.Gold=3]="Gold"}(Ze||(Ze={})),function(e){e[e.Small=1]="Small",e[e.Big=0]="Big"}(Ke||(Ke={}));var Je,$e,Qe=function(){var e,t,n;function r(e,t,n,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.kind=e,this.size=t,this.amount=n,this.position=i,this.discoveredBy=a}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read8(),n=new s.Point(e.read8(),e.read8()),i=e.read8(),a=e.read8();return e.read8(),new r(t,a,e.read16(),n,i)}}],(t=null)&&Xe(e.prototype,t),n&&Xe(e,n),r}();function et(e,t,n,r,i){i.read8();var a=new s.Point(i.read8(),i.read8());return{id:e,position:t,size:a,positionRect:new s.Rectangle(t.x,t.y,a.x,a.y),numBaseIsland:r,numOreLocations:0,oreLocations:[],fertility:{tobacco:!1,sugarcane:!1,wine:!1,cotton:!1,cacao:!1,spice:!1},isSouth:n,differsFromBaseIsland:!1,fertilityDiscovered:!1,fields:[]}}function tt(e,t,n,r,i){return et(e,t,n,r,i)}function nt(e,t,n,r,i){return et(e,t,n,r,i)}function rt(e){var t=e.read8(),n=e.read8(),r=e.read8(),i=(e.read8(),e.read16()),a=e.read16();e.read16(),e.read16(),e.read(8);R(e.read(3).every(function(e){return 0===e}));e.read8(),e.read8Bool(),e.read8();var o=e.read8(),u=e.read8(),c=[Qe.fromSaveGame(e),Qe.fromSaveGame(e)],l=(e.read(48),function(e){return{tobacco:(e&1<<Je.TOBACCO)>0,sugarcane:(e&1<<Je.SUGARCANE)>0,wine:(e&1<<Je.WINE)>0,cotton:(e&1<<Je.COTTON)>0,cacao:(e&1<<Je.CACAO)>0,spice:(e&1<<Je.SPICE)>0}}(e.read32())),d=e.read16(),f=(e.read16(),e.read8Bool()),p=e.read8Bool();e.read8(),e.read8(),e.read32(),e.read32();e.read32();return{id:t,position:new s.Point(i,a),size:new s.Point(n,r),positionRect:new s.Rectangle(i,a,n,r),numBaseIsland:d,numOreLocations:o,oreLocations:c,fertility:l,isSouth:f,differsFromBaseIsland:p,fertilityDiscovered:0!==u,fields:[]}}function it(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.TOBACCO=1]="TOBACCO",e[e.SUGARCANE=3]="SUGARCANE",e[e.WINE=5]="WINE",e[e.COTTON=4]="COTTON",e[e.CACAO=6]="CACAO",e[e.SPICE=2]="SPICE"}(Je||(Je={})),function(e){e[e.None=0]="None",e[e.Sell=1]="Sell",e[e.Buy=2]="Buy"}($e||($e={}));var at,ot=function(){var e,t,n;function r(e,t,n,i,a,o,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.goodId=e,this.sellingPrice=t,this.buyingPrice=n,this.wantedSellingAmount=i,this.wantedBuyingAmount=a,this.currentAmount=o,this.action=s}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read32(),n=(1023&t)>>0,i=(1047552&t)>>10,a=(4293918720&t)>>20,o=(e.read32(),e.read16()>>5),s=e.read16()>>5,u=e.read16()>>5,c=(e.read16(),e.read16());e.read16();return new r(c,n,i,o,s,u,a)}}],(t=null)&&it(e.prototype,t),n&&it(e,n),r}();function st(e){return{islandId:e.read8(),position:new s.Point(e.read8(),e.read8()),playerId:e.read8(),goods:function(e){for(var t=[],n=0;n<2;n++)ot.fromSaveGame(e);for(var r=2;r<25;r++)t.push(ot.fromSaveGame(e));for(var i=25;i<50;i++)ot.fromSaveGame(e);return t}(e)}}function ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Inactive=0]="Inactive",e[e.OfferedByMe=1]="OfferedByMe",e[e.OfferedByOther=2]="OfferedByOther",e[e.Active=3]="Active"}(at||(at={}));var ct,lt=function(){var e,t,n;function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.state=e,this.time=t}return e=r,n=[{key:"fromSaveGame",value:function(e){return new r(e.read32(),e.read32())}}],(t=null)&&ut(e.prototype,t),n&&ut(e,n),r}();function dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}ct||(ct={});var ft,pt,ht=function(){var e,t,n;function r(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.kind=e,this.otherPlayerId=t,this.time=n}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read8(),n=e.read8();return R(0===e.read16()),new r(t,n,e.read32())}}],(t=null)&&dt(e.prototype,t),n&&dt(e,n),r}();function mt(e){var t=e.read32S(),n=e.read8(),r=e.read8(),i=(e.read8(),e.read8()),a=e.read8();R(0===e.read8());var o=e.read16(),s=e.read8(),u=e.read8(),c=e.read8Bool(),l=e.read8Bool(),d=e.read16(),f=e.read16(),p=e.read16(),h=e.read16(),m=e.read16(),v=e.read16(),g=e.read8(),y=e.read8(),b=(1&y)>0,w=(2&y)>0,x=e.read(6),k=e.read8()/32+1,S=e.read8()/32+1;R(e.read(14).every(function(e){return 0===e}));var E=e.read32(),A=e.read16(),I=e.read16();R(4294967295===e.read32());e.read(264);for(var _=[],O=0;O<3;O++)_.push(lt.fromSaveGame(e));for(var P=[],T=0;T<3;T++)P.push(lt.fromSaveGame(e));e.read(72);for(var G=[],C=0;C<64;C++)G.push(ht.fromSaveGame(e));var N=e.readString(64),j=e.readString(48);return console.log("player ".concat(r,":  "),a,o,u,g,x),{id:r,kind:n,color:i,fullName:N,shortName:j,tradeContracts:_,peaceContracts:P,money:t,enemiesDefeated:d,triumphArchesBuilt:f,soldiersKilled:p,soldiersFallen:h,shipsSunken:m,shipsKilled:v,accessibleBuildings:E,statues:A,statuesBuilt:I,palaceBuilt:c,cathedralBuilt:l,enablePositiveWillInfluence:b,enableNegativeWillInfluence:w,positiveWillInfluence:k,negativeWillInfluence:S,assignedTaskId:s,playerEvents:G}}function vt(e){var t=e.read8(),n=new s.Point(e.read8(),e.read8()),r=e.read8(),i=e.read8(),a=e.read16()/32;e.read8();var o=e.read16(),u=e.read16()/32,c=e.read16()/32;e.read8();var l=e.read8(),d=e.read16()/32,f=e.read16(),p=e.read8(),h=(1&p)>0,m=(2&p)>0,v=p>>2&15,g=0==(64&p),y=15&e.read8();return R(0===e.read16()),{islandId:t,position:n,speed:r,speedCount:i,stock:a,timer:o,firstGoodStock:c,secondGoodStock:u,producedGood:l,prodCnt:d,timeCnt:f,active:h,connectedToMarket:m,animCnt:v,allowGoodPickup:g,noGoodCnt:y}}function gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.HUMAN=0]="HUMAN",e[e.AI=9]="AI",e[e.TRADER=13]="TRADER",e[e.PIRATE=14]="PIRATE",e[e.NATIVE=11]="NATIVE"}(ft||(ft={})),function(e){e[e.Stopped=0]="Stopped",e[e.Sailing=55]="Sailing",e[e.Unknown=53]="Unknown",e[e.Unknown2=52]="Unknown2",e[e.Unknown3=54]="Unknown3",e[e.Unknown4=51]="Unknown4"}(pt||(pt={}));var yt,bt=function(){var e,t,n;function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.position=e,this.state=t}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read32(),n=t>>8&255,i=t>>16&255,a=t>>24&255,o=t>>0&255;return R(o in pt),new r(new s.Point(a+((15&n)<<8),i+((240&n)<<4)),o)}}],(t=null)&&gt(e.prototype,t),n&&gt(e,n),r}();function wt(e){var t=e.readString(28),n=new s.Point(e.read16(),e.read16()),r=(e.read(12),bt.fromSaveGame(e),bt.fromSaveGame(e),bt.fromSaveGame(e),e.read32(),e.read16()),i=(e.read32(),e.read8(),e.read8(),e.read16(),e.read16()),a=(e.read16(),e.read8(),e.read8()),o=(e.read32(),e.read16()),u=function(e,t){for(var n=[],r=0;r<t;r++)n.push({id:e.read8(),kontor_id:e.read8(),_1:e.read16(),goods:xt(e,2),_2:e.read(16)});return n}(e,8);e.read16();return{id:i,playerId:a,position:n,rotation:o,name:t,hp:r,tradeStops:u,cargo:xt(e,8)}}function xt(e,t){for(var n=[],r=0;r<t;r++)n.push({good_id:e.read16(),amount:e.read16(),action:e.read32()});return n}function kt(e){var t=new s.Point(e.read16()/2,e.read16()/2),n=e.read16(),r=e.read16(),i=e.read16(),a=(e.read(4),e.read16(),e.read16(),e.read8(),e.read8(),e.read32(),e.read8()),o=(e.read8(),e.read8(),e.read8()),u=(e.read8(),e.read8Bool());e.read(4),e.read(4),e.read(30);return{id:i,playerId:a,type:r,position:t,rotation:o,isPatrolling:u,hp:n}}function St(e){var t=e.read32(),n=e.read(28),r=e.read8();R(0===e.read8());var i=e.read8();R(0===e.read8());var a=e.read8();R(e.read(6).every(function(e){return 0===e}));var o=[];e.read8Bool()&&o.push("any"),e.read8Bool()&&o.push("red"),e.read8Bool()&&o.push("blue"),e.read8Bool()&&o.push("yellow"),e.read8Bool()&&o.push("white"),e.read8Bool()&&o.push("trader"),e.read8Bool()&&o.push("pirate"),e.read8Bool()&&o.push("native");for(var s=e.read(25),u=e.read32(),c=e.read32(),l=e.read32(),d=e.read(16),f=e.readString(2048),p=e.read(8),h=[],m=0;m<3;m++)h.push({count:e.read32(),requiredLevel:e.read32(),requiredLevelCount:e.read32()});var v=e.read(36),g={count:e.read32(),requiredLevel:e.read32(),requiredLevelCount:e.read32()};return console.log("task",t,n,s,d,p,v),{id:t,text:f,successVideoId:c,playersToKill:o,requiredBalance:u,requiredTradeBalance:l,ownCityReachInhabitants:h,helpOtherToReachInhabitantsPlayerId:a,helpOtherToReachInhabitants:g,monopolyGoodId1:r,monopolyGoodId2:i}}function Et(e){var t=e.read8(),n=e.read8(),r=e.read8(),i=e.read8(),a=e.read8();R(e.read(63).every(function(e){return 0===e}));var o=e.read(32),s=e.read(32),u=e.read32(),c=e.read32(),l=e.read32(),d=e.read32(),f=e.read32(),p=e.read32(),h=e.read32(),m=e.read32(),v=e.read8(),g=e.read8(),y=e.read8(),b=e.read8(),w=e.read32(),x=0==(64&w),k=0==(8&w),S=0==(4&w),E=0==(1&w),A=0==(256&w),I=e.read32(),_=e.read32(),O=e.read32(),P=e.read32(),T=e.read32(),G=e.read32();e.read(4),e.read(4);var C=e.read32(),N=e.read32();e.read(49,4);var j={cntCity:t,cntIsland:n,cntShipyard:r,cntMilitary:i,cntProduction:a,cntSettlers:o,cntGrowth:s,timeCity:u,timeIsland:c,timeShipyard:l,timeMilitary:d,timeProduction:f,timeGoodToolsCnt:p,timeGoodToolsMax:h,timeGame:m,noErzOutFlg:v,tutorFlg:g,aiLevel:y,missionNumber:b,gameId:I,cityNameNumber:_,timeNextDrought:O,timePirateSec:P,missionSubNumber:T,shipMax:G,timeNextVulcano:C,cntVulcano:N,timeSettlers:e.read(32,4),timeGrowth:e.read(32,4),enableTrader:x,bigIronRunsOut:k,enableDroughts:S,enablePirate:E,enableVulcano:A};return console.log(j),j}function Rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Swordsman=0]="Swordsman",e[e.Cavalry=1]="Cavalry",e[e.Musketeer=2]="Musketeer",e[e.Gunner=3]="Gunner",e[e.Native=8]="Native"}(yt||(yt={}));var At=function(){var e,t,n;function r(e,t,n,i,a,o,s,u,c,l,d,f,p){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.numNativesNorth=e,this.numNativesSouth=t,this.numBigIronOre=n,this.numSmallIronOre=i,this.numGoldOre=a,this.numWine=o,this.numSugarCane=s,this.numSpice=u,this.numCacao=c,this.numTobacco=l,this.numCotton=d,this.numTreasures=f,this.islandTemplates=p}return e=r,n=[{key:"fromSaveGame",value:function(e){for(var t=e.slice(100),n=t[64],i=t[68],a=e.read32(),o=e.slice(268),u=o[46],c=o[54],l=o[62],d=o[110],f=o[95],p=o[86],h=o[118],m=o[78],v=o[102],g=o[174],y=[],b=0;b<a;b++){var w=e.read8(),x=0===w,k=1===w,S=e.read8();if(S<0||S>4)throw new Error("Invalid island size category: ".concat(S,"."));R(0===e.read8());var E=e.read8(),A=(e.read32(),new s.Point(e.read32(),e.read32()));y.push({num:E,size:S,position:A,climate:x?"NORTH":k?"SOUTH":"ANY"})}var I=!0,_=!1,O=void 0;try{for(var P,T=e.slice(e.length-e.position())[Symbol.iterator]();!(I=(P=T.next()).done);I=!0){R(0===P.value)}}catch(e){_=!0,O=e}finally{try{I||null==T.return||T.return()}finally{if(_)throw O}}return new r(n,i,u,c,l,d,f,p,h,m,v,g,y)}},{key:"empty",value:function(){return new r(0,0,0,0,0,0,0,0,0,0,0,0,[])}}],(t=null)&&Rt(e.prototype,t),n&&Rt(e,n),r}();function It(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ot=function(){var e,t,n;function r(e,t,n){It(this,r),this.type=e,this.length=t,this.data=void 0,this.data=new u.a(n.slice(t))}return e=r,n=[{key:"empty",value:function(e){return new r(e,0,new u.a(new Uint8Array))}},{key:"fromStream",value:function(e){return new r(e.readString(16),e.read32(),e)}}],(t=null)&&_t(e.prototype,t),n&&_t(e,n),r}();function Pt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Tt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ct=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islandLoader=t}var t,n,r;return t=e,(n=[{key:"populateWorld",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s,u,c,l,d,f,p,h,m,v,g;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=Math.max.apply(Math,Pt(t.islands.map(function(e){return e.id})))+1,i=!0,a=!1,o=void 0,e.prev=4,s=n.islandTemplates[Symbol.iterator]();case 6:if(i=(u=s.next()).done){e.next=36;break}return c=u.value,e.next=10,this.islandLoader.loadRandomIslandFile(c.size,c.climate);case 10:for(l=e.sent,d=l.data,f=l.isSouth,p=l.id,h=[];!d.eof();)h.push(Ot.fromStream(d));R(void 0!==(m=h.find(function(e){return["INSEL5","INSEL4","INSEL3"].includes(e.type)}))),R(void 0!==(v=h.find(function(e){return"INSELHAUS"===e.type}))),g=void 0,e.t0=m.type,e.next="INSEL5"===e.t0?24:"INSEL4"===e.t0?26:"INSEL3"===e.t0?28:30;break;case 24:return g=nt(r++,c.position,f,p,m.data),e.abrupt("break",31);case 26:return g=tt(r++,c.position,f,p,m.data),e.abrupt("break",31);case 28:return g=et(r++,c.position,f,p,m.data),e.abrupt("break",31);case 30:throw new Error("This code cannot be reached.");case 31:this.islandLoader.setIslandFields(g,[v]),t.islands.push(g);case 33:i=!0,e.next=6;break;case 36:e.next=42;break;case 38:e.prev=38,e.t1=e.catch(4),a=!0,o=e.t1;case 42:e.prev=42,e.prev=43,i||null==s.return||s.return();case 45:if(e.prev=45,!a){e.next=48;break}throw o;case 48:return e.finish(45);case 49:return e.finish(42);case 50:case"end":return e.stop()}},e,this,[[4,38,42,50],[43,,45,49]])}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Tt(a,r,i,o,s,"next",e)}function s(e){Tt(a,r,i,o,s,"throw",e)}o(void 0)})});return function(e,n){return t.apply(this,arguments)}}()}])&&Gt(t.prototype,n),r&&Gt(t,r),e}();function Nt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function jt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Ft(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){jt(a,r,i,o,s,"next",e)}function s(e){jt(a,r,i,o,s,"throw",e)}o(void 0)})}}function Mt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Lt,Dt,Bt,Ut,zt,Ht,Wt,Zt,Kt,Vt,qt,Yt,Xt,Jt,$t,Qt,en,tn,nn,rn,an,on,sn,un=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.islandLoader=t,this.worldGenerator=void 0,this.worldGenerator=t?new Ct(t):null}var t,n,r;return t=e,(n=[{key:"parse",value:function(e){for(var t=new Map;!e.eof();){var n=Ot.fromStream(e);if("INSELHAUS"!==n.type)t.has(n.type)||t.set(n.type,[]),t.get(n.type).push(n);else{var r=t.get("INSEL5")[t.get("INSEL5").length-1];void 0===r.inselHausBlocks&&(r.inselHausBlocks=[]),r.inselHausBlocks.push(n)}}return t}},{key:"getWorld",value:function(){var e=Ft(regeneratorRuntime.mark(function e(t){var n,r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.parse(t),e.next=3,this.doParse(n);case 3:return r=e.sent,i=r.world,a=r.worldGenerationSettings,e.next=8,this.worldGenerator.populateWorld(i,a);case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"doParse",value:function(){var e=Ft(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u,c,l,d,f,p,h,m,v,g,y,b;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(Nt(t.keys()).filter(function(e){return void 0!==t.get(e).find(function(e){return e.length>0})}).map(function(e){return[e,t.get(e)]})),n="",t.has("NAME")&&(r=t.get("NAME")[0],n=r.data.readString(r.length)),i=t.get("PLAYER4")[0],a=this.parsePlayers(i),o=t.has("INSEL5")?t.get("INSEL5"):[],e.next=8,this.parseIslands(o);case 8:return s=e.sent,u=this.handleBlock(t,"AUFTRAG4",St),c=this.handleBlock(t,"SHIP4",wt),l=this.handleBlock(t,"SOLDAT3",kt),d=this.handleBlock(t,"KONTOR2",st),f=this.handleBlock(t,"MILITAR",qe),p=this.handleBlock(t,"STADT4",Ye),h=this.handleBlock(t,"PRODLIST2",vt),m=null,t.has("HANDLER")&&t.get("HANDLER")[0].length>0&&(w=t.get("HANDLER")[0].data,x=void 0,k=void 0,S=void 0,E=void 0,x=w.read32(),k=w.read(20),S=function(e){for(var t=[],n=0;n<24;n++)t.push({goodId:e.read32(),_1:e.read32(),_2:e.read32()});return t}(w),E=w.read(292),console.log("trader",x,k,S,E),m={goods:S}),R(t.has("TIMERS")),R(1===t.get("TIMERS").length),v=Et(t.get("TIMERS")[0].data),g=At.empty(),t.has("SZENE")&&(y=t.get("SZENE")[0].data,g=At.fromSaveGame(y)),b=new H(s,a,u,n,l,c,d,f,p,m,v,h),e.abrupt("return",{world:b,worldGenerationSettings:g});case 25:case"end":return e.stop()}var w,x,k,S,E},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"handleBlock",value:function(e,t,n){if(!e.has(t))return[];var r=[],i=!0,a=!1,o=void 0;try{for(var s,u=e.get(t)[Symbol.iterator]();!(i=(s=u.next()).done);i=!0)for(var c=s.value;!c.data.eof();)r.push(n(c.data))}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}return r}},{key:"parseIslands",value:function(){var e=Ft(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u,c,l,d,f,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],this.islandLoader){e.next=3;break}return e.abrupt("return",n);case 3:r=!0,i=!1,a=void 0,e.prev=6,o=t[Symbol.iterator]();case 8:if(r=(s=o.next()).done){e.next=33;break}if(u=s.value,c=rt(u.data),l=void 0!==u.inselHausBlocks?u.inselHausBlocks:[],d=Ot.empty("INSELHAUS"),f=void 0,c.differsFromBaseIsland||!(l.length<=1)){e.next=25;break}return 1===l.length&&(d=l[0]),e.next=18,this.islandLoader.loadIslandFile(c);case 18:p=e.sent,R("INSEL5"===Ot.fromStream(p).type),R("INSELHAUS"===(f=Ot.fromStream(p)).type),e.next=28;break;case 25:R(l.length>=1&&l.length<=2),f=l[0],2===l.length&&(d=l[1]);case 28:this.islandLoader.setIslandFields(c,[f,d]),n.push(c);case 30:r=!0,e.next=8;break;case 33:e.next=39;break;case 35:e.prev=35,e.t0=e.catch(6),i=!0,a=e.t0;case 39:e.prev=39,e.prev=40,r||null==o.return||o.return();case 42:if(e.prev=42,!i){e.next=45;break}throw a;case 45:return e.finish(42);case 46:return e.finish(39);case 47:return e.abrupt("return",n);case 48:case"end":return e.stop()}},e,this,[[6,35,39,47],[40,,42,46]])}));return function(t){return e.apply(this,arguments)}}()},{key:"parsePlayers",value:function(e){for(var t=[];!e.data.eof();)t.push(mt(e.data));return t}}])&&Mt(t.prototype,n),r&&Mt(t,r),e}();!function(e){e[e["menu.divider.orginal_missions"]=85]="menu.divider.orginal_missions",e[e["menu.divider.missions"]=86]="menu.divider.missions",e[e["menu.divider.new_missions"]=87]="menu.divider.new_missions",e[e["menu.divider.custom_missions"]=88]="menu.divider.custom_missions",e[e.exit_game=89]="exit_game",e[e.exit_game_question=90]="exit_game_question"}(Lt||(Lt={})),Dt||(Dt={}),function(e){e[e["player.color.red"]=0]="player.color.red",e[e["player.color.blue"]=1]="player.color.blue",e[e["player.color.yellow"]=2]="player.color.yellow",e[e["player.color.white"]=3]="player.color.white"}(Bt||(Bt={})),function(e){e[e["videos.event"]=0]="videos.event",e[e["videos.battle"]=1]="videos.battle",e[e["videos.diplomacy"]=2]="videos.diplomacy"}(Ut||(Ut={})),function(e){e[e["speech.event"]=0]="speech.event",e[e["speech.island_status"]=1]="speech.island_status",e[e["speech.player"]=2]="speech.player",e[e["speech.trade"]=3]="speech.trade",e[e["speech.battle"]=4]="speech.battle",e[e["speech.order"]=5]="speech.order",e[e["speech.diplomacy"]=6]="speech.diplomacy"}(zt||(zt={})),function(e){e[e["path.custom_missions"]=0]="path.custom_missions"}(Ht||(Ht={})),function(e){e[e["endless.difficulty.easy"]=0]="endless.difficulty.easy",e[e["endless.difficulty.medium"]=1]="endless.difficulty.medium",e[e["endless.difficulty.difficult"]=2]="endless.difficulty.difficult",e[e["endless.difficulty.hard"]=3]="endless.difficulty.hard"}(Wt||(Wt={})),function(e){e[e["tutorial.mission_0"]=0]="tutorial.mission_0",e[e["tutorial.mission_1"]=1]="tutorial.mission_1",e[e["tutorial.mission_2"]=2]="tutorial.mission_2",e[e["tutorial.mission_3"]=3]="tutorial.mission_3",e[e["tutorial.mission_4"]=4]="tutorial.mission_4"}(Zt||(Zt={})),function(e){e[e["campaign.0.mission_0"]=0]="campaign.0.mission_0",e[e["campaign.0.mission_1"]=1]="campaign.0.mission_1",e[e["campaign.0.mission_2"]=2]="campaign.0.mission_2",e[e["campaign.0.mission_3"]=3]="campaign.0.mission_3",e[e["campaign.0.mission_4"]=4]="campaign.0.mission_4",e[e["campaign.1.mission_0"]=5]="campaign.1.mission_0",e[e["campaign.1.mission_1"]=6]="campaign.1.mission_1",e[e["campaign.1.mission_2"]=7]="campaign.1.mission_2",e[e["campaign.1.mission_3"]=8]="campaign.1.mission_3",e[e["campaign.1.mission_4"]=9]="campaign.1.mission_4",e[e["campaign.2.mission_0"]=10]="campaign.2.mission_0",e[e["campaign.2.mission_1"]=11]="campaign.2.mission_1",e[e["campaign.2.mission_2"]=12]="campaign.2.mission_2",e[e["campaign.2.mission_3"]=13]="campaign.2.mission_3",e[e["campaign.2.mission_4"]=14]="campaign.2.mission_4",e[e["campaign.3.mission_0"]=15]="campaign.3.mission_0",e[e["campaign.3.mission_1"]=16]="campaign.3.mission_1",e[e["campaign.3.mission_2"]=17]="campaign.3.mission_2",e[e["campaign.3.mission_3"]=18]="campaign.3.mission_3",e[e["campaign.3.mission_4"]=19]="campaign.3.mission_4",e[e["campaign.4.mission_0"]=20]="campaign.4.mission_0",e[e["campaign.4.mission_1"]=21]="campaign.4.mission_1",e[e["campaign.4.mission_2"]=22]="campaign.4.mission_2",e[e["campaign.4.mission_3"]=23]="campaign.4.mission_3",e[e["campaign.4.mission_4"]=24]="campaign.4.mission_4",e[e["campaign.5.mission_0"]=25]="campaign.5.mission_0",e[e["campaign.5.mission_1"]=26]="campaign.5.mission_1",e[e["campaign.5.mission_2"]=27]="campaign.5.mission_2",e[e["campaign.5.mission_3"]=28]="campaign.5.mission_3",e[e["campaign.5.mission_4"]=29]="campaign.5.mission_4"}(Kt||(Kt={})),function(e){e[e["figure.unused"]=0]="figure.unused",e[e["figure.infantry"]=1]="figure.infantry",e[e["figure.cavalry"]=2]="figure.cavalry",e[e["figure.musketeer"]=3]="figure.musketeer",e[e["figure.artiellery"]=4]="figure.artiellery"}(Vt||(Vt={})),function(e){e[e["good.empty"]=0]="good.empty",e[e["good.each"]=1]="good.each",e[e["good.iron_ore"]=2]="good.iron_ore",e[e["good.gold_ore"]=3]="good.gold_ore",e[e["good.wool"]=4]="good.wool",e[e["good.sugarcane"]=5]="good.sugarcane",e[e["good.tobacco"]=6]="good.tobacco",e[e["good.cattle"]=7]="good.cattle",e[e["good.grain"]=8]="good.grain",e[e["good.flour"]=9]="good.flour",e[e["good.iron"]=10]="good.iron",e[e["good.swords"]=11]="good.swords",e[e["good.muskets"]=12]="good.muskets",e[e["good.cannons"]=13]="good.cannons",e[e["good.food"]=14]="good.food",e[e["good.tobacco_products"]=15]="good.tobacco_products",e[e["good.spices"]=16]="good.spices",e[e["good.cocoa"]=17]="good.cocoa",e[e["good.liquor"]=18]="good.liquor",e[e["good.cloth"]=19]="good.cloth",e[e["good.clothes"]=20]="good.clothes",e[e["good.jewlry"]=21]="good.jewlry",e[e["good.tools"]=22]="good.tools",e[e["good.wood"]=23]="good.wood",e[e["good.bricks"]=24]="good.bricks"}(qt||(qt={})),function(e){e[e["rohst.grain"]=0]="rohst.grain",e[e["rohst.tobacco"]=1]="rohst.tobacco",e[e["rohst.spices"]=2]="rohst.spices",e[e["rohst.sugarcane"]=3]="rohst.sugarcane",e[e["rohst.cotton"]=4]="rohst.cotton",e[e["rohst.vines"]=5]="rohst.vines",e[e["rohst.cocoa"]=6]="rohst.cocoa",e[e["rohst.grazing_land"]=7]="rohst.grazing_land",e[e["rohst.tree"]=8]="rohst.tree",e[e["rohst.stones"]=9]="rohst.stones",e[e["rohst.ores"]=10]="rohst.ores",e[e["rohst.wild_game"]=11]="rohst.wild_game",e[e["rohst.fish"]=12]="rohst.fish"}(Yt||(Yt={})),function(e){e[e["rohst_field.grain"]=0]="rohst_field.grain",e[e["rohst_field.tobacco"]=1]="rohst_field.tobacco",e[e["rohst_field.spices"]=2]="rohst_field.spices",e[e["rohst_field.sugarcane"]=3]="rohst_field.sugarcane",e[e["rohst_field.cotton"]=4]="rohst_field.cotton",e[e["rohst_field.vines"]=5]="rohst_field.vines",e[e["rohst_field.cocoa"]=6]="rohst_field.cocoa",e[e["rohst_field.grazing_land"]=7]="rohst_field.grazing_land",e[e["rohst_field.tree"]=8]="rohst_field.tree",e[e["rohst_field.stones"]=9]="rohst_field.stones",e[e["rohst_field.ores"]=10]="rohst_field.ores",e[e["rohst_field.wild_game"]=11]="rohst_field.wild_game",e[e["rohst_field.fish"]=12]="rohst_field.fish"}(Xt||(Xt={})),function(e){e[e["buildings.military.wooden.wall"]=0]="buildings.military.wooden.wall",e[e["buildings.military.wooden.gate"]=1]="buildings.military.wooden.gate",e[e["buildings.military.wooden.watchtower"]=2]="buildings.military.wooden.watchtower",e[e["buildings.military.stone.wall"]=3]="buildings.military.stone.wall",e[e["buildings.military.stone.gate"]=4]="buildings.military.stone.gate",e[e["buildings.military.stone.watchtower"]=5]="buildings.military.stone.watchtower",e[e["buildings.military.stone.gate_big"]=6]="buildings.military.stone.gate_big",e[e["buildings.military.castle.small"]=7]="buildings.military.castle.small",e[e["buildings.military.castle.medium"]=8]="buildings.military.castle.medium",e[e["buildings.military.castle.large"]=9]="buildings.military.castle.large"}(Jt||(Jt={})),function(e){e[e["buildings.house.house"]=0]="buildings.house.house"}($t||($t={})),function(e){e[e["buildings.street.dirt.street"]=0]="buildings.street.dirt.street",e[e["buildings.street.stone.street"]=1]="buildings.street.stone.street",e[e["buildings.street.dirt.bridge"]=2]="buildings.street.dirt.bridge",e[e["buildings.street.stone.bridge"]=3]="buildings.street.stone.bridge",e[e["buildings.street.square.0"]=4]="buildings.street.square.0",e[e["buildings.street.square.1"]=5]="buildings.street.square.1",e[e["buildings.street.square.2"]=6]="buildings.street.square.2",e[e["buildings.street.square.3"]=7]="buildings.street.square.3"}(Qt||(Qt={})),function(e){e[e["buildings.mine.quarry"]=0]="buildings.mine.quarry",e[e["buildings.mine.iron"]=1]="buildings.mine.iron",e[e["buildings.mine.iron_deep"]=2]="buildings.mine.iron_deep",e[e["buildings.mine.gold"]=3]="buildings.mine.gold"}(en||(en={})),function(e){e[e["buildings.production.weaver"]=0]="buildings.production.weaver",e[e["buildings.production.butcher"]=1]="buildings.production.butcher",e[e["buildings.production.flour_mill"]=2]="buildings.production.flour_mill",e[e["buildings.production.bakery"]=3]="buildings.production.bakery",e[e["buildings.production.tobacco"]=4]="buildings.production.tobacco",e[e["buildings.production.distillery"]=5]="buildings.production.distillery",e[e["buildings.production.tailor"]=6]="buildings.production.tailor",e[e["buildings.production.weaving_mill"]=7]="buildings.production.weaving_mill",e[e["buildings.production.stonemason"]=8]="buildings.production.stonemason",e[e["buildings.production.water_mill"]=9]="buildings.production.water_mill",e[e["buildings.production.ore_smelter"]=10]="buildings.production.ore_smelter",e[e["buildings.production.tool_maker"]=11]="buildings.production.tool_maker",e[e["buildings.production.gold_smith"]=12]="buildings.production.gold_smith",e[e["buildings.production.armourer"]=13]="buildings.production.armourer",e[e["buildings.production.musket_maker"]=14]="buildings.production.musket_maker",e[e["buildings.production.canon_foundry"]=15]="buildings.production.canon_foundry"}(tn||(tn={})),function(e){e[e["buildings.farm.hunter"]=0]="buildings.farm.hunter",e[e["buildings.farm.forester"]=1]="buildings.farm.forester",e[e["buildings.field.forest"]=2]="buildings.field.forest",e[e["buildings.farm.grain"]=3]="buildings.farm.grain",e[e["buildings.field.grain"]=4]="buildings.field.grain",e[e["buildings.farm.sheep"]=5]="buildings.farm.sheep",e[e["buildings.farm.cattle"]=6]="buildings.farm.cattle",e[e["buildings.farm.tobacco"]=7]="buildings.farm.tobacco",e[e["buildings.field.tobacco"]=8]="buildings.field.tobacco",e[e["buildings.farm.spice"]=9]="buildings.farm.spice",e[e["buildings.field.spice"]=10]="buildings.field.spice",e[e["buildings.farm.wine"]=11]="buildings.farm.wine",e[e["buildings.field.wine"]=12]="buildings.field.wine",e[e["buildings.farm.sugarcane"]=13]="buildings.farm.sugarcane",e[e["buildings.field.sugarcane"]=14]="buildings.field.sugarcane",e[e["buildings.farm.cotton"]=15]="buildings.farm.cotton",e[e["buildings.field.cotton"]=16]="buildings.field.cotton",e[e["buildings.farm.cocoa"]=17]="buildings.farm.cocoa",e[e["buildings.field.cocoa"]=18]="buildings.field.cocoa"}(nn||(nn={})),function(e){e[e["buildings.docks.warehouse.0"]=0]="buildings.docks.warehouse.0",e[e["buildings.docks.warehouse.1"]=1]="buildings.docks.warehouse.1",e[e["buildings.docks.warehouse.2"]=2]="buildings.docks.warehouse.2",e[e["buildings.docks.warehouse.3"]=3]="buildings.docks.warehouse.3",e[e["buildings.docks.fisher"]=4]="buildings.docks.fisher",e[e["buildings.docks.dock"]=5]="buildings.docks.dock",e[e["buildings.docks.shipyard.small"]=6]="buildings.docks.shipyard.small",e[e["buildings.docks.shipyard.large"]=7]="buildings.docks.shipyard.large"}(rn||(rn={})),function(e){e[e["buildings.public.house"]=0]="buildings.public.house",e[e["buildings.public.marketplace"]=1]="buildings.public.marketplace",e[e["buildings.public.chapel"]=2]="buildings.public.chapel",e[e["buildings.public.church"]=3]="buildings.public.church",e[e["buildings.public.cathedral"]=4]="buildings.public.cathedral",e[e["buildings.public.tavern"]=5]="buildings.public.tavern",e[e["buildings.public.doctor"]=6]="buildings.public.doctor",e[e["buildings.public.school"]=7]="buildings.public.school",e[e["buildings.public.college"]=8]="buildings.public.college",e[e["buildings.public.bathhouse"]=9]="buildings.public.bathhouse",e[e["buildings.public.theater"]=10]="buildings.public.theater",e[e["buildings.public.firefighters"]=11]="buildings.public.firefighters",e[e["buildings.public.palace"]=12]="buildings.public.palace",e[e["buildings.public.gallows"]=13]="buildings.public.gallows",e[e["buildings.public.monument"]=14]="buildings.public.monument",e[e["buildings.public.triumphal_arch"]=15]="buildings.public.triumphal_arch"}(an||(an={})),function(e){e[e.demolish=0]="demolish"}(on||(on={})),function(e){e[e["natives.0.head_lodge"]=0]="natives.0.head_lodge",e[e["natives.0.hut.0"]=1]="natives.0.hut.0",e[e["natives.0.hut.1"]=2]="natives.0.hut.1",e[e["natives.0.hut.2"]=3]="natives.0.hut.2",e[e["natives.0.hut.3"]=4]="natives.0.hut.3",e[e["natives.1.head_lodge"]=5]="natives.1.head_lodge",e[e["natives.1.hut.0"]=6]="natives.1.hut.0",e[e["natives.1.hut.1"]=7]="natives.1.hut.1",e[e["natives.1.hut.2"]=8]="natives.1.hut.2",e[e["natives.1.hut.3"]=9]="natives.1.hut.3",e[e["natives.pyramid"]=10]="natives.pyramid",e[e["pirates.warehouse"]=11]="pirates.warehouse",e[e["pirates.1"]=12]="pirates.1",e[e["pirates.2"]=13]="pirates.2",e[e["pirates.tower"]=14]="pirates.tower",e[e["forest.mixed"]=15]="forest.mixed",e[e["forest.palm"]=16]="forest.palm"}(sn||(sn={}));var cn={GAME:Lt,LEISTE:Dt,PATH:Ht,ENDLESSKIND:Wt,PLAYCOL:Bt,VIDEOKIND:Ut,SPEECHKIND:zt,TUTORKIND:Zt,KAMPAGNE:Kt,FIGKIND:Vt,WARE:qt,ROHST:Yt,ROHSTFELD:Xt,MILITAR:Jt,WOHNHAUS:$t,STRASSE:Qt,BERGWERK:en,HANDWERK:tn,FARM:nn,HAFEN:rn,DIVERS:an,ABRISS:on,LANDSCHAFT:sn};function ln(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}var dn=new Map;function fn(e){return dn.get(e)||"?"}function pn(e){return hn.apply(this,arguments)}function hn(){var e;return e=regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,t.openAndGetContentAsText("/translations.json");case 3:for(e.t1=e.sent,n=e.t0.parse.call(e.t0,e.t1),r=0,i=Object.keys(n);r<i.length;r++)for(s in a=i[r],o=cn[a])parseInt(s,10)>=0&&(u=o[s],dn.set(u,n[a][s]));case 6:case"end":return e.stop()}},e)}),(hn=function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){ln(a,r,i,o,s,"next",e)}function s(e){ln(a,r,i,o,s,"throw",e)}o(void 0)})}).apply(this,arguments)}function mn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function vn(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){mn(a,r,i,o,s,"next",e)}function s(e){mn(a,r,i,o,s,"throw",e)}o(void 0)})}}function gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var yn=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.menuStructure=n,this.buttons=[this.renderNewGame.bind(this),this.renderLoadGame.bind(this),vn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.menuStructure.renderScreen("menu_loading");case 2:r.menuStructure.emit("load-game","/saves/lastgame.gam");case 3:case"end":return e.stop()}},e)})),vn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.menuStructure.renderScreen("menu_main"));case 1:case"end":return e.stop()}},e)})),function(){var e=vn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.currentPage=Math.max(0,r.currentPage-1),e.next=3,r.renderNewGame(t);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),function(){var e=vn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.currentPage=Math.min(Math.ceil(r.newGameLines.length/r.ROWS)-1,r.currentPage+1),e.next=3,r.renderNewGame(t);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()],this.ROWS=14,this.SCROLL_UP="menu-31011",this.SCROLL_DOWN="menu-31012",this.newGameLines=[],this.currentPage=0,this.gamParser=void 0,this.gamParser=new un(null)}var t,n,r;return t=e,(n=[{key:"onLoad",value:function(){var e=vn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getNewGameLines();case 2:return e.next=4,this.renderNewGame(t);case 4:return e.next=6,this.menuStructure._playMainMenuMusic();case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"renderNewGame",value:function(){var e=vn(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this.currentPage*this.ROWS,r=0;r<this.ROWS;r++)(i=t.getChildByName("menu-".concat(31021+r))).off("click"),i.visible=!1,i.interactive=!1,i.buttonMode=!1,r+n<this.newGameLines.length&&function(){var e=s.newGameLines[r+n];i.text=e.name,i.visible=!0,e.file&&(i.interactive=!0,i.buttonMode=!0,i.once("click",vn(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.menuStructure.renderScreen("menu_loading");case 2:s.menuStructure.emit("load-game",e.file.fullPath);case 3:case"end":return t.stop()}},t)}))))}();for(a=0;a<this.ROWS;a++)t.getChildByName("menu-".concat(31041+a)).visible=a+n<this.newGameLines.length&&!!this.newGameLines[a+n].file;for(o=0;o<this.ROWS;o++)t.getChildByName("menu-".concat(31061+o)).visible=!1;t.getChildByName(this.SCROLL_UP).visible=!0,t.getChildByName(this.SCROLL_DOWN).visible=!0;case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"renderLoadGame",value:function(){var e=vn(regeneratorRuntime.mark(function e(t){var n,r,i,a,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.ls("/saves",".gam");case 2:for(e.t0=function(e){return"lastgame.gam"!==e.name},n=e.sent.filter(e.t0),12,r=function(e){var r=t.getChildByName("menu-".concat(31021+e));r.visible=e<12,e<n.length?(r.text="Game".concat(e.toString().padStart(2,"0")),r.interactive=!0,r.buttonMode=!0,r.once("click",vn(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.menuStructure.renderScreen("menu_loading");case 2:o.menuStructure.emit("load-game",n[e].fullPath);case 3:case"end":return t.stop()}},t)})))):r.text="Empty".concat(e.toString().padStart(2,"0"))},i=0;i<this.ROWS;i++)r(i);for(i=0;i<this.ROWS;i++)t.getChildByName("menu-".concat(31041+i)).visible=!1;for(a=0;a<this.ROWS;a++)t.getChildByName("menu-".concat(31061+a)).visible=a<12;t.getChildByName(this.SCROLL_UP).visible=!1,t.getChildByName(this.SCROLL_DOWN).visible=!1;case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getNewGameLines",value:function(){var e=vn(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadMissions();case 2:return t=e.sent,this.newGameLines.push({name:fn("menu.divider.orginal_missions")}),t.filter(function(e){return-1!==e.missionNum}).forEach(function(e){n.newGameLines.push({name:e.name,file:e.file})}),this.newGameLines.push({name:fn("menu.divider.missions")}),this.newGameLines.push({name:fn("menu.divider.new_missions")}),t.filter(function(e){return-1===e.missionNum}).forEach(function(e){n.newGameLines.push({name:e.name,file:e.file})}),this.newGameLines.push({name:fn("menu.divider.custom_missions")}),e.next=11,this.fs.ls("/missions-custom",".szs");case 11:e.sent.forEach(function(e){n.newGameLines.push({name:e.name.replace(".szs",""),file:e})});case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadMissions",value:function(){var e=vn(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Promise,e.next=3,this.fs.ls("/missions-original",".szs");case 3:return e.t1=function(){var e=vn(regeneratorRuntime.mark(function e(t){var r,i,a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.fs.openAndGetContentAsStream(t);case 2:return r=e.sent,i=n.gamParser.parse(r),a=-1,i.has("SZENE_RANKING")&&(R(1===i.get("SZENE_RANKING").length),a=i.get("SZENE_RANKING")[0].data.read32()),o=-1,i.has("SZENE_KAMPAGNE")&&(R(1===i.get("SZENE_KAMPAGNE").length),o=i.get("SZENE_KAMPAGNE")[0].data.read32()),s=-1,i.has("SZENE_MISSNR")&&(R(1===i.get("SZENE_MISSNR").length),s=i.get("SZENE_MISSNR")[0].data.read32()),e.abrupt("return",{blocks:i,ranking:a,campaignNum:o,missionNum:s,name:t.name,file:t});case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),e.t2=e.sent.map(e.t1),e.next=7,e.t0.all.call(e.t0,e.t2);case 7:return(t=e.sent).sort(function(e,t){return-1!==e.missionNum&&-1===t.missionNum?-1:-1===e.missionNum&&-1!==t.missionNum?1:-1!==e.missionNum&&-1!==t.missionNum?e.missionNum<t.missionNum?-1:e.missionNum>t.missionNum?1:0:0}),console.table(t),e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}])&&gn(t.prototype,n),r&&gn(t,r),e}();function bn(e){return(bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function xn(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){wn(a,r,i,o,s,"next",e)}function s(e){wn(a,r,i,o,s,"throw",e)}o(void 0)})}}function kn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Sn(e){return(Sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function En(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rn(e,t){return(Rn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var An=function(e){function t(e,n,r){var i,a,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,o=Sn(t).call(this),(i=!o||"object"!==bn(o)&&"function"!=typeof o?En(a):o).fs=e,i.gadRenderer=n,i.musicPlayer=r,i.structure={menu_main:{onLoad:function(){return i._playMainMenuMusic()},buttons:[xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.renderScreen("menu_missions"));case 1:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Multiplayer"));case 1:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.musicPlayer.stop(),e.next=3,i.loadVideoSprite(10);case 3:(t=e.sent).width=439,t.height=353,t.position.set(507,366),i.gadRenderer.renderVideo(t,function(){return i._playMainMenuMusic});case 8:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.loadVideoSprite(58);case 2:t=e.sent,i.musicPlayer.stop(),i.gadRenderer.renderVideoFullscreen(t,function(){return i.renderScreen("menu_main")});case 5:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Exit"));case 1:case"end":return e.stop()}},e)}))]},menu_missions:new yn(i.fs,En(i)),menu_loading:{onLoad:function(){},buttons:[]},menu_mission_details:{onLoad:function(){},buttons:[xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Start Mission"));case 1:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.renderScreen("menu_missions"));case 1:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Highscores up"));case 1:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Highscores down"));case 1:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Sub-Mission 0"));case 1:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Sub-Mission 1"));case 1:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Sub-Mission 2"));case 1:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Sub-Mission 3"));case 1:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Sub-Mission 4"));case 1:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Mission Description up"));case 1:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Mission Description down"));case 1:case"end":return e.stop()}},e)})),xn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",console.log("Mission Description Slider"));case 1:case"end":return e.stop()}},e)}))]}},i}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rn(e,t)}(t,s["utils"].EventEmitter),n=t,(r=[{key:"renderScreen",value:function(){var e=xn(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.fs.openAndGetContentAsText("/screens/".concat(t,".json"));case 3:return e.t1=e.sent,n=e.t0.parse.call(e.t0,e.t1),console.log(n),r=this.structure[t]||{onLoad:function(){},buttons:[]},e.next=9,this.gadRenderer.render(n,r);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_playMainMenuMusic",value:function(){this.musicPlayer.play("1st Beginning",!0)}},{key:"loadVideoSprite",value:function(){var e=xn(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.openAndGetContentAsUint8Array("/videos/".concat(t,".mp4"));case 2:return n=e.sent,e.t0=s.Sprite,e.next=6,ze(n);case 6:return e.t1=e.sent,e.abrupt("return",e.t0.from.call(e.t0,e.t1));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}])&&kn(n.prototype,r),i&&kn(n,i),t}();function In(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function _n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var On=n("9/1U").a.Sound,Pn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.playing=!1,this.songs=[],this.currentSongIdx=void 0}var t,n,r;return t=e,(n=[{key:"load",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(){var t,n,r,i,a,o,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.ls("/music");case 2:t=e.sent,n=!0,r=!1,i=void 0,e.prev=6,a=t[Symbol.iterator]();case 8:if(n=(o=a.next()).done){e.next=25;break}return s=o.value,console.log("Loading music ".concat(s.name)),e.next=13,this.fs.openAndGetContentAsUint8Array(s);case 13:return u=e.sent.buffer,e.t0=this.songs,e.t1=s.name,e.next=18,this.loadSound(u);case 18:e.t2=e.sent,e.t3={name:e.t1,sound:e.t2},e.t0.push.call(e.t0,e.t3),console.log("Finished loading music ".concat(s.name));case 22:n=!0,e.next=8;break;case 25:e.next=31;break;case 27:e.prev=27,e.t4=e.catch(6),r=!0,i=e.t4;case 31:e.prev=31,e.prev=32,n||null==a.return||a.return();case 34:if(e.prev=34,!r){e.next=37;break}throw i;case 37:return e.finish(34);case 38:return e.finish(31);case 39:case"end":return e.stop()}},e,this,[[6,27,31,39],[32,,34,38]])}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){In(a,r,i,o,s,"next",e)}function s(e){In(a,r,i,o,s,"throw",e)}o(void 0)})});return function(){return t.apply(this,arguments)}}()},{key:"play",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.songs.find(function(t){return t.name===e+".wav"});void 0!==n?n.sound.isPlaying||n.sound.play({loop:t}):console.warn("Song ".concat(e," not found."))}},{key:"playAll",value:function(){0!==this.songs.length?this.playing?console.warn("Music is already playing!"):(this.stop(),this.playing=!0,this.currentSongIdx=-1,this.playNext()):console.warn("No music to play found :(")}},{key:"stop",value:function(){this.songs.forEach(function(e){return e.sound.stop()})}},{key:"playNext",value:function(){this.currentSongIdx++,this.currentSongIdx===this.songs.length&&(this.currentSongIdx=0),this.songs[this.currentSongIdx].sound.play(this.playNext.bind(this))}},{key:"loadSound",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(n,r){var i=On.from({source:e,preload:t,singleInstance:!0,loaded:function(e,i){t&&(e?r(e):n(i))}});t||n(i)})}}])&&_n(t.prototype,n),r&&_n(t,r),e}();function Tn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Gn=function(){var e,t,n;function r(e,t,n,i,a,o,s,u,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.fieldId=e,this.x=t,this.y=n,this.islandId=i,this.islandCityNum=a,this.rotation=o,this.ani=s,this.random=u,this.playerId=c}return e=r,n=[{key:"fromSaveGame",value:function(e){var t=e.read16()+2e4,n=e.read8(),i=e.read8(),a=e.read32(),o=a>>0&Math.pow(2,2)-1,s=a>>2&Math.pow(2,4)-1,u=a>>6&Math.pow(2,8)-1,c=a>>14&Math.pow(2,3)-1,l=a>>17&Math.pow(2,5)-1,d=a>>22&Math.pow(2,4)-1;Math.pow(2,6);return new r(t,n,i,u,c,o,s,l,d)}}],(t=null)&&Tn(e.prototype,t),n&&Tn(e,n),r}();function Cn(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Nn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function jn(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Nn(a,r,i,o,s,"next",e)}function s(e){Nn(a,r,i,o,s,"throw",e)}o(void 0)})}}function Fn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Gn.saveGameDataLength=8;var Mn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.fieldData=n,this.islandSizes=[{id:0,name:"lit",maxSize:35},{id:1,name:"mit",maxSize:45},{id:2,name:"med",maxSize:55},{id:3,name:"big",maxSize:85},{id:4,name:"lar",maxSize:100}]}var t,n,r;return t=e,(n=[{key:"loadIslandFile",value:function(){var e=jn(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.isSouth?"south":"north",r=t.numBaseIsland.toString().padStart(2,"0"),i=!0,a=!1,o=void 0,e.prev=5,s=this.islandSizes[Symbol.iterator]();case 7:if(i=(u=s.next()).done){e.next=14;break}if(c=u.value,!(t.size.x<=c.maxSize)){e.next=11;break}return e.abrupt("return",this.fs.openAndGetContentAsStream("/islands/".concat(n,"/").concat(c.name).concat(r,".scp")));case 11:i=!0,e.next=7;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(5),a=!0,o=e.t0;case 20:e.prev=20,e.prev=21,i||null==s.return||s.return();case 23:if(e.prev=23,!a){e.next=26;break}throw o;case 26:return e.finish(23);case 27:return e.finish(20);case 28:throw new Error("Could not load island");case 29:case"end":return e.stop()}},e,this,[[5,16,20,28],[21,,23,27]])}));return function(t){return e.apply(this,arguments)}}()},{key:"loadIslandFileByName",value:function(){var e=jn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fs.openAndGetContentAsStream("/islands/".concat(t,".scp")));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadRandomIslandFile",value:function(){var e=jn(regeneratorRuntime.mark(function e(t,n){var r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(r=this.islandSizes.find(function(e){return e.id===t}))){e.next=3;break}throw new Error("This should never happen.");case 3:if(i=[],!["ANY","NORTH"].includes(n)){e.next=13;break}return e.t0=i.push,e.t1=i,e.t2=Cn,e.next=10,this.loadIslandsWithSizeAndClimate(r.name,"north");case 10:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 13:if(!["ANY","SOUTH"].includes(n)){e.next=22;break}return e.t5=i.push,e.t6=i,e.t7=Cn,e.next=19,this.loadIslandsWithSizeAndClimate(r.name,"south");case 19:e.t8=e.sent,e.t9=(0,e.t7)(e.t8),e.t5.apply.call(e.t5,e.t6,e.t9);case 22:return a=i[Math.floor(Math.random()*i.length)],e.next=25,this.fs.openAndGetContentAsStream(a.file.fullPath);case 25:return e.t10=e.sent,e.t11="south"===a.climate,e.t12=a.id,e.abrupt("return",{data:e.t10,isSouth:e.t11,id:e.t12});case 29:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setIslandFields",value:function(e,t){e.fields=[];for(var n=0;n<e.size.x;n++)e.fields.push(new Array(e.size.y).fill(null));var r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)for(var u=o.value,c=this.parseIslandFields(e,u),l=0;l<e.size.x;l++)for(var d=0;d<e.size.y;d++){var f=c[l][d];null!==f&&(e.fields[l][d]=f)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},{key:"parseIslandFields",value:function(e,t){for(var n=t.data,r=t.length,i=[],a=0;a<e.size.x;a++)i.push(new Array(e.size.y).fill(null));for(var o=0;o<r/Gn.saveGameDataLength;o++){var s=Gn.fromSaveGame(n);R(s.x<e.size.x),R(s.y<e.size.y),i[s.x][s.y]=s}return i}},{key:"loadIslandsWithSizeAndClimate",value:function(){var e=jn(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.ls("/islands/".concat(n));case 2:return e.t0=function(e){return e.name.startsWith(t)},e.t1=function(e){return null!==e.name.match(/\d\d\.scp$/)},e.t2=function(e){return{file:e,climate:n,id:parseInt(e.name.substr(3,2),10)}},e.abrupt("return",e.sent.filter(e.t0).filter(e.t1).map(e.t2));case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}])&&Fn(t.prototype,n),r&&Fn(t,r),e}();function Ln(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Dn(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Ln(a,r,i,o,s,"next",e)}function s(e){Ln(a,r,i,o,s,"throw",e)}o(void 0)})}}var Bn=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.textures=new Map,this.getTextures=function(){var e=Dn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t="/gfx/".concat(t),n.textures.has(t)){e.next=4;break}return e.next=4,n.loadTextures(t);case 4:return e.abrupt("return",n.textures.get(t));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),this.loadTextures=function(){var e=Dn(regeneratorRuntime.mark(function e(t){var r,i,a,o,u,l,d,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,e.next=3,n.fs.ls(t);case 3:i=e.sent,a=!0,o=!1,u=void 0,e.prev=7,l=i[Symbol.iterator]();case 9:if(a=(d=l.next()).done){e.next=17;break}if(f=d.value,"png"!==f.name.substr(f.name.lastIndexOf(".")+1)){e.next=14;break}return e.delegateYield(regeneratorRuntime.mark(function e(){var t,i,a,o,u,l,d,p,h,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.fullPath.substring(0,f.fullPath.lastIndexOf("."))+".json",e.t0=JSON,e.next=4,n.fs.openAndGetContentAsText(t);case 4:return e.t1=e.sent,i=e.t0.parse.call(e.t0,e.t1),e.next=8,n.fs.openAndGetContentAsUint8Array(f);case 8:return a=e.sent,v=a,o=s.Texture.from("data:image/png;base64,".concat(Object(c.d)(v))),u=new s.Spritesheet(o.baseTexture,i),e.next=13,new Promise(function(e,t){u.parse(function(t,n){e(t)})});case 13:for(l=e.sent,d=0,p=Object.keys(l);d<p.length;d++)h=p[d],m=l[h],r.set(parseInt(h,10),m);case 15:case"end":return e.stop()}var v},e)})(),"t0",14);case 14:a=!0,e.next=9;break;case 17:e.next=23;break;case 19:e.prev=19,e.t1=e.catch(7),o=!0,u=e.t1;case 23:e.prev=23,e.prev=24,a||null==l.return||l.return();case 26:if(e.prev=26,!o){e.next=29;break}throw u;case 29:return e.finish(26);case 30:return e.finish(23);case 31:n.textures.set(t,r);case 32:case"end":return e.stop()}},e,null,[[7,19,23,31],[24,,26,30]])}));return function(t){return e.apply(this,arguments)}}()},Un=n("fDnD"),zn=n.n(Un),Hn=n("q1tI"),Wn=n("i8i4"),Zn=n("/ia5");function Kn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}for(var Vn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.root=void 0,this.root={x:0,y:0,w:t,h:n}}var t,n,r;return t=e,(n=[{key:"addBlock",value:function(e){var t=this.findNode(this.root,e.w,e.h);return!!t&&this.splitNode(t,e.w,e.h)}},{key:"findNode",value:function(e,t,n){return e.used?this.findNode(e.right,t,n)||this.findNode(e.down,t,n):t<=e.w&&n<=e.h?e:null}},{key:"splitNode",value:function(e,t,n){return e.used=!0,e.down={x:e.x,y:e.y+n,w:e.w,h:e.h-n},e.right={x:e.x+t,y:e.y,w:e.w-t,h:n},e}}])&&Kn(t.prototype,n),r&&Kn(t,r),e}(),qn=new Uint8Array([0,0,0,128,0,0,0,128,0,128,128,0,0,0,128,109,31,108,0,128,128,192,192,192,255,0,255,255,0,255,0,0,0,0,4,4,0,8,8,0,16,0,11,6,3,21,8,0,37,4,0,0,20,4,6,22,6,0,33,0,3,38,3,14,28,5,8,49,4,32,24,0,27,44,0,10,12,18,8,28,20,24,22,16,35,23,12,1,41,21,12,44,19,24,43,17,35,41,15,10,22,37,10,44,37,36,31,31,34,49,29,18,36,44,38,46,41,19,34,64,4,61,6,16,59,6,21,62,8,37,61,4,14,60,40,33,59,35,41,61,32,14,55,64,24,61,61,33,49,61,37,61,57,17,58,72,41,61,66,17,60,78,17,58,94,13,77,0,37,78,0,18,77,8,23,77,37,28,77,72,25,77,88,22,73,110,17,95,3,37,98,0,22,93,61,22,112,45,21,150,36,25,124,107,28,148,113,0,82,140,8,74,144,248,194,48,8,82,148,8,86,148,12,78,140,23,82,136,0,99,140,24,94,140,8,90,156,12,90,160,18,99,148,18,101,148,10,117,150,8,90,173,8,99,169,12,103,165,21,104,165,6,121,173,19,115,171,33,115,165,10,118,181,24,119,177,33,115,173,33,123,177,24,117,187,8,136,189,11,136,196,17,136,220,33,156,132,0,156,148,24,156,177,0,156,214,12,148,206,196,120,94,11,173,216,8,148,231,8,148,239,12,160,230,28,152,226,21,178,225,16,177,239,24,189,231,33,189,222,0,148,247,80,150,226,0,156,255,224,138,108,242,153,122,233,113,2,255,125,2,8,165,247,251,216,52,244,175,45,16,156,247,24,148,239,20,152,251,255,252,157,33,165,247,54,17,4,74,17,4,53,45,12,70,44,11,60,74,11,41,99,0,59,90,19,45,103,0,46,112,0,45,99,8,44,106,17,55,109,2,55,106,17,66,106,3,68,108,16,59,47,38,62,68,41,59,61,64,61,74,63,60,97,45,65,91,68,63,77,75,60,99,75,49,76,90,63,75,85,46,98,90,65,101,86,58,95,104,55,98,117,55,102,140,94,22,5,89,42,20,90,64,26,89,96,11,90,94,45,88,80,70,87,102,68,89,79,80,85,103,80,93,107,77,90,88,89,86,111,90,87,99,98,88,102,117,115,33,10,113,65,20,111,95,17,111,82,57,108,111,65,111,107,90,107,104,107,143,29,4,137,86,13,140,88,31,137,99,64,172,39,5,166,93,37,197,49,8,205,84,30,41,126,2,49,123,0,53,127,0,66,123,0,52,123,11,54,123,20,54,122,73,49,132,4,66,132,0,49,132,20,64,132,22,53,140,0,53,134,55,49,141,50,49,167,29,83,130,9,91,126,62,87,121,107,108,123,103,82,171,6,85,145,47,89,182,41,119,126,60,119,119,105,116,180,48,170,128,42,145,125,103,133,187,58,202,172,52,43,133,116,83,127,115,127,124,115,125,142,115,74,126,126,73,128,164,118,132,123,118,135,143,43,160,124,95,156,132,45,181,136,63,193,138,92,169,189,63,222,167,86,237,200,144,137,123,141,153,133,152,149,127,175,154,124,152,165,140,152,178,141,169,176,140,204,194,133,154,176,173,185,182,160,179,200,167,172,209,207,221,218,181,225,239,226,254,250,230,0,148,255,160,160,164,128,128,128,255,0,0,0,255,0,255,255,0,0,0,255,255,0,255,0,255,255,255,255,255]),Yn=qn,Xn={},Jn=0;Jn<qn.length/3;Jn++){Xn[((qn[3*Jn+0]<<24)+(qn[3*Jn+1]<<16)+(qn[3*Jn+2]<<8)+255).toString()]=Jn}var $n=Xn;function Qn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var er=n("V4eY"),tr=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=void 0,this.height=void 0,this.pixels=void 0,this.width=t,this.height=n,this.pixels=r}var t,n,r;return t=e,(n=[{key:"toPNG",value:function(){return er.encode([this.pixels.buffer],this.width,this.height)}}])&&Qn(t.prototype,n),r&&Qn(t,r),e}();function nr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function rr(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){nr(a,r,i,o,s,"next",e)}function s(e){nr(a,r,i,o,s,"throw",e)}o(void 0)})}}function ir(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ar=n("V4eY"),or=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.SPRITESHEET_SIZE=2048,this.HEADER_SIZE=20,this.log=void 0,this.log=i.getLogger("bsh-parser")}var t,n,r;return t=e,(n=[{key:"decodeBSH",value:function(){var e=rr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.decode(t,"BSH"));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"decodeZEI",value:function(){var e=rr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.decode(t,"ZEI"));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createSpriteSheets",value:function(e){for(var t=[],n=new Vn(this.SPRITESHEET_SIZE,this.SPRITESHEET_SIZE),r=new Uint8Array(this.SPRITESHEET_SIZE*this.SPRITESHEET_SIZE*4),i={meta:{},frames:{}},a=0;a<e.length;a++){var o=e[a],s=n.addBlock({w:o.width,h:o.height});if(!1===s&&(t.push({png:ar.encode([r.buffer],this.SPRITESHEET_SIZE,this.SPRITESHEET_SIZE),config:i}),n=new Vn(this.SPRITESHEET_SIZE,this.SPRITESHEET_SIZE),r=new Uint8Array(this.SPRITESHEET_SIZE*this.SPRITESHEET_SIZE*4),i={meta:{},frames:{}},s=n.addBlock({w:o.width,h:o.height})),!s)throw new Error("Could not add image to empty spritesheet!");for(var u=s.x,c=s.y,l=0,d=0;d<o.height;d++)for(var f=0;f<o.width;f++){var p=4*(u+f+this.SPRITESHEET_SIZE*d+this.SPRITESHEET_SIZE*c);r[p+0]=o.pixels[4*l+0],r[p+1]=o.pixels[4*l+1],r[p+2]=o.pixels[4*l+2],r[p+3]=o.pixels[4*l+3],l++}i.frames[a.toString(10)]={frame:{x:u,y:c,w:o.width,h:o.height},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:o.width,h:o.height},sourceSize:{w:o.width,h:o.height}}}return t.push({png:ar.encode([r.buffer],this.SPRITESHEET_SIZE,this.SPRITESHEET_SIZE),config:i}),t}},{key:"saveSpriteSheets",value:function(){var e=rr(regeneratorRuntime.mark(function e(t,n,r){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.mkdir(r);case 2:i=0;case 3:if(!(i<n.length)){e.next=9;break}return e.next=6,this.saveSpriteSheet(t,n[i],i,r);case 6:i++,e.next=3;break;case 9:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"encodeBSH",value:function(e){var t=this,n=new Zn.SmartBuffer;return n.writeString("BSH".padEnd(16,"\0"),"ascii"),n.writeUInt32LE(42),e.forEach(function(){return n.writeUInt32LE(42)}),e.forEach(function(e,r){var i=t.encodeImage(e).toBuffer();n.writeUInt32LE(n.writeOffset-t.HEADER_SIZE,20+4*r),n.writeBuffer(i)}),n.writeUInt32LE(n.length-this.HEADER_SIZE,16),n.toBuffer()}},{key:"decode",value:function(){var e=rr(regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(R(t.readString(16)===n),r=t.read32(),R(this.HEADER_SIZE+r===t.length),(i=[]).push(t.read32()),a=i[0]/4,o=1;o<a;o++)i.push(t.read32());for(s=[],u=0;u<a;u++)t.seek(i[u]+this.HEADER_SIZE),null!==(c=this.decodeImage(t))&&s.push(c);return e.abrupt("return",s);case 11:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"decodeImage",value:function(e){var t=e.read32(),n=e.read32();e.read32(),e.read32();R(t>0),R(n>0);for(var r=new Uint8Array(t*n*4),i=0,a=0;;){var o=e.read8();if(255===o)break;if(254===o)a=++i*t*4;else{a+=4*o;for(var s=e.read8(),u=0;u<s;u++){var c=3*e.read8();r[a++]=Yn[c],r[a++]=Yn[c+1],r[a++]=Yn[c+2],r[a++]=255}}}return new tr(t,n,r)}},{key:"encodeImage",value:function(e){var t=new Zn.SmartBuffer;t.writeUInt32LE(e.width).writeUInt32LE(e.height).writeUInt32LE(1).writeUInt32LE(42);for(var n=0,r=0;r<e.height;r++){for(var i=0,a=[],o="empty",s=0;s<e.width;s++){var u=(e.pixels[4*(r*e.width+s)+0]<<24)+(e.pixels[4*(r*e.width+s)+1]<<16)+(e.pixels[4*(r*e.width+s)+2]<<8)+(e.pixels[4*(r*e.width+s)+3]<<0);if(0===u){if("empty"===o)i++;else if("colored"===o){for(;n>0;)t.writeUInt8(254),n--;for(;i>253;)t.writeUInt8(253),t.writeUInt8(0),i-=253;t.writeUInt8(i);for(var c=0;c<a.length;c+=255){var l=a.slice(c,c+255);c>0&&t.writeUInt8(0),t.writeUInt8(l.length),l.forEach(function(e){var n=$n[e];t.writeUInt8(n)})}i=1,a=[]}o="empty"}else o="colored",a.push(u)}if("colored"===o){for(;n>0;)t.writeUInt8(254),n--;for(;i>253;)t.writeUInt8(253),t.writeUInt8(0),i-=253;t.writeUInt8(i);for(var d=0;d<a.length;d+=255){var f=a.slice(d,d+255);d>0&&t.writeUInt8(0),t.writeUInt8(f.length),f.forEach(function(e){t.writeUInt8($n[e.toString()])})}}n++}t.writeUInt8(255);for(var p=(4-t.length%4)%4,h=0;h<p;h++)t.writeUInt8(0);return t.writeUInt32LE(t.length,12),t}},{key:"saveSpriteSheet",value:function(){var e=rr(regeneratorRuntime.mark(function e(t,n,r,i){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.write("".concat(i,"/sprite-sheet-").concat(r,".png"),n.png);case 2:return e.next=4,t.write("".concat(i,"/sprite-sheet-").concat(r,".json"),JSON.stringify(n.config));case 4:case"end":return e.stop()}},e)}));return function(t,n,r,i){return e.apply(this,arguments)}}()}])&&ir(t.prototype,n),r&&ir(t,r),e}(),sr=n("daKf");function ur(e){return(ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var dr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.log=void 0,this.variables=void 0,this.objects=void 0,this.template=void 0,this.gfxMap=void 0,this.lastGfxName=void 0,this.currentObject=void 0,this.currentNestedObject=void 0,this.currentItem=void 0,this.currentNestedItem=void 0,this.log=i.getLogger("dat-parser")}var t,n,r;return t=e,(n=[{key:"parse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;this.variables=t,this.objects={},this.template=null,this.gfxMap=new Map,this.lastGfxName=null,this.currentObject=null,this.currentNestedObject=null,this.currentItem=null,this.currentNestedItem=0;var n=!0,r=!1,i=void 0;try{for(var a,o=e.split("\n")[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(0!==(s=s.split(";")[0].trim()).length&&!(s.startsWith("Nahrung:")||s.startsWith("Soldat:")||s.startsWith("Turm:")))if('Include: "TOOLS.INC"'!==s){var u=void 0;if(u=s.match(/^(@?)(\w+)\s*=\s*((?:\d+|\+|\w+)+)$/))this.handleConstantAssignment(u);else if(u=s.match(/^ObjFill:\s*([\w,]+)$/))this.handleObjFill(u);else if(u=s.match(/^Objekt:\s*(\w+)$/))this.handleNestedObjectBegin(u);else if("EndObj"!==s){if(!(u=s.match(/^(@?)(\w+):\s*(.*?)\s*$/)))throw new Error("Could not parse: "+s);this.handleProperty(u)}else this.handleNestedObjectEnd()}else R(t.size>0)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return{variables:this.mapToObject(this.variables),objects:this.objects,gfx_category_map:this.mapToObject(this.gfxMap)}}},{key:"handleObjFill",value:function(e){R(null!=this.currentObject),R(null!=this.currentItem);var t=e[1],n=this.objects[this.currentObject].items[this.currentItem];if(t.startsWith("0,MAX"))R(null===this.template),this.template=n;else{R(n.hasOwnProperty("nested_objects"));var r=this.getValue(null,t,!1),i=this.objects[this.currentObject].items[r];this.objects[this.currentObject].items[this.currentItem]=this.deepCopy(i),null!=this.lastGfxName&&(n.GfxCategory=this.lastGfxName)}}},{key:"handleConstantAssignment",value:function(e){var t=e[1].length>0,n=e[2],r=e[3];if(n.startsWith("GFX"))if("0"===r)this.gfxMap.set(n,n);else if(r.startsWith("GFX")){var i=r.split("+")[0];this.gfxMap.has(i)&&this.gfxMap.set(n,this.gfxMap.get(i))}this.variables.set(n,this.getValue(n,r,t))}},{key:"handleNestedObjectBegin",value:function(e){var t=e[1];if(null===this.currentObject)this.currentObject=t,this.objects[t]={items:{}};else{if(null!==this.currentNestedObject)throw new Error("It appears like there is more than one nesting level. This is not supported by this parser.");R(null!==this.currentItem),this.currentNestedObject=t,this.currentNestedItem=0;var n=this.objects[this.currentObject].items[this.currentItem];void 0!==n.nested_objects[this.currentNestedObject]&&void 0!==n.nested_objects[this.currentNestedObject][this.currentNestedItem]||(n.nested_objects[this.currentNestedObject]=cr({},this.currentNestedItem,{}))}}},{key:"handleNestedObjectEnd",value:function(){if(null!==this.currentNestedObject)this.currentNestedObject=null,this.currentNestedItem=null;else{if(null===this.currentObject)throw new Error("Received EndObj without current object!");this.currentObject=null,this.currentItem=null}}},{key:"handleProperty",value:function(e){var t=e[1].length>0,n=e[2],r=e[3],i=this.deepCopy(this.getValue(n,r,t));if(this.variables.set(n,i),"Nummer"!==n){var a=this.objects[this.currentObject].items[this.currentItem];if("Gfx"===n&&r.startsWith("GFX")&&(this.lastGfxName=r.split("+")[0]),null==this.currentNestedObject)a[n]=i,null!=this.lastGfxName&&(a.GfxCategory=this.lastGfxName,a.GfxCategoryMapped=this.gfxMap.get(this.lastGfxName));else{var o=a.nested_objects[this.currentNestedObject][this.currentNestedItem];Object.keys(o).includes(n)&&this.isObject(o[n])?o[n]=this.deepMerge(o[n],i):o[n]=i}}else if(null===this.currentNestedObject){if(this.currentItem=i,this.objects[this.currentObject].items[this.currentItem]={nested_objects:{}},null!==this.template){var s=this.deepCopy(this.template);this.objects[this.currentObject].items[this.currentItem]=this.deepMerge(s,this.objects[this.currentObject].items[this.currentItem])}}else this.currentNestedItem=i,this.objects[this.currentObject].items[this.currentItem].nested_objects[this.currentNestedObject][this.currentNestedItem]={}}},{key:"getValue",value:function(e,t,n){var r,i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;if(n&&(r=t.match(/^([+\-])(\d+)$/))){var o=this.variables.has(e)?this.deepCopy(this.variables.get(e)):null;if("RUINE_KONTOR_1"===o.toString()&&(o=424242),a>-1&&(o="Size"===e?o[0===a?"x":"y"]:o[a]),"+"===r[1])return o+parseInt(r[2],10);if("-"===r[1])return o-parseInt(r[2],10);throw new Error("This code should not be reached.")}if(t.match(/^[\-+]?\d+$/))return parseInt(t,10);if(t.match(/^[\-+]?\d+\.\d+$/))return parseFloat(t);if(r=t.match(/^([A-Za-z0-9_]+)(?:\[(\d+)])?$/)){var s=r[1],u=r[2],c=this.variables.has(s)?this.deepCopy(this.variables.get(s)):s;return void 0!==u?c[u]:c}if(-1!==t.indexOf(",")){var l=t.split(",").map(function(t,r){return i.getValue(e,t.trim(),n,r)});if("Size"===e)return{x:l[0],y:l[1]};if("Ware"===e){var d={};return d[l[0]]=l[1],d}return l}if(r=t.match(/^([A-z]+(?:\[\d+])?|\d+)([+\-])([A-z]+(?:\[\d+])?|\d+)$/)){var f=r[2],p=this.getValue(e,r[1],!1),h=this.getValue(e,r[3],!1);return"+"===f?p+h:p-h}throw new Error("This code should not be reached.")}},{key:"deepCopy",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"isObject",value:function(e){return e&&"object"===ur(e)&&!Array.isArray(e)}},{key:"deepMerge",value:function(e,t){var n=this,r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){cr(e,t,n[t])})}return e}({},e);return this.isObject(e)&&this.isObject(t)&&Object.keys(t).forEach(function(i){n.isObject(t[i])&&i in e?r[i]=n.deepMerge(e[i],t[i]):Object.assign(r,cr({},i,t[i]))}),r}},{key:"mapToObject",value:function(e){var t={};return e.forEach(function(e,n){return t[n]=e}),t}}])&&lr(t.prototype,n),r&&lr(t,r),e}(),fr=n("/dzE");function pr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function hr(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){pr(a,r,i,o,s,"next",e)}function s(e){pr(a,r,i,o,s,"throw",e)}o(void 0)})}}function mr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var vr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ffmpeg=void 0,this.memory=1e8}var t,n,r;return t=e,(n=[{key:"parse",value:function(){var e=hr(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(fr.a)();case 2:return this.ffmpeg=e.sent,n=[{data:t,name:"input.smk"}],e.prev=4,r=this.prepareArguments(!0),e.next=8,this.convert(r,n);case 8:return e.abrupt("return",e.sent);case 11:if(e.prev=11,e.t0=e.catch(4),"only-one-audio-stream"!==e.t0.message){e.next=26;break}return e.prev=14,i=this.prepareArguments(!1),e.next=18,this.convert(i,n);case 18:return e.abrupt("return",e.sent);case 21:throw e.prev=21,e.t1=e.catch(14),e.t1;case 24:e.next=27;break;case 26:throw e.t0;case 27:case"end":return e.stop()}},e,this,[[4,11],[14,21]])}));return function(t){return e.apply(this,arguments)}}()},{key:"prepareArguments",value:function(e){var t=["-i","input.smk"];return e&&t.push.apply(t,["-filter_complex","[0:a]amerge[c]","-map","[c]","-map","0:v:0"]),t.push.apply(t,["-ac","2","-c:v","libx264","-pix_fmt","yuv420p","-preset","ultrafast","-movflags","+faststart","output.mp4"]),t}},{key:"convert",value:function(){var e=hr(regeneratorRuntime.mark(function e(t,n){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Converting video with arguments ".concat(t.join(" "))),e.abrupt("return",new Promise(function(e,i){var a="",o=function(e){a+=e+"\n",console.log(e)};r.ffmpeg({arguments:t,files:n,print:o,printErr:o,stdin:function(){},TOTAL_MEMORY:r.memory,noExitRuntime:!1,returnCallback:function(t){a.includes("Cannot find a matching stream for unlabeled input pad 1")?i(new Error("only-one-audio-stream")):1!==t.length?i(new Error("unknown-error")):e(new Uint8Array(t[0].data))}})}));case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}])&&mr(t.prototype,n),r&&mr(t,r),e}(),gr=n("B16k");function yr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var br=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adpcmIndexTable=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],this.adpcmStepTable=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767]}var t,n,r;return t=e,(n=[{key:"decode",value:function(e){var t=new gr.a(e),n=t.fmt.bitsPerSample,r=t.fmt.sampleRate,i=t.fmt.numChannels;if(4!==n)throw new Error("Can only convert .wav files with 4 bits per sample.");if(2!==i)throw new Error("Can only convert .wav files with stereo sound.");for(var a={step_index:0,predictor:0},o={step_index:0,predictor:0},s=t.data.samples,u=new Int16Array(s.length),c=new Int16Array(s.length),l=0;l<s.length;l++)u[l]=this.decodeADPCM_IMA(a,s[l]>>>4),c[l]=this.decodeADPCM_IMA(o,15&s[l]);return{left:u,right:c,sampleRate:r}}},{key:"encode",value:function(e){for(var t=e.left.length,n=new Int16Array(2*t),r=0;r<t;r++)n[2*r+0]=e.left[r],n[2*r+1]=e.right[r];var i=new gr.a;return i.fromScratch(2,e.sampleRate,"16",n),i.toBuffer()}},{key:"av_clip",value:function(e,t,n){return Math.min(Math.max(t,e),n)}},{key:"av_clip_int16",value:function(e){return e+32768&-65536?e>>31^32767:e}},{key:"decodeADPCM_IMA",value:function(e,t){var n=this.adpcmStepTable[e.step_index],r=this.av_clip(e.step_index+this.adpcmIndexTable[t],0,88),i=8&t,a=(2*(7&t)+1)*n>>>3,o=e.predictor;return i?o-=a:o+=a,e.predictor=this.av_clip_int16(o),e.step_index=r,e.predictor}}])&&yr(t.prototype,n),r&&yr(t,r),e}();function wr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function xr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var kr=n("1Y70"),Sr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"createBitmapFont",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(t,n){var r,i,a,o,s,u,l,d,f,p,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],i=[],a=0;a<t.length;a++)for(o=t[a],r.push({page:[{_attr:{id:a,file:"data:image/png;base64,".concat(Object(c.d)(new Uint8Array(o.png)))}}]}),s=0,u=Object.keys(o.config.frames);s<u.length;s++)l=u[s],d=o.config.frames[l],f=parseInt(l,10)+32,i.push({char:[{_attr:{id:f,x:d.frame.x,y:d.frame.y,width:d.frame.w,height:d.frame.h,xoffset:0,yoffset:0,xadvance:d.frame.w,page:a,chnl:15,letter:String.fromCharCode(f)}}]});return p=t[0].config.frames[0].sourceSize.h,h={font:[{info:[{_attr:{face:n,size:p,padding:"0,0,0,0",spacing:"0,0",italic:"0",bold:"0",stretchH:"100",smooth:"1",aa:"1"}}]},{common:[{_attr:{pages:t.length,lineHeight:p,packed:0}}]},{pages:r},{chars:i}]},e.abrupt("return",kr(h,{indent:"  "}));case 6:case"end":return e.stop()}},e)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){wr(a,r,i,o,s,"next",e)}function s(e){wr(a,r,i,o,s,"throw",e)}o(void 0)})});return function(e,n){return t.apply(this,arguments)}}()}])&&xr(t.prototype,n),r&&xr(t,r),e}();function Er(e){var t={},n=null,r=!0,i=!1,a=void 0;try{for(var o,s=e.split("\r\n")[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;n?"[END]"===u?n=null:t[n].push(u):u.startsWith("[")&&(t[n=u.split(/[[\]]/)[1]]=[])}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return t}function Rr(e){return(Rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ar(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Ir(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Ar(a,r,i,o,s,"next",e)}function s(e){Ar(a,r,i,o,s,"throw",e)}o(void 0)})}}function _r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Or(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Tr(e){return(Tr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Cr(e,t){return(Cr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Nr=function(e){function t(e){var n,r,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,i=Tr(t).call(this,e),(n=!i||"object"!==Rr(i)&&"function"!=typeof i?Gr(r):i).info=function(e){n.log(e,"info")},n.warn=function(e){n.log(e,"warn")},n.error=function(e){n.log(e,"error")},n.log=function(e,t){n.setState(function(n){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Or(e,t,n[t])})}return e}({},n,{messages:[{msg:e,type:t}].concat(_r(n.messages.filter(function(e,t){return"info"!==e.type||t<50})))})})},n.zipUploaded=function(){var e=Ir(regeneratorRuntime.mark(function e(t){var r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(r=t.target.files)&&1===r.length){e.next=4;break}return alert("Please select the zipped Anno1602 folder to upload."),e.abrupt("return");case 4:if((i=r[0]).name.endsWith(".zip")){e.next=8;break}return alert("You need to upload a .zip file!"),e.abrupt("return");case 8:return n.setState({isUploading:!0}),e.next=11,n.props.onUploaded(i);case 11:a=e.sent,n.setState({isUploading:!1}),a?(n.info("Upload finished. Please reload the page."),alert("Upload finished. Please reload the page.")):(n.error("The upload failed."),alert("The upload failed."));case 14:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.resetFiles=Ir(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.onReset();case 2:alert("All files deleted. The page will now refresh."),window.location.reload(!0);case 4:case"end":return e.stop()}},e)})),n.state={isUploading:!1,messages:[]},n.props.setLogger(Gr(n)),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cr(e,t)}(t,Hn["Component"]),n=t,(r=[{key:"render",value:function(){return Hn.createElement("div",{style:{marginLeft:"1em",marginRight:"1em",fontFamily:"Arial",maxWidth:"800px",lineHeight:1.4}},Hn.createElement("h1",null,"Anno 2018"),Hn.createElement("p",null,"Welcome to Anno 2018, an effort to port twenty-year-old Anno 1602 to the browser. This is in early development, however, you can already load your savegames and start new games. Much of the actual simulation is still missing though. For copyright reasons, we can't include the original Anno 1602 files and graphics."," ",Hn.createElement("strong",null,"You need own your own copy of Anno 1602 for Anno 2018 work.")),Hn.createElement("p",null,"The following versions have been tested by us and confirmed to work:"),Hn.createElement("ul",null,Hn.createElement("li",null,'German "Anno 1602 Kngisedition"'),Hn.createElement("li",null,'English "Anno 1602 A.D." from GOG')),Hn.createElement("p",null,"Anno 2018 is tested in the latest versions of"," ",Hn.createElement("strong",null,"Chrome (preferred, faster) and Firefox")," only. Other browsers ",Hn.createElement("em",null,"might")," work, but aren't supported."),Hn.createElement("p",null,'To get started, follow these steps. You will need to "upload" your Anno files on this website. Don\'t worry though, the files'," ",Hn.createElement("em",null,"never")," leave your PC and are only uploaded into your browser. Once uploaded, the files remain in your browser and will be there when you re-open this website."),Hn.createElement("ol",null,Hn.createElement("li",null,"Find your Anno 1602 files and zip them. If you are using a version of Anno 1602 which came with a physical CD, copy the videosmk and music8 folders into your Anno 1602 root folder before creating the zip file."),Hn.createElement("li",null,"Use the upload button below to upload the zip file. The file should be around 50MB if it doesn't contain music and videos, and around 500MB if it does."),Hn.createElement("li",null,Hn.createElement("p",null,"Grab a coffee. The upload takes some time. Progress is being logged below. Should anything go wrong, take a look at the error message. It might tell you what to do. If it doesn't, make sure you're using a recent version of Chrome or Firefox. If it is still not working,"," ",Hn.createElement("a",{href:"https://reddit.com/u/cmfcmf"},"drop me a note at reddit"),", ",Hn.createElement("a",{href:"https://twitter.com/christianmflach"},"twitter"),", or"," ",Hn.createElement("a",{href:"https://github.com/cmfcmf/Anno2018"},"create an issue at GitHub"),". Make sure to include the upload progress output."),"Upload:"," ",Hn.createElement("input",{type:"file",multiple:!1,accept:".zip",onChange:this.zipUploaded,disabled:this.state.isUploading}))),Hn.createElement("h2",null,"Upload Progress ",Hn.createElement("small",null,"(newest at the top)")),0===this.state.messages.length&&Hn.createElement("p",null,"Nothing yet..."),Hn.createElement("div",{style:{fontSize:"10px"}},this.state.messages.map(function(e,t){return Hn.createElement("div",{key:t},Hn.createElement("span",{style:{color:"info"===e.type?"blue":"warn"===e.type?"orange":"red"}},e.type.toUpperCase()),": ",e.msg)})),Hn.createElement("h2",null,"Uploading custom missions and additional savegames"),Hn.createElement("p",null,"Use this button to upload additional missions or savegames after you uploaded the main game:"," ",Hn.createElement("input",{type:"file",multiple:!0,accept:".szm,.szs,.gam",onChange:this.props.onSaveOrMissionUploaded})),Hn.createElement("h2",null,"Resetting files"),Hn.createElement("p",null,'You can use the "Reset all files" button to delete all uploaded files if needed: ',Hn.createElement("button",{onClick:this.resetFiles},"Reset all files")))}}])&&Pr(n.prototype,r),i&&Pr(n,i),t}();function jr(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Fr(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){jr(a,r,i,o,s,"next",e)}function s(e){jr(a,r,i,o,s,"throw",e)}o(void 0)})}}function Mr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Lr=n("oxjq"),Dr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fs=t,this.logger=void 0,this.logger=i}var t,n,r;return t=e,(n=[{key:"init",value:function(){var e=Fr(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=console,e.next=3,this.fs.ls("/");case 3:e.t1=e.sent,e.t0.table.call(e.t0,e.t1);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(e){var t=this,n=document.createElement("div");Wn.render(Hn.createElement(Nr,{onUploaded:this.uploadAndParse.bind(this),onReset:this.reset.bind(this),onSaveOrMissionUploaded:function(){var e=Fr(regeneratorRuntime.mark(function e(n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(r=n.target.files)&&0!==r.length){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Promise.all(Array.from(r).map(function(e){return t.uploadSaveOrMission(e)}));case 5:alert("Upload finished. The page will now refresh."),window.location.reload(!0);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),setLogger:this.setLogger.bind(this)}),e),e.appendChild(n)}},{key:"isUploaded",value:function(){var e=Fr(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fs.exists("/fields.dat"));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setLogger",value:function(e){this.logger=e}},{key:"reset",value:function(){var e=Fr(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.rmRoot();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"uploadAndParse",value:function(){var e=Fr(regeneratorRuntime.mark(function e(t){var n,r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fs.write("/original.zip",t);case 3:return e.next=5,this.fs.open("/original.zip");case 5:return r=e.sent,e.next=8,zn.a.loadAsync(r);case 8:n=e.sent,e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(0),this.logger.error("Could not upload the ZIP file: ".concat(e.t0.message)),e.abrupt("return",!1);case 15:return e.prev=15,i=Object(c.a)(n),e.next=19,this.fs.rmRoot();case 19:return e.next=21,this.copyIslands(i);case 21:return e.next=23,this.copySaves(i);case 23:return e.next=25,this.parseTranslations(i);case 25:return a=e.sent,e.next=28,this.copyMissions(i,a);case 28:return e.next=30,this.decryptCODs(i);case 30:return e.next=32,this.parseDATs();case 32:return e.next=34,this.parseGADs(i);case 34:return e.next=36,this.parseBSHs(i);case 36:return e.next=38,this.parseZEIs(i);case 38:return e.next=40,this.parseMusic(i);case 40:return e.next=42,this.parseVideos(i);case 42:e.next=48;break;case 44:return e.prev=44,e.t1=e.catch(15),this.logger.error(e.t1.message),e.abrupt("return",!1);case 48:return e.abrupt("return",!0);case 49:case"end":return e.stop()}},e,this,[[0,11],[15,44]])}));return function(t){return e.apply(this,arguments)}}()},{key:"uploadSaveOrMission",value:function(){var e=Fr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".gam")){e.next=5;break}return e.next=3,this.fs.write("/saves/".concat(t.name),t);case 3:e.next=7;break;case 5:return e.next=7,this.fs.write("/missions-custom/".concat(t.name),t);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"parseDATs",value:function(){var e=Fr(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([["/fields.dat","/fields.json"],["/animations.dat","/animations.json"]].map(function(){var e=Fr(regeneratorRuntime.mark(function e(n){var r,i,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n[0],i=n[1],t.logger.info('Started parsing "'.concat(r,'".')),a=new dr,e.t0=a,e.next=7,t.fs.openAndGetContentAsText(r);case 7:return e.t1=e.sent,o=e.t0.parse.call(e.t0,e.t1),e.next=11,t.fs.write(i,JSON.stringify(o));case 11:t.logger.info('Finished parsing "'.concat(r,'".'));case 12:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"parseGADs",value:function(){var e=Fr(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u,c,l,d,f,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.mkdir("/screens");case 2:return n=new dr,r="GADDATA/TOOLS.INC",this.logger.info('Started parsing "'.concat(r,'".')),i=this.findFileCaseInsensitive(t,r),e.t0=n,e.next=9,i.async("text");case 9:e.t1=e.sent,a=e.t0.parse.call(e.t0,e.t1),o=new Map(Object.entries(a.variables)),this.logger.info('Finished parsing "'.concat(r,'".')),s=0,u=[["Anno.gad",""],["BASE.GAD","menu_main"],["BAU.GAD",""],["BAUKONT.GAD",""],["BAUSHIP.GAD",""],["BERGWERK.GAD",""],["BUBBLE01.GAD",""],["BUBBLE.GAD",""],["CHAT.GAD",""],["CLIENT.GAD",""],["CTRL.GAD",""],["DISK.GAD",""],["ENDE.GAD","menu_points"],["FARBWAHL.GAD","menu_player_selection"],["HANDEL.GAD",""],["HOST.GAD","menu_missions"],["INFO.GAD",""],["INFRA.GAD",""],["KONTOR.GAD",""],["LAGER.GAD",""],["LEIST.GAD",""],["MARKT.GAD",""],["MILITAR.GAD",""],["MISSION.GAD","menu_mission_details"],["MISSZIEL.GAD",""],["MKSHIP.GAD",""],["MKSOLDAT.GAD",""],["MUSIK.GAD",""],["OPTION.GAD",""],["PIRAT.GAD",""],["PIRATORD.GAD",""],["PLANTAGE.GAD",""],["PROD.GAD",""],["ROUTE.GAD",""],["SCAPE.GAD",""],["SHIP.GAD",""],["SHIPLIST.GAD",""],["SIEDLER.GAD",""],["SKSHIP.GAD",""],["SKSOLDAT.GAD",""],["STADT.GAD",""],["STADTLST.GAD",""],["TRADE.GAD",""],["TRADER.GAD",""],["TRANSFER.GAD",""],["TRIBUT.GAD",""],["TUTOR.GAD",""],["VERTRAG.GAD",""],["WAITLOAD.GAD","menu_loading"],["WERFT.GAD",""]];case 15:if(!(s<u.length)){e.next=34;break}return""===(c=u[s])[1]&&(c[1]=c[0]),l="GADDATA/".concat(c[0]),d="/screens/".concat(c[1],".json"),this.logger.info('Started parsing "'.concat(l,'".')),f=this.findFileCaseInsensitive(t,l),e.t2=n,e.next=25,f.async("text");case 25:return e.t3=e.sent,e.t4=o,p=e.t2.parse.call(e.t2,e.t3,e.t4),e.next=30,this.fs.write(d,JSON.stringify(p));case 30:this.logger.info('Finished parsing "'.concat(l,'".'));case 31:s++,e.next=15;break;case 34:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"decryptCODs",value:function(){var e=Fr(regeneratorRuntime.mark(function e(t){var n,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new sr.a,e.abrupt("return",Promise.all([["haeuser.cod","/fields.dat"],["figuren.cod","/animations.dat"]].map(function(){var e=Fr(regeneratorRuntime.mark(function e(i){var a,o,s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=i[0],o=i[1],r.logger.info('Started parsing "'.concat(a,'".')),s=r.findFileCaseInsensitive(t,a),e.next=6,u.a.fromZipObject(s);case 6:return c=e.sent,e.next=9,r.fs.write(o,n.decrypt(c));case 9:r.logger.info('Finished parsing "'.concat(a,'".'));case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"parseBSHs",value:function(){var e=Fr(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,c,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=new or,r=0,i=[["GFX/NUMBERS","NUMBERS"],["GFX/STADTFLD","STADTFLD"],["GFX/EFFEKTE","EFFEKT"],["GFX/FISCHE","WAL"],["GFX/GAUKLER","GAUKLER"],["GFX/MAEHER","MAEHER"],["GFX/SCHATTEN","SCHATTEN"],["GFX/SHIP","SHIP"],["GFX/SOLDAT","SOLDAT"],["GFX/TIERE","RIND"],["GFX/TRAEGER","TRAEGER"],["ToolGfx/BAUHAUS","TOOLS/BAUHAUS"],["ToolGfx/BAUSHIP","TOOLS/BAUSHIP"],["ToolGfx/START","TOOLS/START"],["ToolGfx/SYMBOL","TOOLS/SYMBOL"],["ToolGfx/TOOLS","TOOLS/TOOLS"]];case 3:if(!(r<i.length)){e.next=23;break}return a=i[r],o=a[0]+".BSH",s=a[1],this.logger.info('Started parsing "'.concat(o,'".')),c=this.findFileCaseInsensitive(t,o),e.t0=n,e.next=12,u.a.fromZipObject(c);case 12:return e.t1=e.sent,e.next=15,e.t0.decodeBSH.call(e.t0,e.t1);case 15:return l=e.sent,d=n.createSpriteSheets(l),e.next=19,n.saveSpriteSheets(this.fs,d,"/gfx/".concat(s));case 19:this.logger.info('Finished parsing "'.concat(o,'".'));case 20:r++,e.next=3;break;case 23:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"parseTranslations",value:function(){var e=Fr(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("Started parsing translations."),n=this.findFileCaseInsensitive(t,"text.cod"),r=new sr.a,e.t0=Er,e.t1=r,e.next=7,u.a.fromZipObject(n);case 7:return e.t2=e.sent,e.t3=e.t1.decrypt.call(e.t1,e.t2),i=(0,e.t0)(e.t3),e.next=12,this.fs.write("/translations.json",JSON.stringify(i));case 12:return this.logger.info("Finished parsing translations."),e.abrupt("return",i.PATH[0]);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"parseZEIs",value:function(){var e=Fr(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,c,l,d,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.mkdir("/fonts");case 2:n=new or,r=new Sr,i=0,a=["ZEI11A","ZEI14A","ZEI14V","ZEI16G","ZEI16H","ZEI16V","ZEI20H","ZEI20V","ZEI24V","ZEI28V","ZEI2","ZEI9A"];case 6:if(!(i<a.length)){e.next=30;break}return o=a[i],s="TOOLGFX/".concat(o,".ZEI"),this.logger.info('Started parsing "'.concat(s,'".')),c=this.findFileCaseInsensitive(t,s),e.t0=n,e.next=14,u.a.fromZipObject(c);case 14:return e.t1=e.sent,e.next=17,e.t0.decodeZEI.call(e.t0,e.t1);case 17:return l=e.sent,d=n.createSpriteSheets(l),e.next=21,n.saveSpriteSheets(this.fs,d,"/fonts/".concat(o));case 21:return e.next=23,r.createBitmapFont(d,o);case 23:return f=e.sent,e.next=26,this.fs.write("/fonts/".concat(o,"/font.xml"),f);case 26:this.logger.info('Finished parsing "'.concat(s,'".'));case 27:i++,e.next=6;break;case 30:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"parseMusic",value:function(){var e=Fr(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u,c,l,d,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.mkdir("/music");case 2:if(this.hasFolderCaseInsensitive(t,"MUSIC8")){e.next=5;break}return this.logger.warn("No music files found."),e.abrupt("return");case 5:return n=new br,e.next=8,this.findFilesInZip(t,"MUSIC8",".wav");case 8:r=e.sent,i=!0,a=!1,o=void 0,e.prev=12,s=r[Symbol.iterator]();case 14:if(i=(u=s.next()).done){e.next=30;break}return c=u.value,l=c.path.substr(1),this.logger.info("Converting song ".concat(l)),e.t0=n,e.next=21,c.file.async("uint8array");case 21:return e.t1=e.sent,d=e.t0.decode.call(e.t0,e.t1),f=n.encode(d),e.next=26,this.fs.write("/music/".concat(l),f);case 26:this.logger.info("Finished converting song ".concat(l));case 27:i=!0,e.next=14;break;case 30:e.next=36;break;case 32:e.prev=32,e.t2=e.catch(12),a=!0,o=e.t2;case 36:e.prev=36,e.prev=37,i||null==s.return||s.return();case 39:if(e.prev=39,!a){e.next=42;break}throw o;case 42:return e.finish(39);case 43:return e.finish(36);case 44:case"end":return e.stop()}},e,this,[[12,32,36,44],[37,,39,43]])}));return function(t){return e.apply(this,arguments)}}()},{key:"parseVideos",value:function(){var e=Fr(regeneratorRuntime.mark(function e(t){var n,r,i,a,o,s,u,c,l,d,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fs.mkdir("/videos");case 2:if(this.hasFolderCaseInsensitive(t,"VIDEOSMK")){e.next=5;break}return this.logger.warn("No video files found."),e.abrupt("return");case 5:return n=new vr,e.next=8,this.findFilesInZip(t,"VIDEOSMK",".smk");case 8:r=e.sent,i=!0,a=!1,o=void 0,e.prev=12,s=r[Symbol.iterator]();case 14:if(i=(u=s.next()).done){e.next=30;break}return c=u.value,l=c.path.substr(1),this.logger.info("Converting video ".concat(l)),e.next=20,c.file.async("uint8array");case 20:return d=e.sent,e.next=23,n.parse(d);case 23:return f=e.sent,e.next=26,this.fs.write("/videos/".concat(l.replace(".smk",".mp4")),f);case 26:this.logger.info("Finished converting video ".concat(l));case 27:i=!0,e.next=14;break;case 30:e.next=36;break;case 32:e.prev=32,e.t0=e.catch(12),a=!0,o=e.t0;case 36:e.prev=36,e.prev=37,i||null==s.return||s.return();case 39:if(e.prev=39,!a){e.next=42;break}throw o;case 42:return e.finish(39);case 43:return e.finish(36);case 44:case"end":return e.stop()}},e,this,[[12,32,36,44],[37,,39,43]])}));return function(t){return e.apply(this,arguments)}}()},{key:"copyIslands",value:function(){var e=Fr(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([["NOKLIMA","/islands/noklima"],["NORD","/islands/north"],["NORDNAT","/islands/northnat"],["SUED","/islands/south"],["SUEDNAT","/islands/southnat"]].map(function(e){return n.copyFolderFromZip(t,e[0],e[1],".scp")})));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"copySaves",value:function(){var e=Fr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyFolderFromZip(t,"SAVEGAME","/saves",".gam");case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"copyMissions",value:function(){var e=Fr(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyFolderFromZip(t,"Szenes","/missions-original",".szm|.szs|.hss");case 2:return e.next=4,this.copyFolderFromZip(t,n,"/missions-custom",".szm|.szs|.hss");case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"copyFolderFromZip",value:function(){var e=Fr(regeneratorRuntime.mark(function e(t,n,r,i){var a,o,s,u,c,l,d,f,p,h,m,v=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(v.length>4&&void 0!==v[4])||v[4],n="".concat(n,"/"),this.logger.info("Copying '".concat(i,"' files from '").concat(n,"' to '").concat(r,"'.")),o=this.findFilesInZip(t,n,i),e.next=6,this.fs.mkdir(r);case 6:s=!0,u=!1,c=void 0,e.prev=9,l=o[Symbol.iterator]();case 11:if(s=(d=l.next()).done){e.next=27;break}return f=d.value,p=a?f.path.toLowerCase():f.path,h=f.file,m="".concat(r,"/").concat(p),this.logger.info("Copying '".concat(p,"' to '").concat(m,"'.")),e.t0=this.fs,e.t1=m,e.next=21,h.async("blob");case 21:return e.t2=e.sent,e.next=24,e.t0.write.call(e.t0,e.t1,e.t2);case 24:s=!0,e.next=11;break;case 27:e.next=33;break;case 29:e.prev=29,e.t3=e.catch(9),u=!0,c=e.t3;case 33:e.prev=33,e.prev=34,s||null==l.return||l.return();case 36:if(e.prev=36,!u){e.next=39;break}throw c;case 39:return e.finish(36);case 40:return e.finish(33);case 41:case"end":return e.stop()}},e,this,[[9,29,33,41],[34,,36,40]])}));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"findFilesInZip",value:function(e,t,n){var r=[];return e.forEach(function(e,i){if(e.startsWith(t)){var a=!0,o=!1,s=void 0;try{for(var u,c=n.split("|")[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var l=u.value;if(e.toLowerCase().endsWith(l.toLowerCase())){e=(e=e.substring(t.length)).substring(0,e.length-l.length),e+=l,r.push({path:e,file:i});break}}}catch(e){o=!0,s=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw s}}}}),r}},{key:"findFileCaseInsensitive",value:function(e,t){var n=new RegExp(Lr(t),"i"),r=e.file(n)[0];if(void 0===r)throw new Error("Could not find file ".concat(t,"."));return r}},{key:"hasFolderCaseInsensitive",value:function(e,t){var n=new RegExp(Lr(t),"i");return void 0!==e.folder(n)[0]}}])&&Mr(t.prototype,n),r&&Mr(t,r),e}();function Br(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Ur(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Br(a,r,i,o,s,"next",e)}function s(e){Br(a,r,i,o,s,"throw",e)}o(void 0)})}}Ur(regeneratorRuntime.mark(function e(){var t,n,r,a,u,l,d,f,p,m,v,g,y,b,w,x,k,S,E,R,A,I,_,O,P,T,G,C,N,j,F,M,L,D;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.enableAll(),(t=document.createElement("style")).innerText="\n        body, html {\n            margin: 0;\n        }\n    ",(n=document.createElement("div")).id="game",(r=document.createElement("p")).innerHTML="Anno 2018, version ".concat("fff535e",',\n                         made by <a href="https://github.com/cmfcmf">@cmfcmf</a>.\n                         The sourcecode can be found at <a href="https://github.com/cmfcmf/Anno2018">GitHub</a>.'),document.head.appendChild(t),document.body.appendChild(n),document.body.appendChild(r),a=new h,2e3,e.next=14,a.init(2097152e3);case 14:return window.fs=a,u=new Dr(a),e.next=18,u.init();case 18:return u.render(n),e.next=21,u.isUploaded();case 21:if(e.sent){e.next=24;break}return console.warn("Anno 1602 files not yet uploaded."),e.abrupt("return");case 24:return s.settings.SCALE_MODE=s.SCALE_MODES.NEAREST,s.settings.MIPMAP_TEXTURES=s.MIPMAP_MODES.OFF,l=new s.Application({width:window.innerWidth,height:window.innerHeight-120,antialias:!1,transparent:!1}),n.insertAdjacentElement("afterbegin",l.view),d=new o.a({screenWidth:l.screen.width,screenHeight:l.screen.height,passiveWheel:!1}),l.stage.addChild(d),d.drag({direction:"all",wheel:!1}).wheel().mouseEdges({distance:20,speed:15}),f=new o.a({screenWidth:l.screen.width,screenHeight:l.screen.height,worldWidth:1024,worldHeight:768}),l.stage.addChild(f),e.next=35,pn(a);case 35:return p=new _e(a),e.next=38,p.load();case 38:return m=new Re(a),e.next=41,m.load();case 41:return console.log("Finished loading config."),v=new Pn(a),e.next=45,v.load();case 45:if(console.log("Finished loading music."),g=new Bn(a),y=new Mn(a,m.getFieldData()),b=new un(y),w=new Be(a,m,g),x=new se(d,w),k=new ve(a,b,x,l,d,m,v),S=Object(c.b)("load"),E=Object(c.b)("gad"),R=Object(c.b)("animation"),A=Object(c.b)("island"),null===S){e.next=62;break}return e.next=59,k.loadByName(S);case 59:f.visible=!1,e.next=113;break;case 62:if(null===E){e.next=70;break}return console.info('Rendering "'.concat(E,'" screen.')),I=new Me(f,g),_=new An(a,I,v),e.next=68,_.renderScreen(E);case 68:e.next=113;break;case 70:if(null===R){e.next=91;break}return console.log('Rendering animation "'.concat(R,'".')),e.t0=JSON,e.next=75,a.openAndGetContentAsText("/animations.json");case 75:return e.t1=e.sent,O=e.t0.parse.call(e.t0,e.t1),P=new we(O,g),e.next=80,P.getAnimation(R);case 80:T=e.sent,0,1,G=T[0].sprites[1],C=T[0].config,G.loop=!0,"ENDLESS"!==C.Kind&&(N=0,G.onLoop=function(){N++,console.log(N,C.AnimRept),N===C.AnimRept&&(G.loop=!1)}),d.addChild(G),G.play(),e.next=113;break;case 91:if(null===A){e.next=108;break}return console.info('Rendering island "'.concat(A,'".')),e.next=95,y.loadIslandFileByName(A);case 95:for(j=e.sent,F=[];!j.eof();)F.push(Ot.fromStream(j));return console.table(F),M=rt(F.find(function(e){return["INSEL5","INSEL4","INSEL3"].includes(e.type)}).data),y.setIslandFields(M,[F.find(function(e){return"INSELHAUS"===e.type})]),M.position=new s.Point(0,0),M.positionRect=new s.Rectangle(0,0,M.size.x,M.size.y),f.visible=!1,e.next=106,x.render([M]);case 106:e.next=113;break;case 108:return L=new Me(f,g),(D=new An(a,L,v)).on("load-game",function(){var e=Ur(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.load(t);case 2:f.visible=!1;case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=113,D.renderScreen("menu_main");case 113:case"end":return e.stop()}},e)}))()},"/dzE":function(module,__webpack_exports__,__webpack_require__){"use strict";(function(__dirname){function asyncGeneratorStep(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){asyncGeneratorStep(a,r,i,o,s,"next",e)}function s(e){asyncGeneratorStep(a,r,i,o,s,"throw",e)}o(void 0)})}}var loadedFFmpeg;function loadFFmpeg(){return _loadFFmpeg.apply(this,arguments)}function _loadFFmpeg(){return(_loadFFmpeg=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!loadedFFmpeg){e.next=2;break}return e.abrupt("return",loadedFFmpeg);case 2:return e.next=4,doLoadFFmpeg();case 4:return loadedFFmpeg=e.sent,e.next=7,new Promise(function(e,t){loadedFFmpeg({arguments:["-version"],returnCallback:e})});case 7:return e.abrupt("return",loadedFFmpeg);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function doLoadFFmpeg(){return _doLoadFFmpeg.apply(this,arguments)}function _doLoadFFmpeg(){return _doLoadFFmpeg=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var ffmpeg;return regeneratorRuntime.wrap(function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(console.log("Loading FFmpeg"),"undefined"==typeof window){_context2.next=7;break}return _context2.next=4,loadFFmpegInBrowser();case 4:ffmpeg=_context2.sent,_context2.next=8;break;case 7:ffmpeg=eval("require")(__dirname+"/../../node_modules/smk2mp4/demo/ffmpeg.js");case 8:return console.log("Finished loading FFmpeg"),_context2.abrupt("return",ffmpeg);case 10:case"end":return _context2.stop()}},_callee2)})),_doLoadFFmpeg.apply(this,arguments)}function loadFFmpegInBrowser(){return _loadFFmpegInBrowser.apply(this,arguments)}function _loadFFmpegInBrowser(){return(_loadFFmpegInBrowser=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){var n=function(){var n=self.ffmpeg_run;n?e(n):t("Could not load FFmpeg!")},r=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.src="ffmpeg.js",i.onreadystatechange=n,i.onload=n,r.appendChild(i)}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}__webpack_require__.d(__webpack_exports__,"a",function(){return loadFFmpeg})}).call(this,"/")},0:function(e,t,n){n("LSZE"),n("ls82"),n("ZPch"),e.exports=n("/7QA")},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},cE7O:function(e,t,n){"use strict";function r(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}n.d(t,"a",function(){return o});var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pos=void 0,this.data=void 0,this.pos=0,this.data=t}return a(e,null,[{key:"fromZipObject",value:function(){var t,n=(t=regeneratorRuntime.mark(function t(n){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.async("uint8array");case 2:return r=t.sent,t.abrupt("return",new e(r));case 4:case"end":return t.stop()}},t)}),function(){var e=this,n=arguments;return new Promise(function(i,a){var o=t.apply(e,n);function s(e){r(o,i,a,s,u,"next",e)}function u(e){r(o,i,a,s,u,"throw",e)}s(void 0)})});return function(e){return n.apply(this,arguments)}}()}]),a(e,[{key:"position",value:function(){return this.pos}},{key:"seek",value:function(e){this.pos=e}},{key:"readString",value:function(e){for(var t="",n=!1;e--;){var r=this.read8();n||0===r?n=!0:t+=String.fromCharCode(r)}return t}},{key:"readStringUnterminated",value:function(e){for(var t="";e--;)t+=String.fromCharCode(this.read8());return t}},{key:"read",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e*=t;for(var n=[];e>0;)n.push(this.readNBytes(t)),e-=t;return n}},{key:"slice",value:function(e){var t=this.data.slice(this.pos,this.pos+e);return this.pos+=e,t}},{key:"read16",value:function(){return this.readNBytes(2)}},{key:"read24",value:function(){return this.readNBytes(3)}},{key:"read32",value:function(){return this.readNBytes(4)}},{key:"read32S",value:function(){return this.readNBytes(4)>>0}},{key:"read64",value:function(){return this.readNBytes(8)}},{key:"read8",value:function(){return this.data[this.pos++]}},{key:"eof",value:function(){return this.pos===this.length}},{key:"read8Bool",value:function(){return 0!==this.read8()}},{key:"readNBytes",value:function(e){for(var t=0,n=0;n<e;n++)t+=this.read8()*Math.pow(2,8*n);return t}},{key:"length",get:function(){return this.data.length}}]),e}()},daKf:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return o});var r=n("rPnE"),i=n("cE7O");function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.encoding="win1252"}var n,o,s;return n=t,(o=[{key:"decrypt",value:function(t){for(var n=new e(t.length),i=0;i<t.length;i++)n[i]=256-t.read8();return Object(r.decode)(n,this.encoding)}},{key:"encrypt",value:function(t){for(var n=new i.a(Object(r.encode)(t,this.encoding)),a=new e(n.length),o=0;o<n.length;o++)a[o]=256-n.read8();return a}}])&&a(n.prototype,o),s&&a(n,s),t}()}).call(this,n("tjlA").Buffer)},vurl:function(module,__webpack_exports__,__webpack_require__){"use strict";function uInt8ToBase64(arr){for(var CHUNK_SIZE=32768,index=0,length=arr.length,result="";index<length;){var slice=arr.subarray(index,Math.min(index+CHUNK_SIZE,length));result+=String.fromCharCode.apply(null,slice),index+=CHUNK_SIZE}return"undefined"!=typeof window?btoa(result):eval("require")("btoa")(result)}function getQueryParameter(e){var t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function findRootInZip(e){var t=e.filter(function(e){return("/"+e).endsWith("/GFX/")});if(1===t.length)return e.folder(t[0].name.replace("GFX/",""));throw new Error("Your ZIP file does not have the expected structure.")}function make2DArray(e,t){return Array(e).fill(void 0).map(function(){return Array(t).fill(null)})}__webpack_require__.d(__webpack_exports__,"d",function(){return uInt8ToBase64}),__webpack_require__.d(__webpack_exports__,"b",function(){return getQueryParameter}),__webpack_require__.d(__webpack_exports__,"a",function(){return findRootInZip}),__webpack_require__.d(__webpack_exports__,"c",function(){return make2DArray})}},[[0,1,2]]]);
//# sourceMappingURL=app.51f4d94033ba936ebe3a.js.map